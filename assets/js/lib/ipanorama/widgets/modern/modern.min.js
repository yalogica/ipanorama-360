!function(e){(function(Q){"use strict";var U=jQuery,D={name:"modern",defaultConfig:{titleControl:true,prevSceneControl:true,nextSceneControl:true,audioControl:true,compassControl:true,fullscreenControl:true,thumbnailControl:true,viewerModeControl:false,moveToNextScene:true},widget:function(s,r){r=Q.Utils.extend(D.defaultConfig,r);this.audioPlayer=new Q.AudioPlayer(s.config.audio);var i=this;var t=s.$container;var n=U("<div>").addClass("ipnrm-placeholder").css({display:"none"});var o={};var l=null;var c=null;var d=null;var m=null;var f=[];var p=null;var u=false;var v=null;this.init=function(){e();a()};this.setAudio=function(e){o.$audioPlayer.toggleClass("ipnrm-active",s.config.audio.tracks.length>0&&s.config.audio.enabled);if(!s.config.audio.enabled)return;for(var a=0;a<s.config.audio.tracks.length;a++){var n=s.config.audio.tracks[a];if(n.sceneId==e.cfg.id){i.audioPlayer.setTrack(n.id);n.autoplay&&i.audioPlayer.play();i.audioPlayer.loop(n.loop);break}}};this.setCompass=function(e){t.off("ipanorama:scene-camera-change",O);if(e.cfg.compass&&e.cfg.compass.enabled&&e.cfg.type!="flat"&&e.cfg.type!="littleplanet"){t.on("ipanorama:scene-camera-change",O);o.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled);$(e)}else o.$compass.toggleClass("ipnrm-active",false)};this.destroy=function(){h();o.$widget.remove();o={};t.removeClass("ipnrm-widget-modern");i.audioPlayer.destroy()};var $=function(e){if(!e.control)return;var a=e.control.getLookAt().yaw,n=e.cfg.compass.northOffset-a;n=n%360;n=n<0?n+360:n;o.$compass.css({transform:"rotate("+n+"deg)"})};var e=function(){t.addClass("ipnrm-widget-modern");o.$widget=U("<div>").addClass("ipnrm-widget");o.$firstLoad=U("<div>").addClass("ipnrm-first-load");o.$ts=U("<div>").addClass("ipnrm-ts");o.$bs=U("<div>").addClass("ipnrm-bs");o.$tlBar=U("<div>").addClass("ipnrm-tl-bar");o.$trBar=U("<div>").addClass("ipnrm-tr-bar");o.$brBar=U("<div>").addClass("ipnrm-br-bar");o.$blBar=U("<div>").addClass("ipnrm-bl-bar");o.$progress=U("<div>").addClass("ipnrm-progress");o.$progressBar=U("<div>").addClass("ipnrm-progress-bar").appendTo(o.$progress);o.$audioPlayer=i.audioPlayer.getWidget();o.$prevScene=U("<div>").addClass("ipnrm-btn ipnrm-prev-scene");o.$nextScene=U("<div>").addClass("ipnrm-btn ipnrm-next-scene");o.$stereoMode=U("<div>").addClass("ipnrm-btn ipnrm-stereo-mode");o.$thumbs=U("<div>").addClass("ipnrm-btn ipnrm-thumbs");o.$compass=U("<div>").addClass("ipnrm-btn ipnrm-compass");o.$fullscreen=U("<div>").addClass("ipnrm-btn ipnrm-fullscreen");o.$title=U("<div>").addClass("ipnrm-title");o.$ts.append(o.$tlBar,o.$trBar);o.$bs.append(o.$blBar,o.$brBar);o.$tlBar.append(o.$audioPlayer);o.$trBar.append(o.$prevScene,o.$nextScene);o.$brBar.append(o.$stereoMode,o.$thumbs,o.$compass,o.$fullscreen);o.$blBar.append(o.$title);o.$thumbsWrap=U("<div>").addClass("ipnrm-thumbs-wrap");o.$thumbsList=U("<div>").addClass("ipnrm-thumbs-list");o.$thumbsClose=U("<div>").addClass("ipnrm-thumbs-close");o.$thumbsWrap.append(o.$thumbsList,o.$thumbsClose);o.$widget.append(o.$progress,o.$firstLoad,o.$ts,o.$bs,o.$thumbsWrap);t.append(o.$widget);b();t.on("ipanorama:config",P).trigger("ipanorama:config")};var g=function(e){for(var a=0;a<e.scenes.length;a++){var n=e.scenes[a];if(n.image||n.imageThumb){var s=U("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":n.id}),r=U("<img>").attr({loading:"lazy",src:n.imageThumb?n.imageThumb:typeof n.image==="string"?n.image:""});o.$thumbsList.append(s.append(r))}}};var a=function(){t.on("ipanorama:ready",_);t.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",j);t.on("ipanorama:scene-before-load",A);t.on("ipanorama:scene-after-load",z);t.on("ipanorama:scene-progress",W);t.on("ipanorama:scene-error",R);t.on("ipanorama:scene-hide-start",q);t.on("ipanorama:scene-hide-complete",E);t.on("ipanorama:scene-show-start",I);t.on("ipanorama:scene-show-complete",N);t.on("ipanorama:scene-index",H);t.on("ipanorama:mode",T);o.$prevScene.on("click",k);o.$nextScene.on("click",w);o.$stereoMode.on("click",y);o.$compass.on("click",F);o.$fullscreen.on("click",B);o.$thumbs.on("click",S);o.$thumbsList.on("click",".ipnrm-thumb",x);o.$thumbsClose.on("click",L);o.$firstLoad.on("click",M)};var h=function(){t.off("ipanorama:ready",_);t.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",j);t.off("ipanorama:scene-before-load",A);t.off("ipanorama:scene-after-load",z);t.off("ipanorama:scene-progress",W);t.off("ipanorama:scene-error",R);t.off("ipanorama:scene-hide-start",q);t.off("ipanorama:scene-hide-complete",E);t.off("ipanorama:scene-show-start",I);t.off("ipanorama:scene-show-complete",N);t.off("ipanorama:scene-camera-change",O);t.off("ipanorama:scene-index",H);t.off("ipanorama:mode",T);o.$prevScene.off("click",k);o.$nextScene.off("click",w);o.$stereoMode.off("click",y);o.$compass.off("click",F);o.$fullscreen.off("click",B);o.$thumbs.off("click",S);o.$thumbsList.off("click",".ipnrm-thumb",x);o.$thumbsClose.off("click",L);o.$firstLoad.off("click",M)};var C=function(){o.$firstLoad.addClass("ipnrm-hide");r.titleControl&&o.$title.removeClass("ipnrm-hide");r.audioControl&&o.$audioPlayer.removeClass("ipnrm-hide");r.compassControl&&o.$compass.removeClass("ipnrm-hide");r.prevSceneControl&&o.$prevScene.removeClass("ipnrm-hide");r.nextSceneControl&&o.$nextScene.removeClass("ipnrm-hide");r.fullscreenControl&&o.$fullscreen.removeClass("ipnrm-hide");r.thumbnailControl&&o.$thumbs.removeClass("ipnrm-hide");r.viewerModeControl&&o.$stereoMode.removeClass("ipnrm-hide");o.$thumbsWrap.removeClass("ipnrm-hide")};var b=function(){o.$firstLoad.addClass("ipnrm-hide");o.$title.addClass("ipnrm-hide");o.$audioPlayer.addClass("ipnrm-hide");o.$compass.addClass("ipnrm-hide");o.$prevScene.addClass("ipnrm-hide");o.$nextScene.addClass("ipnrm-hide");o.$fullscreen.addClass("ipnrm-hide");o.$thumbs.addClass("ipnrm-hide");o.$stereoMode.addClass("ipnrm-hide");o.$thumbsWrap.addClass("ipnrm-hide")};var k=function(e){p=p-1;if(p<0)p=null;else t.trigger("ipanorama:set-scene",{id:f[p]})};var w=function(e){p=p+1;if(p>=f.length){p=f.length-1;t.trigger("ipanorama:next-scene")}else t.trigger("ipanorama:set-scene",{id:f[p]})};var y=function(e){var a=l;switch(a){case"normal":a="stereo";break;case"stereo":a="normal";break}t.trigger("ipanorama:mode",{mode:a})};var S=function(e){var a=o.$thumbsList.find(".ipnrm-thumb.ipnrm-active");a.removeClass("ipnrm-active");a=o.$thumbsList.find('[data-scene-id="'+c+'"]');a.addClass("ipnrm-active");o.$thumbsWrap.addClass("ipnrm-active");setTimeout(function(){if(o.$thumbsList.find(".ipnrm-thumb").length){var e=o.$thumbsList.find(".ipnrm-thumb:first-child").get(0).offsetTop;o.$thumbsList.get(0).scrollTop=a.get(0).offsetTop-e}},100)};var x=function(e){t.trigger("ipanorama:set-scene",{id:U(this).data("scene-id")});o.$thumbsWrap.removeClass("ipnrm-active")};var L=function(e){o.$thumbsWrap.removeClass("ipnrm-active")};var F=function(e){if(d){var a=d.control.getLookAt();d.control.lookAt({yaw:d.cfg.compass.northOffset,pitch:a.pitch},600)}};var B=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(o.$fullscreen.hasClass("ipnrm-active"))try{if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen()}catch(e){}else try{var a=t.get(0);if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.webkitRequestFullscreen)a.webkitRequestFullscreen();else if(a.msRequestFullscreen)a.msRequestFullscreen()}catch(e){}else{t.toggleClass("ipnrm-fullscreen-mode");if(t.hasClass("ipnrm-fullscreen-mode")){o.$fullscreen.addClass("ipnrm-active");n.insertBefore(t);t.detach();U("body").append(t)}else{o.$fullscreen.removeClass("ipnrm-active");t.detach();t.insertAfter(n);n.remove()}v._onWindowResize()}};var M=function(e){if(m){o.$firstLoad.addClass("ipnrm-hide");t.trigger("ipanorama:set-scene",{id:m})}};var P=function(e,a){if(!a||!a.config)return;t.off("ipanorama:config",P);if(!a.config.autoLoad&&a.config.scenes.length>0){o.$firstLoad.removeClass("ipnrm-hide");var n=a.config.scenes[0],s=t.data("scene-id");if(s)for(var r=0;r<a.config.scenes.length;r++)if(a.config.scenes[r].id===s){n=a.config.scenes[r];break}m=n.id}g(a.config)};var T=function(e,a){if(!a||!a.master)return;l=a.mode;switch(l){case"normal":o.$stereoMode.removeClass("ipnrm-active");break;case"stereo":o.$stereoMode.addClass("ipnrm-active");break}};var W=function(e,a){if(a.progress.loaded<a.progress.total){if(!u){o.$progress.addClass("ipnrm-active");u=true}o.$progressBar.css({width:a.progress.loaded/a.progress.total*100+"%"})}else{if(u){o.$progress.removeClass("ipnrm-active");u=false}o.$progressBar.css({width:0})}};var A=function(e,a){d=a.scene};var z=function(e,a){o.$progress.removeClass("ipnrm-active");u=false;C()};var R=function(e,a){o.$progress.removeClass("ipnrm-active");u=false;b()};var q=function(e,a){};var E=function(e,a){};var I=function(e,a){i.setAudio(a.scene);i.setCompass(a.scene);if(a.scene.cfg.title){o.$title.get(0).innerHTML=a.scene.cfg.title;o.$title.addClass("ipnrm-active")}else{o.$title.get(0).innerHTML=null;o.$title.removeClass("ipnrm-active")}};var N=function(e,a){};var O=function(e,a){if(!a.scene)return;$(a.scene)};var H=function(e,a){if(!a)return;c=a.scene.cfg.id;if(p==null){f.push(c);p=0}else if(f[p]!=c){p=p+1;f=f.slice(0,p);f.push(c)}if(p>0)o.$prevScene.addClass("ipnrm-active");else o.$prevScene.removeClass("ipnrm-active");if(p<f.length-1)o.$nextScene.addClass("ipnrm-active");else{o.$nextScene.removeClass("ipnrm-active");if(r.moveToNextScene){for(var n=0;n<a.config.scenes.length;n++){var s=a.config.scenes[n];if(s.id==c)break}if(n<a.config.scenes.length-1)o.$nextScene.addClass("ipnrm-active")}}};var _=function(e,a){v=a.instance};var j=function(e){if(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)o.$fullscreen.addClass("ipnrm-active");else o.$fullscreen.removeClass("ipnrm-active");setTimeout(function(){v._onWindowResize()},100)}}};Q.Widget=Q.Widget||{},Q.Widget.Modern=D})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);