!function(g){"use strict";Object.is||(Object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}),"function"!=typeof DataTransfer.prototype.setDragImage&&(DataTransfer.prototype.setDragImage=function(e,t,n){});var e,t,n,y={VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",map:function(e,t){if(this.isFunction(e)||this.isFunction(t))throw"Invalid argument. Function given, object expected.";if(this.isValue(e)||this.isValue(t))return{type:this.compareValues(e,t),data:void 0===e?t:e};var n,a,i={};for(a in e)this.isFunction(e[a])||((n=void 0)!==t[a]&&(n=t[a]),i[a]=this.map(e[a],n));for(a in t)this.isFunction(t[a])||void 0!==i[a]||(i[a]=this.map(void 0,t[a]));return i},compareValues:function(e,t){return e===t||this.isDate(e)&&this.isDate(t)&&e.getTime()===t.getTime()?this.VALUE_UNCHANGED:void 0===e?this.VALUE_CREATED:void 0===t?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(e){return"[object Function]"==={}.toString.apply(e)},isArray:function(e){return"[object Array]"==={}.toString.apply(e)},isObject:function(e){return"[object Object]"==={}.toString.apply(e)},isDate:function(e){return"[object Date]"==={}.toString.apply(e)},isValue:function(e){return!this.isObject(e)&&!this.isArray(e)}},a=function(){var l="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function c(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){i(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&t.status<=299}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var i=l.saveAs||("object"!=typeof window||window!==l?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var a=l.URL||l.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin!==location.origin?o(i.href)?c(e,t,n):r(i,i.target="_blank"):r(i)):(i.href=a.createObjectURL(e),setTimeout(function(){a.revokeObjectURL(i.href)},4e4),setTimeout(function(){r(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){var a;t=t||e.name||"download","string"==typeof e?o(e)?c(e,t,n):((a=document.createElement("a")).href=e,a.target="_blank",setTimeout(function(){r(a)})):navigator.msSaveOrOpenBlob((e=e,void 0===(n=n)?n={autoBom:!1}:"object"!=typeof n&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e),t)}:function(e,t,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return c(e,t,n);var i,o,r,t="application/octet-stream"===e.type,n=/constructor/i.test(l.HTMLElement)||l.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);(s||t&&n)&&"object"==typeof FileReader?((i=new FileReader).onloadend=function(){var e=i.result,e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;");a?a.location.href=e:location=e,a=null},i.readAsDataURL(e)):(o=l.URL||l.webkitURL,r=o.createObjectURL(e),a?a.location=r:location.href=r,a=null,setTimeout(function(){o.revokeObjectURL(r)},4e4))});return l.saveAs=i.saveAs=i}();function i(){var n={alight:null,rootScope:null,wpFileFrameImage:null,wpFileFrameAudio:null,wp_base_url:null,wp_upload_url:null,wp_plugin_url:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_modal:null,wp_ajax_msg_error:null,wp_item_id:null,themes:null,widgets:null,transitions:null,image:new Image,loadingCounter:0,$view_info:null,$view_info_yaw:null,$view_info_pitch:null,$view_info_zoom:null,$ipanorama:null,scenes:{sphere:null,cube:null,flat:null,littleplanet:null,gsv:null,sceneOld:null,sceneNew:null},embedCodeWithId:null,embedCodeWithSlug:null,settings:{themeJavaScript:null,themeCSS:null},config:null,ui:{fullscreen:!1,mapScenes:new Map,activeScene:null,activeMarker:null,activeShape:null,activeTrack:null,transformMode:null,activeWidget:null,widgetConfigs:{},activeTransition:null,sceneTransitionConfigs:{},sidebar:!0,sidebarWidth:350,sidebarResize:{initX:null,lastX:null,width:null},tabs:{general:!0,scenes:!1,markers:!1,shapes:!1,tracks:!1,customCSS:!1,customJS:!1,shortcode:!1},generalTab:{virtualtour:!1,container:!0,tracks:!0,special:!0},markerTabs:{marker:!0,tooltip:!1,popover:!1},shapeTabs:{shape:!0},trackTabs:{track:!0},borderTabs:{all:!0,top:!1,right:!1,bottom:!1,left:!1},sceneSections:{general:!1,data:!0,additional:!0,actions:!0},markerSections:{general:!1,view:!0,data:!0,additional:!0,actions:!0},tooltipSections:{general:!1,data:!0,additional:!0,actions:!0},popoverSections:{general:!1,data:!0,additional:!0,actions:!0},shapeSections:{general:!1,data:!0}},defaultConfig:{active:!0,title:null,slug:null,theme:"light",widget:{name:"modern",config:null},sceneTransition:{name:"fade",config:null,duration:1500},preload:{image:{url:null},timeout:1e3,noProgressEvent:!1},viewerMode:"normal",autoLoad:!1,imageWidth:0,imageHeight:0,autoWidth:!0,autoHeight:!0,containerWidth:null,containerHeight:null,loopNavigation:!1,class:null,audio:{enabled:!0,html5:!0,autoplay:!1,loop:!1,mute:!1,volume:.6,tracks:[]},background:{color:null,image:{url:null},size:null,repeat:null,position:null,inline:!0},customCSS:{active:!1,data:null},customJS:{active:!1,data:null},scenes:[]},defaultScene:{guid:null,id:null,title:{active:!0,data:null},visible:!0,type:"sphere",gsv:{pano:{active:!1,id:null},location:{active:!0,lat:null,lng:null}},images:{main:{url:null},front:{url:null},back:{url:null},left:{url:null},right:{url:null},top:{url:null},bottom:{url:null},thumb:{url:null}},preload:{active:!1},camera:{lookAt:{yaw:0,pitch:0},save:!0,shared:!1,zoom:null},userData:null,autoRotate:{enabled:!1,inactivityDelay:3e3,speedX:.5,speedY:0,speedZ:0},compass:{enabled:!1,northOffset:0},markers:[],shapes:[],noZoom:!1,noRotate:!1,noKeys:!0,noGyroscope:!0},defaultTrack:{enabled:!0,id:null,title:null,url:null,loop:!1,autoplay:!0,linkSceneGuid:null},defaultMarker:{id:null,title:null,visible:!0,point:null,yaw:0,pitch:0,userData:null,link:null,linkNewWindow:!1,linkSceneGuid:null,image:{url:null},class:null,autoFocus:{active:!1,duration:700,easing:null},tooltip:{active:!1,data:null,placement:"top",offset:{x:0,y:0},autoWidth:!1,width:null,trigger:"hover",followCursor:!1,interactive:!0,showOnInit:!1,showAnimation:null,hideAnimation:null,duration:500,class:null},popover:{active:!1,data:null,type:"lightbox",mobileType:"lightbox",trigger:"click",showOnInit:!1,closeOutside:!0,showAnimation:null,hideAnimation:null,duration:500,class:null},view:{active:!1,autoWidth:!0,width:null,autoHeight:!0,height:null,angle:null,icon:{name:null,text:null,color:"#ffffff",size:{value:14,type:"px"},margin:{all:{value:null,type:"px"},top:{value:null,type:"px"},right:{value:null,type:"px"},bottom:{value:null,type:"px"},left:{value:null,type:"px"}}},background:{color:null,image:{url:null},size:"contain",repeat:"no-repeat",position:"50% 50%"},border:{all:{active:!1,width:{value:1,type:"px"},style:"solid",color:"#000000"},top:{active:!1,width:{value:1,type:"px"},style:"solid",color:"#000000"},right:{active:!1,width:{value:1,type:"px"},style:"solid",color:"#000000"},bottom:{active:!1,width:{value:1,type:"px"},style:"solid",color:"#000000"},left:{active:!1,width:{value:1,type:"px"},style:"solid",color:"#000000"},radius:{all:{value:null,type:"px"},topLeft:{value:null,type:"px"},topRight:{value:null,type:"px"},bottomRight:{value:null,type:"px"},bottomLeft:{value:null,type:"px"}}}}},defaultShape:{id:null,title:null,visible:!0,plane:null,pos:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},width:128,height:128,image:{url:null},opacity:1,billboard:!1,userData:null},fn:{init:function(w){if(w.fn.enableLoading(w),g("#ipanorama-app-item").removeAttr("style"),g(window).on("resize",g.proxy(w.fn.onResize,this,w)),w.plan=ipanorama_globals.plan,w.wp_base_url=ipanorama_globals.wp_base_url,w.wp_upload_url=ipanorama_globals.upload_base_url,w.wp_plugin_url=ipanorama_globals.plugin_base_url,w.wp_ajax_url=ipanorama_globals.ajax_url,w.wp_ajax_nonce=ipanorama_globals.ajax_nonce,w.wp_ajax_action_update=ipanorama_globals.ajax_action_update,w.wp_ajax_action_get=ipanorama_globals.ajax_action_get,w.wp_ajax_action_modal=ipanorama_globals.ajax_action_modal,w.wp_ajax_msg_error=ipanorama_globals.ajax_msg_error,w.msg_pro_title=ipanorama_globals.msg_pro_title,w.msg_edit_text=ipanorama_globals.msg_edit_text,w.msg_custom_js_error=ipanorama_globals.msg_custom_js_error,w.wp_item_id=ipanorama_globals.ajax_item_id,ipanorama_globals.config){for(var e,t=g.extend(!0,{},w.defaultConfig,JSON.parse(ipanorama_globals.config)),n=!1,a=0;a<t.scenes.length;a++){t.scenes[a]=g.extend(!0,{},w.defaultScene,t.scenes[a]),t.scenes[a].guid||(t.scenes[a].guid=w.fn.uuid()),t.scenes[a].camera.pos&&(delete t.scenes[a].camera.pos,n=!0),t.scenes[a].audio&&t.scenes[a].audio.url&&((e=g.extend(!0,{},w.defaultTrack)).id=w.fn.uuid(10),e.url=t.scenes[a].audio.url,e.linkSceneGuid=t.scenes[a].guid,e.autoplay=t.scenes[a].audio.autoPlay,e.loop=t.scenes[a].audio.loop,t.audio.tracks.push(e),delete t.scenes[a].audio),w.fn.createSceneStore(t.scenes[a],!1);for(var i=0;i<t.scenes[a].markers.length;i++){if(t.scenes[a].markers[i].pos&&null==t.scenes[a].markers[i].yaw&&null==t.scenes[a].markers[i].pitch&&("flat"!=t.scenes[a].type?(c=t.scenes[a].markers[i].pos,p=d=p=u=void 0,u=180/Math.PI,p=Math.atan2(c.x,-c.z),d=Math.sqrt(c.x*c.x+c.z*c.z),p={yaw:p=(p=p*u%360)<0?360+p:p,pitch:Math.atan2(c.y,d)*u,radius:Math.sqrt(d*d+c.y*c.y)},t.scenes[a].markers[i].yaw=p.yaw-90,t.scenes[a].markers[i].pitch=p.pitch):(t.scenes[a].markers[i].yaw=t.scenes[a].markers[i].pos.x,t.scenes[a].markers[i].pitch=t.scenes[a].markers[i].pos.y),delete t.scenes[a].markers[i].pos),t.scenes[a].markers[i].linkSceneId){for(var o=0;o<t.scenes.length;o++)if(t.scenes[o].id==t.scenes[a].markers[i].linkSceneId){t.scenes[a].markers[i].linkSceneGuid=t.scenes[o].guid;break}delete t.scenes[a].markers[i].linkSceneId}t.scenes[a].markers[i]=g.extend(!0,{},w.defaultMarker,t.scenes[a].markers[i])}for(var r,s,l,i=0;i<t.scenes[a].shapes.length;i++)t.scenes[a].shapes[i]=g.extend(!0,{},w.defaultShape,t.scenes[a].shapes[i]),n&&(r=t.scenes[a].shapes[i],s=new THREE.PlaneGeometry(1,1,1),l=new THREE.MeshNormalMaterial,(s=new THREE.Mesh(s,l)).position.set(r.pos.x,r.pos.y,r.pos.z),s.rotation.x=THREE.Math.degToRad(r.rotate.x),s.rotation.y=THREE.Math.degToRad(r.rotate.y),s.rotation.z=THREE.Math.degToRad(r.rotate.z),l=(new THREE.Matrix4).makeRotationY(Math.PI/2),s.applyMatrix(l),r.pos.x=s.position.x,r.pos.y=s.position.y,r.pos.z=s.position.z,r.rotate.x=THREE.Math.radToDeg(s.rotation.x),r.rotate.y=THREE.Math.radToDeg(s.rotation.y),r.rotate.z=THREE.Math.radToDeg(s.rotation.z))}t.widget.name&&(w.ui.widgetConfigs[t.widget.name]=g.extend(!0,{},t.widget.config)),t.sceneTransition.name&&(w.ui.sceneTransitionConfigs[t.sceneTransition.name]=g.extend(!0,{},t.sceneTransition.config)),w.config=t}var c,u,p,d;if((w.embedCodeWithId=w.fn.getEmbedCode(w,"id"),w.embedCodeWithSlug=w.fn.getEmbedCode(w,"slug"),ipanorama_globals.settings)&&(t=g.extend(!0,{},JSON.parse(ipanorama_globals.settings))))for(var f in t)w.settings.hasOwnProperty(f)&&(w.settings[f]=t[f]);w.$view_info=g("#ipanorama-view-info"),w.$view_info_yaw=g("<input>"),w.$view_info_pitch=g("<input>"),w.$view_info_zoom=g("<input>"),w.$view_info.append(g("<label>").append(g("<span>").text("yaw:"),w.$view_info_yaw),g("<label>").append(g("<span>").text("pitch:"),w.$view_info_pitch),g("<label>").append(g("<span>").text("zoom/fov:"),w.$view_info_zoom)),w.$view_start_point=g("#ipanorama-start-point"),w.$view_start_point.on("click",function(){w.fn.getCameraLookAt(w)}),w.$view_compass_north=g("#ipanorama-compass-north"),w.$view_compass_north.on("click",function(){var e=w.fn.getCameraLookAt(w,!0);e&&(w.ui.activeScene.compass.northOffset=e.yaw,w.rootScope.scan())}),w.$ipanorama=g("#ipanorama-view"),w.$ipanorama.ipanorama({baseUrl:w.wp_plugin_url+"assets/js/lib/ipanorama"});var h=w.$ipanorama.ipanorama("instance");h.setWidget("simple"),h.setSceneTransitionEffect("default"),h.$container.on("ipanorama:scene-after-load",function(e,t){w.fn.updateCamera(w,w.scenes.sceneOld,w.scenes.sceneNew)}),h.$container.on("ipanorama:scene-camera-change",function(e,t){var n=t.scene.control.getLookAt(),t=t.scene.control.getZoom();w.$view_info_yaw.val(n.yaw.toFixed(3)),w.$view_info_pitch.val(n.pitch.toFixed(3)),w.$view_info_zoom.val(t.toFixed(3))}),h.$container.on("ipanorama:scene-point-add",function(e,t){var n,a;t&&t.point&&w.ui.activeScene&&((n=g.extend(!0,{},w.defaultMarker)).id=w.fn.uuid(10),w.ui.activeScene.markers.push(n),n.point=t.point,t.point.marker=n,"flat"==w.ui.activeScene.type?(t.point.marker.yaw=t.point.mesh.position.x,t.point.marker.pitch=t.point.mesh.position.y,t.point.setYawPitch(t.point.marker.yaw,t.point.marker.pitch)):(a=t.point.getYawPitch(),t.point.marker.yaw=a.yaw,t.point.marker.pitch=a.pitch),w.fn.selectMarker(w,n))}),h.$container.on("ipanorama:scene-point-remove",function(e,t){t&&t.point&&w.fn.deleteMarker(w,t.point.marker)}),h.$container.on("ipanorama:scene-point-select",function(e,t){t&&t.point&&w.fn.selectMarker(w,t.point.marker,!1)}),h.$container.on("ipanorama:scene-point-deselect",function(e,t){w.fn.selectMarker(w,null)}),h.$container.on("ipanorama:scene-point-dragend",function(e,t){var n;t&&t.point&&("flat"==w.ui.activeScene.type?(t.point.marker.yaw=t.point.mesh.position.x,t.point.marker.pitch=t.point.mesh.position.y,t.point.setYawPitch(t.point.marker.yaw,t.point.marker.pitch)):(n=t.point.getYawPitch(),t.point.marker.yaw=n.yaw,t.point.marker.pitch=n.pitch),w.rootScope.scan())}),h.$container.on("ipanorama:scene-plane-add",function(e,t){var n;t&&t.plane&&w.ui.activeScene&&((n=g.extend(!0,{},w.defaultShape)).id=w.fn.uuid(10),w.ui.activeScene.shapes.push(n),n.plane=t.plane,(t.plane.shape=n).pos.x=t.plane.mesh.position.x,n.pos.y=t.plane.mesh.position.y,n.pos.z=t.plane.mesh.position.z,n.rotate.x=THREE.Math.radToDeg(t.plane.mesh.rotation.x),n.rotate.y=THREE.Math.radToDeg(t.plane.mesh.rotation.y),n.rotate.z=THREE.Math.radToDeg(t.plane.mesh.rotation.z),w.fn.selectShape(w,n))}),h.$container.on("ipanorama:scene-plane-remove",function(e,t){t&&t.plane&&w.fn.deleteShape(w,t.plane.shape)}),h.$container.on("ipanorama:scene-plane-select",function(e,t){t&&t.plane&&w.fn.selectShape(w,t.plane.shape,!1)}),h.$container.on("ipanorama:scene-plane-deselect",function(e,t){w.fn.selectShape(w,null)}),h.$container.on("ipanorama:scene-plane-dragend",function(e,t){t&&t.plane&&(t.plane.shape.pos.x=t.plane.mesh.position.x,t.plane.shape.pos.y=t.plane.mesh.position.y,t.plane.shape.pos.z=t.plane.mesh.position.z,t.plane.shape.rotate.x=THREE.Math.radToDeg(t.plane.mesh.rotation.x),t.plane.shape.rotate.y=THREE.Math.radToDeg(t.plane.mesh.rotation.y),t.plane.shape.rotate.z=THREE.Math.radToDeg(t.plane.mesh.rotation.z),w.rootScope.scan())}),h.$container.on("ipanorama:transform-mode-changed",function(e,t){t&&t.mode&&(w.ui.transformMode=t.mode,w.rootScope.scan())}),w.rootScope.watch("appData.ui.activeScene",function(e,t){w.scenes.sceneOld=t,w.scenes.sceneNew=e}),w.rootScope.watch("appData.ui.activeScene",function(e,t){var n=w.$ipanorama.ipanorama("instance"),a=!1,i=!1,o=!1,r=null,s=null,l=null,c=null,u=null;if(e){if(t){var p=y.map(e,t);if(p.guid.type==y.VALUE_UPDATED)o=i=a=!0;else if(p.guid.type==y.VALUE_UNCHANGED&&(p.type.type==y.VALUE_UPDATED||p.preload.active.type==y.VALUE_UPDATED||p.images.main.url.type==y.VALUE_UPDATED||p.images.front.url.type==y.VALUE_UPDATED||p.images.back.url.type==y.VALUE_UPDATED||p.images.left.url.type==y.VALUE_UPDATED||p.images.right.url.type==y.VALUE_UPDATED||p.images.top.url.type==y.VALUE_UPDATED||p.images.bottom.url.type==y.VALUE_UPDATED||p.gsv.pano.active.type==y.VALUE_UPDATED||p.gsv.pano.active.data&&p.gsv.pano.id.type==y.VALUE_UPDATED||p.gsv.location.active.type==y.VALUE_UPDATED||p.gsv.location.active.data&&p.gsv.location.lat.type==y.VALUE_UPDATED||p.gsv.location.active.data&&p.gsv.location.lng.type==y.VALUE_UPDATED)&&(a=!0,p.type.type==y.VALUE_UPDATED))switch(p.type.data){case"sphere":case"cube":case"gsv":"flat"!=t.type&&"littleplanet"!=t.type||(o=i=!0);break;case"flat":"sphere"!=t.type&&"cube"!=t.type&&"gsv"!=t.type&&"littleplanet"!=t.type||(o=i=!0);break;case"littleplanet":"sphere"!=t.type&&"cube"!=t.type&&"gsv"!=t.type&&"flat"!=t.type||(o=i=!0)}}else o=i=a=!0;if(a){if(i)for(var d=0;d<w.config.scenes.length;d++)if((u=w.config.scenes[d]).guid==e.guid){r=u.markers;break}if(o)for(d=0;d<w.config.scenes.length;d++)(u=w.config.scenes[d]).guid==e.guid&&(l=u.shapes);switch(e.type){case"sphere":w.scenes.sphere?n.setScene({id:w.scenes.sphere.cfg.id},!1):w.scenes.sphere=n.setScene({type:"sphere"},!1),w.scenes.sphere.load(e.images.main.url),u=w.scenes.sphere,i&&(w.scenes.sphere.removePoints(!0),s=w.scenes.sphere.pointEditor),o&&(w.scenes.sphere.removePlanes(!0),c=w.scenes.sphere.planeEditor);break;case"cubeone":w.scenes.cube?n.setScene({id:w.scenes.cube.cfg.id},!1):w.scenes.cube=n.setScene({type:"cube"},!1),w.scenes.cube.load(e.images.main.url),u=w.scenes.cube,i&&(w.scenes.cube.removePoints(!0),s=w.scenes.cube.pointEditor),o&&(w.scenes.cube.removePlanes(!0),c=w.scenes.cube.planeEditor);break;case"cubesix":w.scenes.cube?n.setScene({id:w.scenes.cube.cfg.id},!1):w.scenes.cube=n.setScene({type:"cube"},!1);var f=[];f.push(e.images.front.url),f.push(e.images.back.url),f.push(e.images.left.url),f.push(e.images.right.url),f.push(e.images.top.url),f.push(e.images.bottom.url),w.scenes.cube.load(f),u=w.scenes.cube,i&&(w.scenes.cube.removePoints(!0),s=w.scenes.cube.pointEditor),o&&(w.scenes.cube.removePlanes(!0),c=w.scenes.cube.planeEditor);break;case"flat":w.scenes.flat?n.setScene({id:w.scenes.flat.cfg.id},!1):w.scenes.flat=n.setScene({type:"flat"},!1),w.scenes.flat.load(e.images.main.url),u=w.scenes.flat,i&&(w.scenes.flat.removePoints(!0),s=w.scenes.flat.pointEditor),o&&(w.scenes.flat.removePlanes(!0),c=w.scenes.flat.planeEditor);break;case"littleplanet":w.scenes.littleplanet?n.setScene({id:w.scenes.littleplanet.cfg.id},!1):w.scenes.littleplanet=n.setScene({type:"littleplanet"},!1),w.scenes.littleplanet.load(e.images.main.url),u=w.scenes.littleplanet,i&&(w.scenes.littleplanet.removePoints(!0),s=w.scenes.littleplanet.pointEditor),o&&(w.scenes.littleplanet.removePlanes(!0),c=w.scenes.littleplanet.planeEditor);break;case"gsv":w.scenes.gsv?n.setScene({id:w.scenes.gsv.cfg.id},!1):w.scenes.gsv=n.setScene({type:"gsv"},!1),e.gsv.pano.active?w.scenes.gsv.load(e.gsv.pano.id):e.gsv.location.active&&w.scenes.gsv.load(e.gsv.location),u=w.scenes.gsv,i&&(w.scenes.gsv.removePoints(!0),s=w.scenes.gsv.pointEditor),o&&(w.scenes.gsv.removePlanes(!0),c=w.scenes.gsv.planeEditor);break;default:return void n.setScene(null)}switch(e.type){case"sphere":case"cubeone":case"flat":case"littleplanet":var h=w.ui.mapScenes.get(e.guid);w.fn.strEquals(e.images.main.url,h.preload.images.main.url)&&e.preload.active==h.preload.active||(h.preload.flag=!0,w.ui.mapScenes.set(e.guid,h))}if(s)for(d=0;d<r.length;d++){var m,v=r[d];v.point=null,v.visible&&((m=s.addPointToCenter(!0)).setYawPitch(v.yaw,v.pitch,500),(v.point=m).marker=v)}if(c){for(d=0;d<l.length;d++){var g,b=l[d];b.plane=null,b.visible&&(g=new IPANORAMA.Plane({pos:b.pos,rotate:b.rotate,image:w.fn.getImageUrl(w,b.image),width:b.width,height:b.height,opacity:b.opacity,billboard:b.billboard}),(b.plane=g).shape=b,u.addPlane(g,!0))}w.ui.transformMode=c.transformControl.mode}}}else n.setScene(null)},{deep:4}),w.rootScope.watch("appData.ui.activeMarker",function(e,t){var n;"undefined"!=typeof tinyMCE&&(g("#wp-ipanorama-tooltip-editor-media-buttons").find(".button:not(.add_media)").css({display:"none"}),g("#wp-ipanorama-popover-editor-media-buttons").find(".button:not(.add_media)").css({display:"none"}),t&&(g("#wp-ipanorama-tooltip-editor-wrap").hasClass("html-active")?t.tooltip.data=g("#ipanorama-tooltip-editor").val():null!==(n=tinyMCE.get("ipanorama-tooltip-editor"))&&(t.tooltip.data=n.getContent()),g("#wp-ipanorama-popover-editor-wrap").hasClass("html-active")?t.popover.data=g("#ipanorama-popover-editor").val():null!==(n=tinyMCE.get("ipanorama-popover-editor"))&&(t.popover.data=n.getContent())),t=e&&e.tooltip.data?e.tooltip.data:"",g("#wp-ipanorama-tooltip-editor-wrap").hasClass("html-active")?g("#ipanorama-tooltip-editor").val(t):null!==(n=tinyMCE.get("ipanorama-tooltip-editor"))&&n.setContent(t),t=e&&e.popover.data?e.popover.data:"",g("#wp-ipanorama-popover-editor-wrap").hasClass("html-active")?g("#ipanorama-popover-editor").val(t):null!==(n=tinyMCE.get("ipanorama-popover-editor"))&&n.setContent(t),e&&w.fn.updateMarkerView(w,e))}),w.rootScope.watch("appData.ui.activeMarker",function(e,t){e&&t&&(t=y.map(e,t),w.$ipanorama.ipanorama("instance"),t.yaw.type==y.VALUE_UPDATED&&t.pitch.type==y.VALUE_UPDATED||(t=e,"flat"==w.ui.activeScene.type?(t.point.mesh.position.x=t.point.yaw=t.yaw,t.point.mesh.position.y=t.point.pitch=t.pitch):t.point.setYawPitch(t.yaw,t.pitch,500)))},{deep:2}),w.rootScope.watch("appData.ui.activeShape",function(e,t){var n,a;e&&t&&(t=y.map(e,t),n=w.$ipanorama.ipanorama("instance"),t.pos.x.type==y.VALUE_UPDATED&&n.viewer.sceneActive&&(e.plane.mesh.position.x=e.pos.x),t.pos.y.type==y.VALUE_UPDATED&&n.viewer.sceneActive&&(e.plane.mesh.position.y=e.pos.y),t.pos.z.type==y.VALUE_UPDATED&&n.viewer.sceneActive&&(e.plane.mesh.position.z=e.pos.z),t.rotate.x.type!=y.VALUE_UPDATED&&t.rotate.y.type!=y.VALUE_UPDATED&&t.rotate.z.type!=y.VALUE_UPDATED||n.viewer.sceneActive&&(e.plane.mesh.rotation.x=THREE.Math.degToRad(e.rotate.x),e.plane.mesh.rotation.y=THREE.Math.degToRad(e.rotate.y),e.plane.mesh.rotation.z=THREE.Math.degToRad(e.rotate.z)),t.width.type!=y.VALUE_UPDATED&&t.height.type!=y.VALUE_UPDATED||n.viewer.sceneActive&&(n.viewer.sceneActive.removePlane(e.plane,!0),a=new IPANORAMA.Plane({pos:e.pos,rotate:e.rotate,image:w.fn.getImageUrl(w,e.image),width:e.width,height:e.height,opacity:e.opacity,billboard:e.billboard}),(e.plane=a).shape=e,n.viewer.sceneActive.addPlane(a,!0)),t.image.url.type==y.VALUE_UPDATED&&n.viewer.sceneActive&&e.plane.load(w.fn.getImageUrl(w,e.image)))},{deep:4}),w.rootScope.watch("appData.ui.markerSections",function(e,t){!e.view&&w.ui.activeMarker&&w.fn.updateMarkerView(w,w.ui.activeMarker)},{deep:2}),w.rootScope.watch("appData.config.widget.name",function(e,t){if(e){for(var n in w.ui.widgetConfigs)if(e.toLowerCase()==w.config.widget.name.toLowerCase()){w.ui.widgetConfigs.hasOwnProperty(n)&&(w.config.widget.config=g.extend(!0,{},w.ui.widgetConfigs[n]));break}}else w.config.widget.config=null;w.fn.updateActiveWidget(w)}),w.rootScope.watch("appData.config.sceneTransition.name",function(e,t){if(e){for(var n in w.ui.sceneTransitionConfigs)if(e.toLowerCase()==w.config.sceneTransition.name.toLowerCase()){w.ui.sceneTransitionConfigs.hasOwnProperty(n)&&(w.config.sceneTransition.config=g.extend(!0,{},w.ui.sceneTransitionConfigs[n]));break}}else w.config.sceneTransition.config=null;w.fn.updateActiveTransition(w)}),w.rootScope.watch("appData.config.background",function(e,t){w.$ipanorama.find(".ipnrm-preview").css({"background-color":e.color||"","background-image":e.image.url?"url("+e.image.url+")":"","background-size":e.size||"","background-repeat":e.repeat||"","background-position":e.position||""})},{deep:3}),w.fn.loadData(w,"themes").done(function(e){w.themes=e.list}).always(function(){w.rootScope.scan(),w.fn.disableLoading(w)}),w.fn.loadData(w,"widgets").done(function(e){w.widgets=e.list,w.fn.updateActiveWidget(w)}).always(function(){w.rootScope.scan(),w.fn.disableLoading(w)}),w.fn.loadData(w,"transitions").done(function(e){w.sceneTransitions=e.list,w.fn.updateActiveTransition(w)}).always(function(){w.rootScope.scan(),w.fn.disableLoading(w)})},updateActiveWidget:function(e){if(e.widgets){for(var t=!0,n=0;n<e.widgets.length;n++){var a=e.widgets[n];if(a.id==e.config.widget.name){e.ui.activeWidget=a,t=!1;break}}t&&(e.ui.activeWidget=null)}else e.ui.activeWidget=null},updateActiveTransition:function(e){if(e.sceneTransitions){for(var t=!0,n=0;n<e.sceneTransitions.length;n++){var a=e.sceneTransitions[n];if(a.id==e.config.sceneTransition.name){e.ui.activeTransition=a,t=!1;break}}t&&(e.ui.activeTransition=null)}else e.ui.activeTransition=null},updateCamera:function(e,t,n){var a=null,i=null,o=null;if(t){switch(o=e.ui.mapScenes.get(t.guid),t.type){case"sphere":a=e.scenes.sphere.control.getLookAt(),i=e.scenes.sphere.control.getZoom();break;case"cubeone":case"cubesix":a=e.scenes.cube.control.getLookAt(),i=e.scenes.cube.control.getZoom();break;case"gsv":a=e.scenes.gsv.control.getLookAt(),i=e.scenes.gsv.control.getZoom();break;case"littleplanet":a=e.scenes.littleplanet.control.getLookAt(),i=e.scenes.littleplanet.control.getZoom();break;case"flat":a=e.scenes.flat.control.getLookAt(),i=e.scenes.flat.control.getZoom()}a&&(o.camera.lookAt.yaw=a.yaw,o.camera.lookAt.pitch=a.pitch,o.camera.zoom=i,e.ui.mapScenes.set(t.guid,o))}if(n)switch(a=(o=e.ui.mapScenes.get(n.guid)).camera.lookAt,i=o.camera.zoom,n.type){case"sphere":e.scenes.sphere.control.lookAt(a),e.scenes.sphere.control.setZoom(i);break;case"cubeone":case"cubesix":e.scenes.cube.control.lookAt(a),e.scenes.cube.control.setZoom(i);break;case"gsv":e.scenes.gsv.control.lookAt(a),e.scenes.gsv.control.setZoom(i);break;case"littleplanet":e.scenes.littleplanet.control.lookAt(a),e.scenes.littleplanet.control.setZoom(i);break;case"flat":e.scenes.flat.control.lookAt(a),e.scenes.flat.control.setZoom(i)}},enableLoading:function(e){e.loadingCounter++,g("#ipanorama-app-item").removeClass("ipanorama-active")},disableLoading:function(e){e.loadingCounter--,e.loadingCounter<=0&&(e.loadingCounter=0,setTimeout(function(){g("#ipanorama-app-item").addClass("ipanorama-active")},1e3))},loadData:function(a,e,t){var i=g.Deferred();return g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_get,type:e,id:t},success:function(e){e&&e.success?i.resolve(e.data):this.error()},error:function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error"),i.resolve(null)}}),i.promise()},getPluginConfig:function(t){for(var e={},n=(e.title=t.config.title,e.slug=t.config.slug,e.wp_plugin_url=t.wp_plugin_url,e.theme=t.config.theme,e.widget={name:t.config.widget.name,config:t.config.widget.config},e.sceneTransition={name:t.config.sceneTransition.name,config:t.config.sceneTransition.config,duration:t.config.sceneTransition.duration},e.preload={image:t.fn.getImageUrl(t,t.config.preload.image),timeout:t.config.preload.timeout,noProgressEvent:t.config.preload.noProgressEvent},e.audio={enabled:t.config.audio.enabled,html5:t.config.audio.html5,autoplay:t.config.audio.autoplay,loop:t.config.audio.loop,mute:t.config.audio.mute,volume:t.config.audio.volume,tracks:[]},[]),a=0;a<t.config.audio.tracks.length;a++){var i=t.config.audio.tracks[a];i.enabled&&n.push(t.fn.getPluginTrackConfig(t,i))}e.audio.tracks=0<n.length?n:[],e.viewerMode=t.config.viewerMode,e.autoLoad=t.config.autoLoad,e.className=t.config.class,e.flags={customcss:t.config.customCSS.active,fontawesome:!1,googlemaps:!1,effects:!1};for(var o=[],a=0;a<t.config.scenes.length;a++){var r=t.config.scenes[a];r.visible&&o.push(t.fn.getPluginSceneConfig(t,r,e.flags))}if(e.scenes=0<o.length?o:[],t.config.customJS.active){e.onLoad=t.config.customJS.data;try{new Function(e.onLoad)}catch(e){t.fn.showNotice(t,t.msg_custom_js_error+": "+e.message,"notice-error")}}return e},getPluginSceneConfig:function(e,t,n){for(var a,i={},o=(i.guid=t.guid,i.id=t.id,t.title.active&&(i.title=t.title.data),i.type="cubeone"==t.type||"cubesix"==t.type?"cube":t.type,"cubesix"==t.type?(i.image=[],i.image.push(e.fn.getImageUrl(e,t.images.front)),i.image.push(e.fn.getImageUrl(e,t.images.back)),i.image.push(e.fn.getImageUrl(e,t.images.left)),i.image.push(e.fn.getImageUrl(e,t.images.right)),i.image.push(e.fn.getImageUrl(e,t.images.top)),i.image.push(e.fn.getImageUrl(e,t.images.bottom))):"gsv"==t.type?(n.googlemaps=!0,t.gsv.pano.active?i.panoId=t.gsv.pano.id:t.gsv.location.active&&(i.location={lat:t.gsv.location.lat,lng:t.gsv.location.lng})):i.image=e.fn.getImageUrl(e,t.images.main),(a=e.fn.getImageUrl(e,t.images.thumb))&&(i.imageThumb=a),i.camera={lookAt:{yaw:t.camera.lookAt.yaw,pitch:t.camera.lookAt.pitch},zoom:t.camera.zoom,save:t.camera.save,shared:t.camera.shared},t.userData&&(i.userData=t.userData),i.autoRotate={enabled:t.autoRotate.enabled,inactivityDelay:t.autoRotate.inactivityDelay,speedX:t.autoRotate.speedX,speedY:t.autoRotate.speedY,speedZ:t.autoRotate.speedZ},i.compass={enabled:t.compass.enabled,northOffset:t.compass.northOffset},i.noZoom=t.noZoom,i.noRotate=t.noRotate,i.noKeys=t.noKeys,i.noGyroscope=t.noGyroscope,[]),r=0;r<t.markers.length;r++){var s=t.markers[r];s.visible&&o.push(e.fn.getPluginMarkerConfig(e,s,n))}i.markers=o;for(var l=[],r=0;r<t.shapes.length;r++){var c=t.shapes[r];c.visible&&l.push(e.fn.getPluginShapeConfig(e,c,n))}return i.shapes=l,i},getPluginMarkerConfig:function(e,t,n){var a={};if(a.id=t.id,a.title=t.title,a.yaw=t.yaw,a.pitch=t.pitch,t.userData&&(a.userData=t.userData),t.link&&(a.link=t.link,a.linkNewWindow=t.linkNewWindow),t.linkSceneGuid)for(var i=0;i<e.config.scenes.length;i++){var o=e.config.scenes[i];if(o.guid==t.linkSceneGuid){a.linkSceneId=o.id;break}}return a.autoFocus={enabled:t.autoFocus.active,duration:t.autoFocus.duration},t.view.active&&t.view.icon.name&&(n.fontawesome=!0),t.tooltip.active&&(a.tooltip={},a.tooltip.enabled=t.tooltip.active,t.tooltip.placement&&(a.tooltip.placement=t.tooltip.placement),0==t.tooltip.offset.x&&0==t.tooltip.offset.y||(a.tooltip.offset={x:t.tooltip.offset.x,y:t.tooltip.offset.y}),t.tooltip.width&&(a.tooltip.width=t.tooltip.width),a.tooltip.autoWidth=t.tooltip.autoWidth,a.tooltip.trigger=t.tooltip.trigger,a.tooltip.followCursor=t.tooltip.followCursor,a.tooltip.interactive=t.tooltip.interactive,a.tooltip.showOnInit=t.tooltip.showOnInit,t.tooltip.showAnimation&&(a.tooltip.showAnimation=t.tooltip.showAnimation,n.effects=!0),t.tooltip.hideAnimation&&(a.tooltip.hideAnimation=t.tooltip.hideAnimation,n.effects=!0),t.tooltip.duration&&(a.tooltip.duration=t.tooltip.duration),t.tooltip.class&&(a.tooltip.class=t.tooltip.class)),t.popover.active&&(a.popover={},a.popover.enabled=t.popover.active,a.popover.type=t.popover.type,a.popover.mobileType=t.popover.mobileType,a.popover.trigger=t.popover.trigger,a.popover.showOnInit=t.popover.showOnInit,a.popover.closeOutside=t.popover.closeOutside,t.popover.showAnimation&&(a.popover.showAnimation=t.popover.showAnimation,n.effects=!0),t.popover.hideAnimation&&(a.popover.hideAnimation=t.popover.hideAnimation,n.effects=!0),t.popover.duration&&(a.popover.duration=t.popover.duration),t.popover.class&&(a.popover.class=t.popover.class)),(n=e.fn.getImageUrl(e,t.image))&&(a.image=n),t.class&&(a.class=t.class),a},getPluginShapeConfig:function(e,t,n){var a={};return a.id=t.id,t.title&&(a.title=t.title),a.plane={pos:{x:t.pos.x,y:t.pos.y,z:t.pos.z},rotate:{x:t.rotate.x,y:t.rotate.y,z:t.rotate.z},width:t.width,height:t.height,image:e.fn.getImageUrl(e,t.image),opacity:t.opacity,billboard:t.billboard},t.userData&&(a.userData=t.userData),a},getPluginTrackConfig:function(e,t){var n={};if(n.id=t.id,n.src=t.url,n.title=t.title,n.loop=t.loop,n.autoplay=t.autoplay,t.linkSceneGuid)for(var a=0;a<e.config.scenes.length;a++){var i=e.config.scenes[a];if(i.guid==t.linkSceneGuid){n.sceneId=i.id;break}}return n},saveConfig:function(a){a.fn.enableLoading(a),a.fn.saveEditorsData(a);var e=a.fn.clearConfigData(a,g.extend(!0,{},a.config)),e=JSON.stringify(e),t=a.fn.getPluginConfig(a),t=JSON.stringify(t);g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_update,type:"config",id:a.wp_item_id,data:e,config:t}}).done(function(e){var t;e?(e.data&&e.data.id&&((t=new URL(window.location.href)).searchParams.set("id",e.data.id),window.history.replaceState(null,null,t),a.wp_item_id=e.data.id),a.fn.savePrealodImages(a),a.fn.showNotice(a,e.data.msg,e.success?"notice-success":"notice-error"),a.rootScope.scan()):a.fn.showNotice(a,a.wp_ajax_msg_error,"notice-error")}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){a.fn.disableLoading(a)})},savePrealodImages:function(r){for(var s=0,e=0;e<r.config.scenes.length;e++){var t=r.config.scenes[e];(n=r.ui.mapScenes.get(t.guid)).preload.flag&&t.preload.active&&s++}for(e=0;e<r.config.scenes.length;e++){var n,t=r.config.scenes[e];(n=r.ui.mapScenes.get(t.guid)).preload.flag&&t.preload.active&&(r.fn.enableLoading(r),r.fn.loadImage(t.images.main.url).then(g.proxy(function(e,t,n){var a=n.width/n.height,i=document.createElement("canvas"),o=i.getContext("2d");i.width=n.width>n.height?512:512*a,i.height=n.width<n.height?512:512/a,o.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height),r.fn.enableLoading(r),g.ajax({url:r.wp_ajax_url,type:"POST",data:{nonce:r.wp_ajax_nonce,action:r.wp_ajax_action_update,id:r.wp_item_id,type:"preloadimage",scene:JSON.stringify({guid:e.guid,type:e.type}),image:i.toDataURL("image/jpeg")}}).done(function(e){e&&1==s&&r.fn.showNotice(r,e.data.msg,e.success?"notice-success":"notice-error")}).fail(function(e,t,n){e=r.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");r.fn.showNotice(r,e,"notice-error")}).always(function(){s--,r.fn.disableLoading(r)}),t.preload.flag=!1,t.preload.active=e.preload.active,t.preload.images.main.url=e.images.main.url,r.ui.mapScenes.set(e.guid,t)},this,t,n)).catch(function(e){console.error(e)}).finally(function(){r.fn.disableLoading(r)}))}},loadImage:function(a){return new Promise(function(e,t){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){e(this)},n.onerror=function(e){t(e)},n.src=a})},clearConfigData:function(e,t){for(var n=0;n<t.scenes.length;n++){for(var a=t.scenes[n],i=0;i<a.markers.length;i++)delete a.markers[i].point;for(i=0;i<a.shapes.length;i++)delete a.shapes[i].plane}return t},saveEditorsData:function(e){e.ui.activeMarker&&(g("#wp-ipanorama-tooltip-editor-wrap").hasClass("html-active")?e.ui.activeMarker.tooltip.data=g("#ipanorama-tooltip-editor").val():null!==(t=tinyMCE.get("ipanorama-tooltip-editor"))&&(e.ui.activeMarker.tooltip.data=t.getContent()),g("#wp-ipanorama-popover-editor-wrap").hasClass("html-active")?e.ui.activeMarker.popover.data=g("#ipanorama-popover-editor").val():null!==(t=tinyMCE.get("ipanorama-popover-editor"))&&(e.ui.activeMarker.popover.data=t.getContent()));var t=g("#ipanorama-notepad-css"),t=(t.length&&(t=ace.edit(t.get(0)),e.config.customCSS.data=t.getSession().getValue()),g("#ipanorama-notepad-js"));t.length&&(t=ace.edit(t.get(0)),e.config.customJS.data=t.getSession().getValue())},loadConfigFromJson:function(e,t){if(t){var n=JSON.parse(t);e.ui.mapScenes.clear();for(var a=0;a<n.scenes.length;a++){n.scenes[a]=g.extend(!0,{},e.defaultScene,n.scenes[a]),n.scenes[a].guid||(n.scenes[a].guid=e.fn.uuid()),e.fn.createSceneStore(n.scenes[a]);for(var i=0;i<n.scenes[a].markers.length;i++)n.scenes[a].markers[i]=g.extend(!0,{},e.defaultMarker,n.scenes[a].markers[i]);for(i=0;i<n.scenes[a].shapes.length;i++)n.scenes[a].shapes[i]=g.extend(!0,{},e.defaultShape,n.scenes[a].shapes[i])}n.widget&&n.widget.name&&(e.ui.widgetConfigs[n.widget.name]=g.extend(!0,{},n.widget.config)),n.sceneTransition&&n.sceneTransition.name&&(e.ui.sceneTransitionConfigs[n.sceneTransition.name]=g.extend(!0,{},n.sceneTransition.config)),e.config=g.extend(!0,{},e.defaultConfig,n),e.rootScope.scan()}},loadConfigFromFile:function(e){var t=g("#ipanorama-load-config-from-file").off("change");t.one("change",g.proxy(function(t,e){var n=e.target.files[0];e.target.value="",n&&((e=new FileReader).onload=g.proxy(function(e){e=e.target.result;t.fn.loadConfigFromJson(t,e)},this),e.readAsText(n))},this,e)),t.click()},saveConfigToFile:function(e){var t=e.fn.clearConfigData(e,g.extend(!0,{},e.config)),t=JSON.stringify(t),e=e.wp_item_id?"ipanorama_config_"+e.wp_item_id+".json":"ipanorama_config.json",t=new File([t],e,{type:"application/json;charset=utf-8"});a(t)},showNotice:function(e,t,n){var a=g("#ipanorama-messages"),i=g("<div>").addClass("notice is-dismissible").addClass(n),n=g("<p>").html(t),t=g("<button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function o(){clearTimeout(i.data("timer")),i.fadeTo(100,0,function(){i.slideUp(100,function(){i.remove()})})}i.data("timer",setTimeout(o,8e3)),t.click(function(e){e.preventDefault(),o()}),i.append(n,t),a.append(i)},createBlob:function(e,t,n){return new Blob([t],{type:n})},createObjectURL:function(e,t,n){e=e.fn.createBlob(e,t,n);return URL.createObjectURL(e)},getPrewiewPageUrl:function(e){return new Url(e.wp_base_url+"/ipanorama/virtualtour/"+e.wp_item_id+"?mode=preview").toString()},getEmbedCode:function(e,t){var n=null;switch(t){case"id":n=new Url(e.wp_base_url+"/ipanorama/virtualtour/"+e.wp_item_id);break;case"slug":n=new Url(e.wp_base_url+"/ipanorama/virtualtour/"+e.config.slug)}return'<iframe width="560" height="315" src="'+n+'" frameborder="0" allowfullscreen></iframe>'},preview:function(e){window.open(e.fn.getPrewiewPageUrl(e),"_blank")},getImageUrl:function(e,t,n){var a=null;return t&&t.url&&0<t.url.length?(a=t.url,"style"==n&&(a="url("+a+")")):"style"==n&&(a="none"),a},selectImage:function(n,a,i){n.wpFileFrameImage&&(n.wpFileFrameImage.detach(),n.wpFileFrameImage=null),n.wpFileFrameImage=wp.media.frames.file_frame=wp.media({library:{type:["image"]},multiple:!1}),n.wpFileFrameImage.on("select",function(e){var t=n.wpFileFrameImage.state().get("selection").first().toJSON().url;i.url=t,a.scan()}),n.wpFileFrameImage.open()},selectAudio:function(n,a,i){n.wpFileFrameAudio&&(n.wpFileFrameAudio.detach(),n.wpFileFrameAudio=null),n.wpFileFrameAudio=wp.media.frames.file_frame=wp.media({library:{type:["audio"]},multiple:!1}),n.wpFileFrameAudio.on("select",function(e){var t=n.wpFileFrameAudio.state().get("selection").first().toJSON().url;i.url=t,a.scan()}),n.wpFileFrameAudio.open()},toggleGSVSourceType:function(e,t){var n,a=e.ui.activeScene.gsv;for(n in a)a.hasOwnProperty(n)&&(a[n].active=!1);e.ui.activeScene.gsv[t].active=!0},setCameraLookAt:function(e){if(null!=e.ui.activeScene){var t={yaw:e.ui.activeScene.camera.lookAt.yaw,pitch:e.ui.activeScene.camera.lookAt.pitch};switch(e.ui.activeScene.type){case"sphere":e.scenes.sphere.control.lookAt(t,1e3);break;case"cubeone":case"cubesix":e.scenes.cube.control.lookAt(t,1e3);break;case"gsv":e.scenes.gsv.control.lookAt(t,1e3);break;case"littleplanet":e.scenes.littleplanet.lookAt(t,1e3);break;case"flat":e.scenes.flat.control.lookAt(t,1e3)}}},getCameraLookAt:function(e,t){if(null!=e.ui.activeScene){var n={yaw:0,pitch:0};switch(e.ui.activeScene.type){case"sphere":n=e.scenes.sphere.control.getLookAt();break;case"cubeone":case"cubesix":n=e.scenes.cube.control.getLookAt();break;case"gsv":n=e.scenes.gsv.control.getLookAt();break;case"littleplanet":n=e.scenes.littleplanet.control.getLookAt();break;case"flat":n=e.scenes.flat.control.getLookAt()}if(t)return n;e.ui.activeScene.camera.lookAt.yaw=n.yaw,e.ui.activeScene.camera.lookAt.pitch=n.pitch,e.rootScope.scan()}},setCameraZoom:function(e){if(null!=e.ui.activeScene){var t=e.ui.activeScene.camera.zoom||0;switch(e.ui.activeScene.type){case"sphere":e.scenes.sphere.control.setZoom(t);break;case"cubeone":case"cubesix":e.scenes.cube.control.setZoom(t);break;case"gsv":e.scenes.gsv.control.setZoom(t);break;case"littleplanet":e.scenes.littleplanet.control.setZoom(t);break;case"flat":e.scenes.flat.control.setZoom(t)}}},getCameraZoom:function(e){if(null!=e.ui.activeScene){var t=1;switch(e.ui.activeScene.type){case"sphere":t=e.scenes.sphere.control.getZoom();break;case"cubeone":case"cubesix":t=e.scenes.cube.control.getZoom();break;case"gsv":t=e.scenes.gsv.control.getZoom();break;case"littleplanet":t=e.scenes.littleplanet.control.getZoom();break;case"flat":t=e.scenes.flat.control.getZoom()}e.ui.activeScene.camera.zoom=t,e.rootScope.scan()}},onTab:function(e,t){if(!e.ui.tabs[t]){var n,a=e.ui.tabs;for(n in a)a.hasOwnProperty(n)&&(a[n]=!1);switch(e.ui.tabs[t]=!0,e.fn.saveEditorsData(e),e.rootScope.scan(),t){case"general":case"scenes":case"markers":case"shapes":break;case"customCSS":var i=g("#ipanorama-notepad-css"),i=ace.edit(i.get(0));i.$blockScrolling=1/0,i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/css"),e.settings.themeCSS&&i.setTheme("ace/theme/"+e.settings.themeCSS),e.config.customCSS.data&&i.getSession().setValue(e.config.customCSS.data);break;case"customJS":i=g("#ipanorama-notepad-js"),i=ace.edit(i.get(0));i.$blockScrolling=1/0,i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/javascript"),e.settings.themeJavaScript&&i.setTheme("ace/theme/"+e.settings.themeJavaScript),e.config.customJS.data&&i.getSession().setValue(e.config.customJS.data)}if(e.ui.activeScene){var o=null,r=null;switch(e.ui.activeScene.type){case"sphere":o=e.scenes.sphere.pointEditor,r=e.scenes.sphere.planeEditor;break;case"cubeone":case"cubesix":o=e.scenes.cube.pointEditor,r=e.scenes.cube.planeEditor;break;case"flat":o=e.scenes.flat.pointEditor,r=e.scenes.flat.planeEditor;break;case"littleplanet":o=e.scenes.littleplanet.pointEditor,r=e.scenes.littleplanet.planeEditor;break;case"gsv":o=e.scenes.gsv.pointEditor,r=e.scenes.gsv.planeEditor}switch(t){case"markers":o&&(o.enabled=!0),r&&(r.enabled=!1);break;case"shapes":o&&(o.enabled=!1),r&&(r.enabled=!0);break;default:o&&(o.enabled=!1),r&&(r.enabled=!1)}o&&o.detach(),r&&r.detach()}}},onGeneralTab:function(e,t){e.ui.generalTab[t]=!e.ui.generalTab[t]},onMarkerTab:function(e,t){if(!e.ui.markerTabs[t]){var n,a=e.ui.markerTabs;for(n in a)a.hasOwnProperty(n)&&(a[n]=!1);e.ui.markerTabs[t]=!0}},onShapeTab:function(e,t){if(!e.ui.shapeTabs[t]){var n,a=e.ui.shapeTabs;for(n in a)a.hasOwnProperty(n)&&(a[n]=!1);e.ui.shapeTabs[t]=!0}},onBorderTab:function(e,t){if(!e.ui.borderTabs[t]){var n,a=e.ui.borderTabs;for(n in a)a.hasOwnProperty(n)&&(a[n]=!1);e.ui.borderTabs[t]=!0}},onResize:function(e,t){},onTransformMode:function(e,t){e.ui.transformMode=t;e=e.$ipanorama.ipanorama("instance");e.viewer.sceneActive&&e.viewer.sceneActive.planeEditor&&(e.viewer.sceneActive.planeEditor.transformControl.mode=t)},toggleFullscreen:function(e){g("#ipanorama-app-item").toggleClass("ipanorama-fullscreen")},copyToClipboard:function(e,t){t=g(t);if(0!=t.length){var n=t.val();if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",n);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var a=document.createElement("textarea");a.textContent=n,a.style.position="fixed",document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(e){console.warn("Copy to clipboard failed.",e)}finally{document.body.removeChild(a)}}t.select()}},toggleSidebarPanel:function(e){e.ui.sidebar=!e.ui.sidebar,e.rootScope.scan()},onSidebarResizeStart:function(e,t){t.preventDefault(),t.stopPropagation(),e.ui.sidebarResize.initX=t.pageX,e.ui.sidebarResize.lastX=t.pageX,e.ui.sidebarResize.width=e.ui.sidebarWidth,g("body").on("mousemove",g.proxy(e.fn.onSidebarResize,this,e)),g("body").on("mouseup",g.proxy(e.fn.onSidebarResizeEnd,this,e)),g("body").on("mouseleave",g.proxy(e.fn.onSidebarResizeEnd,this,e))},onSidebarResize:function(e,t){t.preventDefault(),t.stopPropagation();var n=t.pageX-e.ui.sidebarResize.lastX;e.ui.sidebarResize.lastX=t.pageX,e.ui.sidebarResize.width+=n,200<=e.ui.sidebarResize.width&&e.ui.sidebarResize.width<=800&&(e.ui.sidebarWidth=e.ui.sidebarResize.width,e.rootScope.scan())},onSidebarResizeEnd:function(e,t){t.preventDefault(),t.stopPropagation(),g("body").off("mousemove",g.proxy(e.fn.onSidebarResize,this,e)),g("body").off("mouseup",g.proxy(e.fn.onSidebarResizeEnd,this,e)),g("body").off("mouseleave",g.proxy(e.fn.onSidebarResizeEnd,this,e)),e.ui.sidebarResize.initX=null,e.ui.sidebarResize.lastX=null,e.ui.sidebarResize.width=null},selectScene:function(e,t){e.ui.activeScene=t,e.ui.activeMarker=null,e.ui.activeShape=null,e.rootScope.scan()},isSceneActive:function(e,t){return Object.is(e.ui.activeScene,t)},onSceneItemClick:function(e,t){e.fn.isSceneActive(e,t)?e.ui.activeScene=null:e.fn.selectScene(e,t)},onSceneKeyDown:function(e,t,n){switch(n.preventDefault(),n.keyCode){case 38:g(n.target).prev().focus().click();break;case 40:g(n.target).next().focus().click()}},toggleSceneVisible:function(e,t){t.visible=!t.visible},createSceneStore:function(e,t){t={camera:{lookAt:{yaw:e.camera.lookAt.yaw,pitch:e.camera.lookAt.pitch}},preload:{flag:void 0===t||t,active:e.preload.active,images:{main:{url:e.images.main.url},front:{url:e.images.front.url},back:{url:e.images.back.url},left:{url:e.images.left.url},right:{url:e.images.right.url},top:{url:e.images.top.url},bottom:{url:e.images.bottom.url}}}};n.ui.mapScenes.set(e.guid,t)},addScene:function(e){var t=g.extend(!0,{},e.defaultScene);t.guid=e.fn.uuid(),t.id=e.fn.uuid(10),e.fn.createSceneStore(t),e.config.scenes.push(t),e.fn.selectScene(e,t)},copyScene:function(e){if(null!=e.ui.activeScene){for(var t=null,n=e.config.scenes.length,a=null,i=0;i<n;i++)if(a=e.config.scenes[i],Object.is(e.ui.activeScene,a)){t=i;break}null!=t&&((a=g.extend(!0,{},a)).guid=e.fn.uuid(),a.id=e.fn.uuid(10),a.title.data=(a.title.data||"")+" [copy]",e.fn.createSceneStore(a),e.config.scenes.splice(t+1,0,a),e.fn.selectScene(e,a))}},updownScene:function(e,t){if(null!=e.ui.activeScene){for(var n=null,a=e.config.scenes.length,i=null,o=0;o<a;o++)if(i=e.config.scenes[o],Object.is(e.ui.activeScene,i)){n=o;break}if(null!=n)if("up"==t&&0<n)e.config.scenes[n]=e.config.scenes[n-1],e.config.scenes[n-1]=i;else if("down"==t&&n<a-1)e.config.scenes[n]=e.config.scenes[n+1],e.config.scenes[n+1]=i;else if("start"==t&&0<n)for(o=n;0<o;o--)i=e.config.scenes[o],e.config.scenes[o]=e.config.scenes[o-1],e.config.scenes[o-1]=i;else if("end"==t&&n<a-1)for(o=n;o<a-1;o++)i=e.config.scenes[o],e.config.scenes[o]=e.config.scenes[o+1],e.config.scenes[o+1]=i}},deleteScene:function(e){if(null!=e.ui.activeScene){for(var t,n=null,a=e.config.scenes.length,i=0;i<a;i++){var o=e.config.scenes[i];if(Object.is(e.ui.activeScene,o)){n=i;break}}null!=n&&(0<=(t=n)&&n<a&&(e.config.scenes.splice(n,1),n==a-1&&1<a?t=a-2:1==a&&(t=null)),e.fn.selectScene(e,e.config.scenes[t]))}},onSceneSection:function(e,t){e.ui.sceneSections[t]=!e.ui.sceneSections[t]},selectMarker:function(e,t,n){var a;e.fn.isMarkerActive(e,t)||(e.ui.activeMarker=t,e.rootScope.scan(),a=e.$ipanorama.ipanorama("instance"),t&&a.viewer.sceneActive&&a.viewer.sceneActive.pointEditor&&a.viewer.sceneActive.pointEditor.attach(t.point)),n&&(a=e.$ipanorama.ipanorama("instance")).viewer.sceneActive.lookAt({yaw:t.yaw,pitch:t.pitch},1e3)},isMarkerActive:function(e,t){return Object.is(e.ui.activeMarker,t)},onMarkerItemClick:function(e,t){var n;e.fn.isMarkerActive(e,t)?(e.ui.activeMarker=null,(n=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&n.viewer.sceneActive.pointEditor&&n.viewer.sceneActive.pointEditor.detach()):e.fn.selectMarker(e,t)},toggleMarkerVisible:function(e,t){t.visible=!t.visible,e.fn.updateMarkerPointState(e,e.ui.activeScene)},addMarker:function(e){var t,n,a;null!=e.ui.activeScene&&((t=g.extend(!0,{},e.defaultMarker)).id=e.fn.uuid(10),e.ui.activeScene.markers.push(t),(a=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&a.viewer.sceneActive.pointEditor&&(n=a.viewer.sceneActive.pointEditor.addPointToCenter(!0),"flat"==a.viewer.sceneActive.cfg.type?(t.yaw=n.cfg.pos.x,t.pitch=n.cfg.pos.y,n.mesh.position.x=n.yaw=t.yaw,n.mesh.position.y=n.pitch=t.pitch):(a=n.getYawPitch(),t.yaw=a.yaw,t.pitch=a.pitch,n.setYawPitch(t.yaw,t.pitch,500)),(t.point=n).marker=t),e.fn.selectMarker(e,t))},copyMarker:function(e){if(null!=e.ui.activeScene&&null!=e.ui.activeMarker){for(var t,n=null,a=e.ui.activeScene.markers.length,i=null,o=0;o<a;o++)if(i=e.ui.activeScene.markers[o],Object.is(e.ui.activeMarker,i)){n=o;break}null!=n&&((i=g.extend(!0,{},i)).id=e.fn.uuid(10),i.title=(i.title||"")+" [copy]",e.ui.activeScene.markers.splice(n+1,0,i),(t=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&t.viewer.sceneActive.pointEditor&&((t=t.viewer.sceneActive.pointEditor.addPointToCenter(!0)).setYawPitch(i.yaw,i.pitch,500),(i.point=t).marker=i),e.fn.selectMarker(e,i))}},updownMarker:function(e,t){if(null!=e.ui.activeScene&&null!=e.ui.activeMarker){for(var n=null,a=e.ui.activeScene.markers.length,i=null,o=0;o<a;o++)if(i=e.ui.activeScene.markers[o],Object.is(e.ui.activeMarker,i)){n=o;break}if(null!=n)if("up"==t&&0<n)e.ui.activeScene.markers[n]=e.ui.activeScene.markers[n-1],e.ui.activeScene.markers[n-1]=i;else if("down"==t&&n<a-1)e.ui.activeScene.markers[n]=e.ui.activeScene.markers[n+1],e.ui.activeScene.markers[n+1]=i;else if("start"==t&&0<n)for(o=n;0<o;o--)i=e.ui.activeScene.markers[o],e.ui.activeScene.markers[o]=e.ui.activeScene.markers[o-1],e.ui.activeScene.markers[o-1]=i;else if("end"==t&&n<a-1)for(o=n;o<a-1;o++)i=e.ui.activeScene.markers[o],e.ui.activeScene.markers[o]=e.ui.activeScene.markers[o+1],e.ui.activeScene.markers[o+1]=i}},deleteMarker:function(e){if(null!=e.ui.activeScene&&null!=e.ui.activeMarker){for(var t,n,a=null,i=null,o=e.ui.activeScene.markers.length,r=0;r<o;r++)if(i=e.ui.activeScene.markers[r],Object.is(e.ui.activeMarker,i)){a=r;break}null!=a&&(0<=(t=a)&&a<o&&(e.ui.activeScene.markers.splice(a,1),a==o-1&&1<o?t=o-2:1==o&&(t=null)),(n=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&n.viewer.sceneActive.removePoint(i.point),e.fn.selectMarker(e,e.ui.activeScene.markers[t]))}},updateMarkerPointState:function(e,t){if(t){var n=null;switch(t.type){case"sphere":n=e.scenes.sphere;break;case"cubeone":case"cubesix":n=e.scenes.cube;break;case"flat":n=e.scenes.flat;break;case"gsv":n=e.scenes.gsv;break;case"littleplanet":n=e.scenes.littleplanet}if(n.pointEditor)for(var a=0;a<t.markers.length;a++){var i,o=t.markers[a];o.visible?o.point||(i=n.pointEditor.addPointToCenter(!0),"flat"==t.type?(i.mesh.position.x=i.yaw=o.yaw,i.mesh.position.y=i.pitch=o.pitch):i.setYawPitch(o.yaw,o.pitch,500),(o.point=i).marker=o):o.point&&(n.removePoint(o.point,!0),o.point=null)}}},updateMarkerView:function(i,o){clearTimeout(i.updateMarkerViewTimerId),i.updateMarkerViewTimerId=setTimeout(function(){var e=g("#ipanorama-marker-view"),t=(i.fn.setMarkerView(i,o,e),e.closest(".ipanorama-marker-canvas-wrap")),n=e.closest(".ipanorama-marker-canvas"),e=e.closest(".ipanorama-marker-wrap"),a=n.height()/t.height(),n=n.width()/t.width();1<a||1<n?e.css({transform:"scale("+1/(n<a?a:n)+")"}):e.css({transform:""})},1)},selectShape:function(e,t,n){var a;e.fn.isShapeActive(e,t)||(e.ui.activeShape=t,e.rootScope.scan(),a=e.$ipanorama.ipanorama("instance"),t&&a.viewer.sceneActive&&a.viewer.sceneActive.planeEditor&&a.viewer.sceneActive.planeEditor.attach(t.plane)),n&&(a=e.$ipanorama.ipanorama("instance")).viewer.sceneActive.lookAt(t.plane.mesh.position,1e3)},isShapeActive:function(e,t){return Object.is(e.ui.activeShape,t)},onShapeItemClick:function(e,t){var n;e.fn.isShapeActive(e,t)?(e.ui.activeShape=null,(n=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&n.viewer.sceneActive.planeEditor&&n.viewer.sceneActive.planeEditor.detach()):e.fn.selectShape(e,t)},toggleShapeVisible:function(e,t){t.visible=!t.visible,e.fn.updateShapePlaneState(e,e.ui.activeScene)},addShape:function(e){var t,n;null!=e.ui.activeScene&&((t=g.extend(!0,{},e.defaultShape)).id=e.fn.uuid(10),e.ui.activeScene.shapes.push(t),(n=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&n.viewer.sceneActive.planeEditor&&(n=n.viewer.sceneActive.planeEditor.addPlaneToCenter(!0),((t.plane=n).shape=t).pos.x=n.mesh.position.x,t.pos.y=n.mesh.position.y,t.pos.z=n.mesh.position.z,t.image.url=n.cfg.image),e.fn.selectShape(e,t))},copyShape:function(e){if(null!=e.ui.activeScene&&null!=e.ui.activeShape){for(var t,n=null,a=e.ui.activeScene.shapes.length,i=null,o=0;o<a;o++)if(i=e.ui.activeScene.shapes[o],Object.is(e.ui.activeShape,i)){n=o;break}null!=n&&((i=g.extend(!0,{},i)).id=e.fn.uuid(10),i.title=(i.title||"")+" [copy]",e.ui.activeScene.shapes.splice(n+1,0,i),(t=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&t.viewer.sceneActive.planeEditor&&(t=t.viewer.sceneActive.planeEditor.addPlaneToCenter(!0),(i.plane=t).shape=i,t.mesh.position.x=i.pos.x,t.mesh.position.y=i.pos.y,t.mesh.position.z=i.pos.z),e.fn.selectShape(e,i))}},updownShape:function(e,t){if(null!=e.ui.activeScene&&null!=e.ui.activeShape){for(var n=null,a=e.ui.activeScene.shapes.length,i=null,o=0;o<a;o++)if(i=e.ui.activeScene.shapes[o],Object.is(e.ui.activeShape,i)){n=o;break}if(null!=n)if("up"==t&&0<n)e.ui.activeScene.shapes[n]=e.ui.activeScene.shapes[n-1],e.ui.activeScene.shapes[n-1]=i;else if("down"==t&&n<a-1)e.ui.activeScene.shapes[n]=e.ui.activeScene.shapes[n+1],e.ui.activeScene.shapes[n+1]=i;else if("start"==t&&0<n)for(o=n;0<o;o--)i=e.ui.activeScene.shapes[o],e.ui.activeScene.shapes[o]=e.ui.activeScene.shapes[o-1],e.ui.activeScene.shapes[o-1]=i;else if("end"==t&&n<a-1)for(o=n;o<a-1;o++)i=e.ui.activeScene.shapes[o],e.ui.activeScene.shapes[o]=e.ui.activeScene.shapes[o+1],e.ui.activeScene.shapes[o+1]=i}},deleteShape:function(e){if(null!=e.ui.activeScene&&null!=e.ui.activeShape){for(var t,n,a=null,i=null,o=e.ui.activeScene.shapes.length,r=0;r<o;r++)if(i=e.ui.activeScene.shapes[r],Object.is(e.ui.activeShape,i)){a=r;break}null!=a&&(0<=(t=a)&&a<o&&(e.ui.activeScene.shapes.splice(a,1),a==o-1&&1<o?t=o-2:1==o&&(t=null)),(n=e.$ipanorama.ipanorama("instance")).viewer.sceneActive&&n.viewer.sceneActive.removePlane(i.plane),e.fn.selectShape(e,e.ui.activeScene.shapes[t]))}},updateShapePlaneState:function(e,t){if(t){var n=null;switch(t.type){case"sphere":n=e.scenes.sphere;break;case"cubeone":case"cubesix":n=e.scenes.cube;break;case"flat":n=e.scenes.flat;break;case"gsv":n=e.scenes.gsv;break;case"littleplanet":n=e.scenes.littleplanet}if(n.planeEditor)for(var a=0;a<t.shapes.length;a++){var i,o=t.shapes[a];o.visible?o.plane||(i=new IPANORAMA.Plane({pos:o.pos,rotate:o.rotate,image:e.fn.getImageUrl(e,o.image),width:o.width,height:o.height,opacity:o.opacity,billboard:o.billboard}),i=n.addPlane(i,!0),(o.plane=i).shape=o):o.plane&&(n.removePlane(o.plane,!0),o.plane=null)}}},getTrackTitle:function(e,t){return t.title||(t.url?t.url.substring(t.url.lastIndexOf("/")+1):"...")},isTrackActive:function(e,t){return Object.is(e.ui.activeTrack,t)},onTrackItemClick:function(e,t){e.fn.isTrackActive(e,t)?e.ui.activeTrack=null:e.fn.selectTrack(e,t)},onTrackKeyDown:function(e,t,n){switch(n.preventDefault(),n.keyCode){case 38:g(n.target).prev().focus().click();break;case 40:g(n.target).next().focus().click()}},toggleTrackState:function(e,t){t.enabled=!t.enabled},selectTrack:function(e,t){e.fn.isTrackActive(e,t)||(e.ui.activeTrack=t,e.rootScope.scan())},addTrack:function(e){var t=g.extend(!0,{},e.defaultTrack);t.id=e.fn.uuid(10),e.config.audio.tracks.push(t),e.fn.selectTrack(e,t)},copyTrack:function(e){if(null!=e.ui.activeTrack){for(var t=null,n=e.config.audio.tracks.length,a=null,i=0;i<n;i++)if(a=e.config.audio.tracks[i],Object.is(e.ui.activeTrack,a)){t=i;break}null!=t&&((a=g.extend(!0,{},a)).id=e.fn.uuid(10),a.title=(a.title||"")+" [copy]",e.config.audio.tracks.splice(t+1,0,a),e.fn.selectTrack(e,a))}},updownTrack:function(e,t){if(null!=e.ui.activeTrack){for(var n=null,a=e.config.audio.tracks.length,i=null,o=0;o<a;o++)if(i=e.config.audio.tracks[o],Object.is(e.ui.activeTrack,i)){n=o;break}if(null!=n)if("up"==t&&0<n)e.config.audio.tracks[n]=e.config.audio.tracks[n-1],e.config.audio.tracks[n-1]=i;else if("down"==t&&n<a-1)e.config.audio.tracks[n]=e.config.audio.tracks[n+1],e.config.audio.tracks[n+1]=i;else if("start"==t&&0<n)for(o=n;0<o;o--)i=e.config.audio.tracks[o],e.config.audio.tracks[o]=e.config.audio.tracks[o-1],e.config.audio.tracks[o-1]=i;else if("end"==t&&n<a-1)for(o=n;o<a-1;o++)i=e.config.audio.tracks[o],e.config.audio.tracks[o]=e.config.audio.tracks[o+1],e.config.audio.tracks[o+1]=i}},deleteTrack:function(e){if(null!=e.ui.activeTrack){for(var t,n=null,a=e.config.audio.tracks.length,i=0;i<a;i++){var o=e.config.audio.tracks[i];if(Object.is(e.ui.activeTrack,o)){n=i;break}}null!=n&&(0<=(t=n)&&n<a&&(e.config.audio.tracks.splice(n,1),n==a-1&&1<a?t=a-2:1==a&&(t=null)),e.fn.selectTrack(e,e.config.audio.tracks[t]))}},onMarkerSection:function(e,t){e.ui.markerSections[t]=!e.ui.markerSections[t]},onTooltipSection:function(e,t){e.ui.tooltipSections[t]=!e.ui.tooltipSections[t]},onPopoverSection:function(e,t){e.ui.popoverSections[t]=!e.ui.popoverSections[t]},onShapeSection:function(e,t){e.ui.shapeSections[t]=!e.ui.shapeSections[t]},generateId:function(e,t,n){n.id=e.fn.uuid(10),t.scan()},strEquals:function(e,t){return"string"==typeof e&&"string"==typeof t?0===e.localeCompare(t,void 0,{sensitivity:"accent"}):e===t},memorySizeOf:function(e){var t=0;if(null!=e)switch(typeof e){case"number":t+=8;break;case"string":t+=2*e.length;break;case"boolean":t+=4;break;case"object":var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n||"Array"===n)for(var a in e)e.hasOwnProperty(a)&&sizeOf(e[a]);else t+=2*e.toString().length}return t},formatByteSize:function(e){var t;return 0==e?"0 Byte":(t=parseInt(Math.floor(Math.log(e)/Math.log(1024))),Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t])},uuid:function(e){var t=THREE.Math.generateUUID(),t=e?t.replaceAll("-",""):t;return e?t.substring(0,e):t},assignObject:function(e,t,n){for(var a in t)n.hasOwnProperty(a)&&(n[a]=t[a])},selectShowAnimation:function(t,n){var a={selectedClass:null};t.modal.fn.show(t,"show-effects",a,t.fn.selectAnimationCallback).then(function(e){t.modal.fn.close(t,a.id),"close"!=e&&e&&(n.showAnimation=a.selectedClass,t.rootScope.scan())})},selectHideAnimation:function(t,n){var a={selectedClass:null};t.modal.fn.show(t,"hide-effects",a,t.fn.selectAnimationCallback).then(function(e){t.modal.fn.close(t,a.id),"close"!=e&&e&&(n.hideAnimation=a.selectedClass,t.rootScope.scan())})},selectAnimationCallback:function(a){var i=g("#ipanorama-modal-"+a.id);i.find(".ipanorama-modal-effect[data-fx-name]").on("click",function(e){i.find(".ipanorama-modal-effect.ipanorama-active").removeClass("ipanorama-active");var t=g(this),n=t.data("fx-name");t.removeClass(n).addClass(n).addClass("ipanorama-active"),a.selectedClass=n,a.rootScope.scan()}),i.find(".ipanorama-modal-effect[data-fx-name]").on("dblclick",function(e){var t=g(this).data("fx-name");a.selectedClass=t,a.deferred.resolve(!0)}),i.find(".ipanorama-modal-effect[data-fx-name]").on(function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}(),function(e){var t=g(this),n=t.data("fx-name");t.hasClass(n)&&t.removeClass(n)})},editMarker:function(t,n){var a={marker:g.extend(!0,{},n),markerWatch:null,easyClose:!1,fn:{initMarker:function(e,t){e.$marker=g(t)}}};t.modal.fn.show(t,"edit-marker",a,t.fn.editMarkerCallback).then(function(e){a.markerWatch&&(a.markerWatch.stop(),a.markerWatch=null),t.modal.fn.close(t,a.id),"close"!=e&&e&&(t.fn.assignObject(t,a.marker,n),t.fn.updateMarkerView(t,n),t.rootScope.scan())})},editMarkerCallback:function(t){function n(e,t){e.appData.fn.setMarkerView(e.appData,t,e.$marker);var t=e.$marker,e=t.closest(".ipanorama-marker-canvas-wrap"),n=t.closest(".ipanorama-marker-canvas"),t=t.closest(".ipanorama-marker-wrap"),a=n.height()/e.height(),n=n.width()/e.width();1<a||1<n?t.css({transform:"scale("+1/(n<a?a:n)+")"}):t.css({transform:""})}t.markerWatch=t.rootScope.watch("modalData.marker",function(e){n(t,e)},{deep:6}),n(t,t.marker)},setMarkerView:function(e,t,n){n&&(n.css({"background-image":e.fn.getImageUrl(e,t.view.background.image,"style"),"background-color":t.view.background.color||"","background-size":t.view.background.size||"","background-repeat":t.view.background.repeat||"","background-position":t.view.background.position||"","border-width":t.view.border.all.active&&t.view.border.all.width.value?t.view.border.all.width.value+t.view.border.all.width.type:"","border-style":t.view.border.all.active&&t.view.border.all.style?t.view.border.all.style:"","border-color":t.view.border.all.active&&t.view.border.all.color?t.view.border.all.color:""}),t.view.border.top.active&&n.css({"border-top-width":t.view.border.top.width.value?t.view.border.top.width.value+t.view.border.top.width.type:"","border-top-style":t.view.border.top.style||"","border-top-color":t.view.border.top.color||""}),t.view.border.right.active&&n.css({"border-right-width":t.view.border.right.width.value?t.view.border.right.width.value+t.view.border.right.width.type:"","border-right-style":t.view.border.right.style||"","border-right-color":t.view.border.right.color||""}),t.view.border.bottom.active&&n.css({"border-bottom-width":t.view.border.bottom.width.value?t.view.border.bottom.width.value+t.view.border.bottom.width.type:"","border-bottom-style":t.view.border.bottom.style||"","border-bottom-color":t.view.border.bottom.color||""}),t.view.border.left.active&&n.css({"border-left-width":t.view.border.left.width.value?t.view.border.left.width.value+t.view.border.left.width.type:"","border-left-style":t.view.border.left.style||"","border-left-color":t.view.border.left.color||""}),e=t.view.border.radius.all.value?t.view.border.radius.all.value+t.view.border.radius.all.type:"",n.css({"border-top-left-radius":t.view.border.radius.topLeft.value?t.view.border.radius.topLeft.value+t.view.border.radius.topLeft.type:e,"border-top-right-radius":t.view.border.radius.topRight.value?t.view.border.radius.topRight.value+t.view.border.radius.topRight.type:e,"border-bottom-right-radius":t.view.border.radius.bottomRight.value?t.view.border.radius.bottomRight.value+t.view.border.radius.bottomRight.type:e,"border-bottom-left-radius":t.view.border.radius.bottomLeft.value?t.view.border.radius.bottomLeft.value+t.view.border.radius.bottomLeft.type:e}),e=t.view.icon.margin.all.value?t.view.icon.margin.all.value+t.view.icon.margin.all.type:"",n.find(".ipanorama-marker-lbl").css({"margin-top":t.view.icon.margin.top.value?t.view.icon.margin.top.value+t.view.icon.margin.top.type:e,"margin-right":t.view.icon.margin.right.value?t.view.icon.margin.right.value+t.view.icon.margin.right.type:e,"margin-bottom":t.view.icon.margin.bottom.value?t.view.icon.margin.bottom.value+t.view.icon.margin.bottom.type:e,"margin-left":t.view.icon.margin.left.value?t.view.icon.margin.left.value+t.view.icon.margin.left.type:e}))},getMarkerStyle:function(e,t,n){switch(n){case"width":return t.view.autoWidth?"":t.view.width+"px";case"height":return t.view.autoHeight?"":t.view.height+"px";case"angle":return t.view.angle?"rotate("+t.view.angle+"deg)":"rotate(0deg)"}return null},getIconStyle:function(e,t,n){switch(n){case"color":return t.color||"";case"font-size":return t.size.value?t.size.value+t.size.type:""}return null},selectIcon:function(t,n,a){var i={icons:null,selectedIcon:null,fn:{onClickIcon:function(e,t,n,a){var i=g("#ipanorama-modal-"+e.id),n=g(n);i.find(".ipanorama-modal-icon.ipanorama-active").removeClass("ipanorama-active"),n.addClass("ipanorama-active"),e.selectedIcon=e.fn.getIcon(e,a)},onDblClickIcon:function(e){e.deferred.resolve(!0)},selectIcon:function(e){e.deferred.resolve(!0)},getIcon:function(e,t){return t.name},getIconName:function(e,t){return t.name.replace(/fa-/g,"")}}};t.modal.fn.show(t,"icons",i,t.fn.selectIconCallback).then(function(e){t.modal.fn.close(t,i.id),"close"!=e&&e&&i.selectedIcon&&(a.name=i.selectedIcon,n.scan())})},selectIconCallback:function(t){t.appData.fn.loadData(n,"icons").done(function(e){t.icons=e.list,t.rootScope.scan(),g("#ipanorama-modal-"+t.id).find(".ipanorama-modal-data").removeClass("ipanorama-modal-loading"),n.modal.fn.resize(t)})},setupWidgetSettings:function(t){if(null!=t.config.widget.name){var e,n={config:{}},a="widget-"+t.config.widget.name;for(e in t.ui.widgetConfigs)if(e.toLowerCase()==t.config.widget.name.toLowerCase()){t.ui.widgetConfigs.hasOwnProperty(e)&&(n.config=g.extend(!0,{},t.ui.widgetConfigs[e]));break}t.modal.fn.show(t,a,n).then(function(e){t.modal.fn.close(t,n.id),"close"!=e&&e&&(t.ui.widgetConfigs[t.config.widget.name]=g.extend(!0,{},n.config),t.config.widget.config=g.extend(!0,{},n.config),t.rootScope.scan())})}},setupSceneTransitionSettings:function(t){if(null!=t.config.sceneTransition.name){var e,n={config:{}},a="transition-"+t.config.sceneTransition.name;for(e in t.ui.sceneTransitionConfigs)if(e.toLowerCase()==t.config.sceneTransition.name.toLowerCase()){t.ui.sceneTransitionConfigs.hasOwnProperty(e)&&(n.config=g.extend(!0,{},t.ui.sceneTransitionConfigs[e]));break}t.modal.fn.show(t,a,n).then(function(e){t.modal.fn.close(t,n.id),"close"!=e&&e&&(t.ui.sceneTransitionConfigs[t.config.sceneTransition.name]=g.extend(!0,{},n.config),t.config.sceneTransition.config=g.extend(!0,{},n.config),t.rootScope.scan())})}}},modal:{count:0,items:[],fn:{resize:function(e){var e=g("#ipanorama-modal-"+e.id),t=(e.find(".ipanorama-modal-dialog"),e.find(".ipanorama-modal-header")),n=e.find(".ipanorama-modal-data"),e=e.find(".ipanorama-modal-footer"),t=t.outerHeight()+e.outerHeight()+50,e=g(window).height();e-t<n.height()&&n.outerHeight(e-t)},show:function(a,e,n,t){var i=++a.modal.count,o=g.Deferred();return a.modal.items.push(i),a.inprocess++,g.ajax({url:a.wp_ajax_url,type:"GET",dataType:"html",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_modal,name:e}}).done(function(e){g("body").addClass("ipanorama-modal-open");var e=g(e),t={};t.modalData=n,t.modalData.id=i,t.modalData.deferred=o,t.modalData.appData=a,null!=n.easyClose&&!n.easyClose||e.on("click",function(e){t.modalData.deferred.resolve("close")}),g("#ipanorama-modals").append(e),e.find(".ipanorama-modal-dialog").on("click",function(e){return!1}),n.rootScope=a.alight(e.get(0),t),a.modal.fn.resize(n)}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){t&&"function"==typeof t&&t.call(this,n),a.inprocess--}),o.promise()},close:function(e,t){g("#ipanorama-modal-"+t).remove();t=e.modal.items.indexOf(t);e.modal.items.splice(t,1),0==e.modal.items.length&&jQuery("body").removeClass("ipanorama-modal-open")}}}};window.alightInitCallback=function(e){delete window.alightInitCallback,e.directives.al.uuid={restrict:"EA",link:function(a,e,i,o){var r=g(e),s=g(e);s.on("input change",function(e){var t=s.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?t.match("^[a-zA-Z0-9_-]+$")||(n=!1):t=null;n?(o.setValue(i,t),o.scan(),function(){var e=r.data("callback");e&&o.changeDetector.compile(e)(a)}(),r.removeClass("ipanorama-invalid")):r.addClass("ipanorama-invalid")}),o.watch(i,function(e){null==e?s.val(null):s.val(e)},{readOnly:!0})}},e.directives.al.text={restrict:"EA",link:function(a,e,i,o){var r=g(e),s=r.attr("data-regex"),l=g(e);l.on("input change",function(e){var t=l.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?s&&!t.match(s)&&(n=!1):t=null;n?(o.setValue(i,t),o.scan(),function(){var e=r.data("callback");e&&o.changeDetector.compile(e)(a)}(),r.removeClass("ipanorama-invalid")):r.addClass("ipanorama-invalid")}),void 0===o.getValue(i)&&void 0!==r.attr("data-default")&&(e=r.data("default"),o.setValue(i,e)),o.watch(i,function(e){null==e?l.val(null):l.val(e)},{readOnly:!0})}},e.directives.al.textarea={restrict:"EA",link:function(n,e,a,i){var o=g(e),r=g(e);o.addClass("ipanorama-textarea"),r.on("input change",function(e){var t=r.val();!function(e){return!e||/^\s*$/.test(e)}(t)||(t=null);i.setValue(a,t),i.scan(),function(){var e=o.data("callback");e&&i.changeDetector.compile(e)(n)}()}),i.watch(a,function(e){null==e?r.val(null):r.val(e)},{readOnly:!0})}},e.directives.al.integer={restrict:"EA",link:function(a,e,i,o){var r=g(e),s=g(e);s.on("input change",function(e){var t=s.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?t.match("^([+-]?[1-9]+[0-9]*|0)$")?t=parseInt(t,10):n=!1:t=null;n?(o.setValue(i,t),o.scan(),function(){var e=r.data("callback");e&&o.changeDetector.compile(e)(a)}(),r.removeClass("ipanorama-invalid")):r.addClass("ipanorama-invalid")}),o.watch(i,function(e){r.removeClass("ipanorama-invalid"),null==e?s.val(null):s.val(e)},{readOnly:!0})}},e.directives.al.float={restrict:"EA",link:function(a,e,i,o){var r=g(e),s=g(e),l=(s.on("input change",function(e){var t=s.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?(!t.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")||(t=parseFloat(t),null!=l&&t<l&&(n=!1),null!=c&&c<t))&&(n=!1):t=null;n?(o.setValue(i,t),o.scan(),function(){var e=r.data("callback");e&&o.changeDetector.compile(e)(a)}(),r.removeClass("ipanorama-invalid")):r.addClass("ipanorama-invalid")}),s.data("min")),c=s.data("max");o.watch(i,function(e){r.removeClass("ipanorama-invalid"),null==e?s.val(null):s.val(e)},{readOnly:!0})}},e.directives.al.toggle={restrict:"EA",link:function(t,e,n,a){var i=g(e);i.addClass("ipanorama-toggle").html("&nbsp;"),i.on("mousedown touchstart",function(e){a.setValue(n,!a.getValue(n)),a.scan(),function(){var e=i.data("callback");e&&a.changeDetector.compile(e)(t)}()}),void 0===a.getValue(n)&&void 0!==i.attr("data-default")&&(e=i.data("default"),a.setValue(n,e)),a.watch(n,function(e){e?i.addClass("ipanorama-checked").removeClass("ipanorama-unchecked"):i.removeClass("ipanorama-checked").addClass("ipanorama-unchecked")},{readOnly:!0})}},e.directives.al.checkbox={restrict:"EA",link:function(t,e,n,a){var i=g(e);i.addClass("ipanorama-checkbox"),i.on("mousedown touchstart",function(e){a.setValue(n,!a.getValue(n)),a.scan(),function(){var e=i.data("callback");e&&a.changeDetector.compile(e)(t)}()}),a.watch(n,function(e){e?i.addClass("ipanorama-checked").removeClass("ipanorama-unchecked"):i.removeClass("ipanorama-checked").addClass("ipanorama-unchecked")},{readOnly:!0})}},e.directives.al.unit={restrict:"EA",link:function(t,e,a,i){var n=g(e),o=g("<input/>").addClass("ipanorama-unit-value"),r=g("<select/>").addClass("ipanorama-unit-type");function s(){var e=n.data("callback");e&&i.changeDetector.compile(e)(t)}r.append('<option value="px">px</li>'),r.append('<option value="%">%</li>'),r.append('<option value="em">em</li>'),r.append('<option value="cm">cm</li>'),r.append('<option value="mm">mm</li>'),r.append('<option value="in">in</li>'),r.append('<option value="pt">pt</li>'),r.append('<option value="pc">pc</li>'),r.append('<option value="ex">ex</li>'),r.append('<option value="ch">ch</li>'),r.append('<option value="rem">rem</li>'),r.append('<option value="vw">vw</li>'),r.append('<option value="vh">vh</li>'),r.append('<option value="vmin">vmin</li>'),r.append('<option value="vmax">vmax</li>'),n.append(o,r),o.on("input change",function(e){var t=o.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?t.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")?t={value:parseFloat(t),type:r.val()}:n=!1:t={value:null,type:r.val()};n?(i.setValue(a,t),i.scan(),s(),o.removeClass("ipanorama-invalid")):o.addClass("ipanorama-invalid")}),r.on("change",function(e){var t=r.val(),n=i.getValue(a);n&&(n.type=t,i.setValue(a,n),i.scan(),s())}),i.watch(a,function(e){o.removeClass("ipanorama-invalid"),null==e?(o.val(null),r.val("px")):(o.val(e.value),r.val(e.type))},{readOnly:!0})}},e.directives.al.style={restrict:"EA",link:function(e,t,n,a){var i,o;a.attrArgument&&(i=g(t),o=a.attrArgument.split(".")[0],a.watch(n,function(e){i.css(o,e)},{readOnly:!0}))}},e.directives.al.backgroundrepeat={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="repeat">repeat</option>'),i.append('<option value="repeat-x">repeat-x</option>'),i.append('<option value="repeat-y">repeat-y</option>'),i.append('<option value="no-repeat">no-repeat</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.backgroundsize={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="auto">auto</option>'),i.append('<option value="cover">cover</option>'),i.append('<option value="contain">contain</option>'),i.append('<option value="100% 100%">stretch</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.borderstyle={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="solid">solid</option>'),i.append('<option value="hidden">hidden</option>'),i.append('<option value="dotted">dotted</option>'),i.append('<option value="dashed">dashed</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.color={restrict:"EA",link:function(t,a,i,o){var n=g(a),r=g("<div>").addClass("ipanorama-color-btn").append("<div><div></div></div>"),s=g("<input/>").addClass("ipanorama-color-value"),l=(n.append(r,s),r.on("click touchend",function(e){u.show(r,o.getValue(i))}),s.on("input change",function(e){var t=g(this).val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?(new c).setColor(t)||(n=!1):t=null;n?(o.setValue(i,t),o.scan(),p(),g(a).removeClass("ipanorama-invalid")):g(a).addClass("ipanorama-invalid")}),[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}}]);function c(){this.rgb={r:0,g:0,b:0},this.hsb={h:0,s:0,b:0},this.alpha=1}function e(e){this.config=null,this.color=new c,this.controls={},this.inputEdit={enabled:!1,pageY:0,value:0,type:null},this._init(e)}c.prototype={rgb:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},rgba:function(){return"rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+this.alpha+")"},hex:function(){return this.toHex()},RGBAtoHSBA:function(e,t,n,a){var i,o,r=0,s=Math.max(e,t,n),l=s-Math.min(e,t,n),c=s/255,u=0!=s?l/s:0;return u&&(i=(s-e)/l,o=(s-t)/l,n=(s-n)/l,r=e==s?n-o:t==s?2+i-n:4+o-i,(r/=6)<0&&r++),{h:Math.round(360*r),s:Math.round(100*u),b:Math.round(100*c),a:a||1}},HSBAtoRGBA:function(e,t,n,a){var i,o,r;return e=(e=e)%360/60,i=o=t=(n=n/100)-(n=n*(t=t/100)),i+=[n,r=n*(1-Math.abs(e%2-1)),0,0,r,n][e=~~e],o+=[r,n,n,r,0,0][e],t+=[0,0,r,n,n,r][e],{r:Math.round(255*i),g:Math.round(255*o),b:Math.round(255*t),a:a||1}},setColor:function(e){for(var t in e=e.toLowerCase(),l)if(l.hasOwnProperty(t)){var t=l[t],n=t.re.exec(e),t=n&&t.parse(n);if(t)return n=this.RGBAtoHSBA.apply(null,t),this.hsb={h:n.h,s:n.s,b:n.b},this.rgb={r:t[0],g:t[1],b:t[2]},this.alpha=n.a,!0}return!1},setRed:function(e){255<e?e=255:e<0&&(e=0),this.rgb.r=e;e=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:e.h,s:e.s,b:e.b}},setGreen:function(e){255<e?e=255:e<0&&(e=0),this.rgb.g=e;e=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:e.h,s:e.s,b:e.b}},setBlue:function(e){255<e?e=255:e<0&&(e=0),this.rgb.b=e;e=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:e.h,s:e.s,b:e.b}},setHue:function(e){360<e?e=360:e<0&&(e=0),this.hsb.h=e;e=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:e.r,g:e.g,b:e.b}},setSaturation:function(e){100<e?e=100:e<0&&(e=0),this.hsb.s=e;e=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:e.r,g:e.g,b:e.b}},setBrightness:function(e){100<e?e=100:e<0&&(e=0),this.hsb.b=e;e=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:e.r,g:e.g,b:e.b}},setAlpha:function(e){1<(e=parseInt(100*e,10)/100)?e=1:e<0&&(e=0),this.alpha=e},toRGBA:function(){return{r:this.rgb.r,g:this.rgb.g,b:this.rgb.b,a:this.alpha}},toHSBA:function(){return{h:this.hsb.h,s:this.hsb.s,b:this.hsb.b,a:this.alpha}},toHex:function(){return"#"+(1<<24|parseInt(this.rgb.r,10)<<16|parseInt(this.rgb.g,10)<<8|parseInt(this.rgb.b,10)).toString(16).substr(1)}},e.prototype={defaults:{onSelect:null},_init:function(e){this.config=g.extend(!0,{},this.defaults,e),this._create()},_create:function(){this._buildDOM(),this._bind(),this._refresh()},_buildDOM:function(){var e=g("<div></div>").addClass("ipanorama-data"),t=g("<div></div>").addClass("ipanorama-color-picker"),n=g("<div></div>").addClass("ipanorama-thumb"),a=g("<div></div>").addClass("ipanorama-pallete").append(n),i=g("<div></div>").addClass("ipanorama-thumb"),o=g("<div></div>").addClass("ipanorama-hue").append(i),r=g("<div></div>").addClass("ipanorama-panel"),s=g("<div></div>").addClass("ipanorama-input").append('<span>R<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),l=g("<div></div>").addClass("ipanorama-input").append('<span>G<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),c=g("<div></div>").addClass("ipanorama-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),u=g("<div></div>").addClass("ipanorama-line"),p=g("<div></div>").addClass("ipanorama-input").append('<span>H<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),d=g("<div></div>").addClass("ipanorama-input").append('<span>S<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),f=g("<div></div>").addClass("ipanorama-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),e=(r.append(s,l,c,u,p,d,f),t.append(e.append(a,o,r)),this.controls.$picker=t,this.controls.$pallete=a,this.controls.$pallete_thumb=n,this.controls.$hue=o,this.controls.$hue_thumb=i,this.controls.$input_rgb_r=s.find("input"),this.controls.$input_rgb_g=l.find("input"),this.controls.$input_rgb_b=c.find("input"),this.controls.$input_hsb_h=p.find("input"),this.controls.$input_hsb_s=d.find("input"),this.controls.$input_hsb_b=f.find("input"),this.controls.$input_rgb_r_thumb=s.find(".ipanorama-thumb"),this.controls.$input_rgb_g_thumb=l.find(".ipanorama-thumb"),this.controls.$input_rgb_b_thumb=c.find(".ipanorama-thumb"),this.controls.$input_hsb_h_thumb=p.find(".ipanorama-thumb"),this.controls.$input_hsb_s_thumb=d.find(".ipanorama-thumb"),this.controls.$input_hsb_b_thumb=f.find(".ipanorama-thumb"),g("<div></div>").addClass("ipanorama-data")),u=g("<div></div>").addClass("ipanorama-thumb"),a=g("<div></div>").addClass("ipanorama-gradient"),n=g("<div></div>").addClass("ipanorama-alpha").append(a,u),r=g("<div></div>").addClass("ipanorama-panel"),o=g("<div></div>").addClass("ipanorama-input").append('<span>A<input type="text" maxlength="3" size="3"/><span class="ipanorama-thumb"></span></span>'),e=(r.append(o),t.append(e.append(n,r)),this.controls.$alpha=n,this.controls.$alpha_thumb=u,this.controls.$alpha_gradient=a,this.controls.$input_alpha=o.find("input"),this.controls.$input_alpha_thumb=o.find(".ipanorama-thumb"),g("<div></div>").addClass("ipanorama-data")),i=g("<div></div>").addClass("ipanorama-preview").append("<div><div></div></div>"),s=g("<input readonly />").addClass("ipanorama-input-color"),l=g("<div></div>").addClass("ipanorama-submit").text("OK");t.append(e.append(i,s,l)),this.controls.$preview=i.find("> div > div"),this.controls.$input_color=s,this.controls.$submit=l,t.appendTo("body")},_bind:function(){this.controls.$pallete.on("mousedown",g.proxy(this._onPalleteEditStart,this)),this.controls.$pallete.on("click",g.proxy(this._onPalleteEditMove,this)),this.controls.$hue.on("mousedown",g.proxy(this._onHueEditStart,this)),this.controls.$hue.on("click",g.proxy(this._onHueEditMove,this)),this.controls.$alpha.on("mousedown",g.proxy(this._onAlphaEditStart,this)),this.controls.$alpha.on("click",g.proxy(this._onAlphaEditMove,this)),this.controls.$input_rgb_r_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"rgb_r")),this.controls.$input_rgb_g_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"rgb_g")),this.controls.$input_rgb_b_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"rgb_b")),this.controls.$input_hsb_h_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"hsb_h")),this.controls.$input_hsb_s_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"hsb_s")),this.controls.$input_hsb_b_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"hsb_b")),this.controls.$input_alpha_thumb.on("mousedown",g.proxy(this._onInputEditStart,this,"alpha")),this.controls.$input_rgb_r.on("input",g.proxy(this._onInput,this,"rgb_r")),this.controls.$input_rgb_g.on("input",g.proxy(this._onInput,this,"rgb_g")),this.controls.$input_rgb_b.on("input",g.proxy(this._onInput,this,"rgb_b")),this.controls.$input_hsb_h.on("input",g.proxy(this._onInput,this,"hsb_h")),this.controls.$input_hsb_s.on("input",g.proxy(this._onInput,this,"hsb_s")),this.controls.$input_hsb_b.on("input",g.proxy(this._onInput,this,"hsb_b")),this.controls.$input_alpha.on("input",g.proxy(this._onInput,this,"alpha")),this.controls.$submit.on("click",g.proxy(this._onSubmit,this))},_refresh:function(){var e=this.color.toRGBA(),t=this.color.toHSBA(),n=this.controls.$pallete.outerHeight()-2,a=this.controls.$pallete.outerWidth()-2,n=(this.controls.$pallete.css({"background-color":"hsl("+t.h+", 100%, 50%)"}),this.controls.$pallete_thumb.css({top:parseInt(n-n*t.b/100,10)}),this.controls.$pallete_thumb.css({left:parseInt(a-a*(100-t.s)/100,10)}),this.controls.$hue.outerHeight()-2),a=(this.controls.$hue_thumb.css({top:parseInt(n-n*t.h/360,10)}),this.controls.$alpha.outerWidth()-2);this.controls.$alpha_thumb.css({left:parseInt(a-a*(1-t.a),10)}),this.controls.$alpha_gradient.css({background:"linear-gradient(to left,"+this.color.hex()+",rgba(0,0,0,0))"}),this.controls.$input_rgb_r.val(e.r),this.controls.$input_rgb_g.val(e.g),this.controls.$input_rgb_b.val(e.b),this.controls.$input_hsb_h.val(t.h),this.controls.$input_hsb_s.val(t.s),this.controls.$input_hsb_b.val(t.b),this.controls.$input_alpha.val(parseInt(100*e.a,10)),this.controls.$preview.css({"background-color":this.color.rgba()}),this.controls.$input_color.val(1!=e.a?this.color.rgba():this.color.hex())},_show:function(e){var t=e.offset(),n=e.outerWidth(),e=e.outerHeight(),a=this.controls.$picker.outerWidth(),i=this.controls.$picker.outerHeight(),i=t.top-i-1,o=t.left,r=(this.controls.$picker.offset({top:i,left:o}),this.controls.$picker.get(0).getBoundingClientRect());r.y<0&&(i=t.top+e+t.height+1,this.controls.$picker.offset({top:i})),r.x+r.width>window.innerWidth&&(o=t.left+n-a,this.controls.$picker.offset({left:o})),this.controls.$picker.addClass("ipanorama-active"),g("body").on("mousedown touchstart",g.proxy(this._onBodyClick,this))},_hide:function(){this.controls.$picker.removeClass("ipanorama-active").css({top:"",left:""}),g("body").off("mousedown touchstart",g.proxy(this._onBodyClick,this))},_destroy:function(){this.controls.$picker&&this.controls.$picker.remove(),this.config=null,this.color=new c,this.controls={}},_onPalleteEditStart:function(e){g("body").on("mouseup",g.proxy(this._onPalleteEditEnd,this)),g("body").on("mousemove",g.proxy(this._onPalleteEditMove,this))},_onPalleteEditMove:function(e){var t=this.controls.$pallete.outerHeight(),n=this.controls.$pallete.outerWidth(),n=100-parseInt(100*(n-Math.max(0,Math.min(n,e.pageX-this.controls.$pallete.offset().left)))/n,10),e=parseInt(100*(t-Math.max(0,Math.min(t,e.pageY-this.controls.$pallete.offset().top)))/t,10);return this.color.setSaturation(n),this.color.setBrightness(e),this._refresh(),!1},_onPalleteEditEnd:function(e){return g("body").off("mouseup",g.proxy(this._onPalleteEditEnd,this)),g("body").off("mousemove",g.proxy(this._onPalleteEditMove,this)),this._refresh(),!1},_onHueEditStart:function(e){g("body").on("mouseup",g.proxy(this._onHueEditEnd,this)),g("body").on("mousemove",g.proxy(this._onHueEditMove,this))},_onHueEditMove:function(e){var t=this.controls.$hue.outerHeight(),e=parseInt(360*(t-Math.max(0,Math.min(t,e.pageY-this.controls.$hue.offset().top)))/t,10);return this.color.setHue(e),this._refresh(),!1},_onHueEditEnd:function(e){return g("body").off("mouseup",g.proxy(this._onHueEditEnd,this)),g("body").off("mousemove",g.proxy(this._onHueEditMove,this)),this._refresh(),!1},_onAlphaEditStart:function(e){g("body").on("mouseup",g.proxy(this._onAlphaEditEnd,this)),g("body").on("mousemove",g.proxy(this._onAlphaEditMove,this))},_onAlphaEditMove:function(e){var t=this.controls.$alpha.outerWidth(),e=1-(t-Math.max(0,Math.min(t,e.pageX-this.controls.$alpha.offset().left)))/t;return this.color.setAlpha(e),this._refresh(),!1},_onAlphaEditEnd:function(e){return g("body").off("mouseup",g.proxy(this._onAlphaEditEnd,this)),g("body").off("mousemove",g.proxy(this._onAlphaEditMove,this)),this._refresh(),!1},_onInputEditStart:function(e,t){g("body").on("mouseup",g.proxy(this._onInputEditEnd,this)),g("body").on("mousemove",g.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!0,this.inputEdit.pageY=t.pageY,this.inputEdit.value=parseInt(g(t.target).siblings("input").val(),10),this.inputEdit.type=e},_onInputEditMove:function(e){if(this.inputEdit.enabled){var e=e.pageY-this.inputEdit.pageY,t=this.inputEdit.value+e;switch(this.inputEdit.type){case"rgb_r":this.color.setRed(t);break;case"rgb_g":this.color.setGreen(t);break;case"rgb_b":this.color.setBlue(t);break;case"hsb_h":this.color.setHue(t);break;case"hsb_s":this.color.setSaturation(t);break;case"hsb_b":this.color.setBrightness(t);break;case"alpha":this.color.setAlpha(t/100)}}return this._refresh(),!1},_onInputEditEnd:function(e){return g("body").off("mouseup",g.proxy(this._onInputEditEnd,this)),g("body").off("mousemove",g.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!1,this.inputEdit.pageY=0,this.inputEdit.value=0,this.inputEdit.type=null,this._refresh(),!1},_onInput:function(e,t){var n=g(t.target).val(),n=parseInt(n,10)||0;switch(e){case"rgb_r":this.color.setRed(n);break;case"rgb_g":this.color.setGreen(n);break;case"rgb_b":this.color.setBlue(n);break;case"hsb_h":this.color.setHue(n);break;case"hsb_s":this.color.setSaturation(n);break;case"hsb_b":this.color.setBrightness(n);break;case"alpha":this.color.setAlpha(n/100)}return this._refresh(),!1},_onSubmit:function(e){this._hide(),"function"==typeof this.config.onSelect&&this.config.onSelect.call(this,this.color)},_onBodyClick:function(e){0!==this.controls.$picker.has(e.target).length||g(e.target).hasClass("ipanorama-color-picker")||this._hide()},show:function(e,t){t&&(this.color.setColor(t),this._refresh()),this._show(e)},hide:function(){this._hide()},destroy:function(){this._destroy()}};var u=new e({onSelect:function(e){e=1==e.alpha?e.hex():e.rgba();o.setValue(i,e),o.scan(),p(),s.val(e)}});function p(){var e=n.data("callback");e&&o.changeDetector.compile(e)(t)}o.changeDetector.watch("$destroy",function(){u.destroy()}),o.watch(i,function(e){var t;g(a).removeClass("ipanorama-invalid"),null==e?(s.val(null),r.find("> div > div").css({"background-color":""})):((t=new c).setColor(e)?r.find("> div > div").css({"background-color":t.rgba()}):r.find("> div > div").css({"background-color":""}),s.val(e))},{readOnly:!0})}},e.directives.al.tooltipplacement={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="top-left">top-left</option>'),i.append('<option value="top">top</option>'),i.append('<option value="top-right">top-right</option>'),i.append('<option value="right-top">right-top</option>'),i.append('<option value="right">right</option>'),i.append('<option value="right-bottom">right-bottom</option>'),i.append('<option value="bottom-right">bottom-right</option>'),i.append('<option value="bottom">bottom</option>'),i.append('<option value="bottom-left">bottom-left</option>'),i.append('<option value="left-bottom">left-bottom</option>'),i.append('<option value="left">left</option>'),i.append('<option value="left-top">left-top</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.tooltiptrigger={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="hover">hover</option>'),i.append('<option value="enter">enter</option>'),i.append('<option value="click">click</option>'),i.append('<option value="clickbody">click & body</option>'),i.append('<option value="sticky">sticky</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.popovertype={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="inbox">inbox</option>'),i.append('<option value="lightbox">lightbox</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"default"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("default"):i.val(e)},{readOnly:!0})}},e.directives.al.popovertrigger={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="hover">hover</option>'),i.append('<option value="click">click</option>'),i.append('<option value="dblclick">dblclick</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.scenetype={restrict:"EA",link:function(e,t,n,a){var t=g(t),i=g("<select/>").addClass(t.get(0).className);i.append('<option value="none">none</option>'),i.append('<option value="sphere">sphere</option>'),i.append('<option value="cubeone">cube (1 texture)</option>'),i.append('<option value="cubesix">cube (6 textures)</option>'),i.append('<option value="flat">flat</option>'),i.append('<option value="littleplanet">littleplanet</option>'),i.append('<option value="gsv">google street view</option>'),t.append(i),i.unwrap(),i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):i.val(e)},{readOnly:!0})}},e.directives.al.sceneguid={restrict:"EA",link:function(e,t,n,a){var i=g(t),o=!0;i.on("change",function(e){var t=i.val();"none"==t&&(t=null);a.setValue(n,t),a.scan()}),a.watch(n,function(e){null==e?i.val("none"):(i.val(e),o&&(setTimeout(function(){i.val(e)},300),o=!1))},{readOnly:!0})}},n.config=g.extend(!0,{},n.defaultConfig),n.alight=e,n.rootScope=n.alight(document.querySelectorAll("#ipanorama-app-item")[0],{appData:n}),n.fn.init(n)}}function o(){var t={alight:null,rootScope:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_delete_data:null,wp_ajax_action_modal:null,wp_ajax_msg_error:null,themes:null,roles:null,config:null,license:null,ui:{tabs:{general:!0,customCSS:!1,customJS:!1,license:!1}},defaultConfig:{themeJavaScript:null,themeCSS:null,roles:null,wpHead:!1,wpFooter:!1,customCSS:{active:!1,data:null},customJS:{active:!1,data:null}},defaultLicense:{status:!1,purchaseCode:null,supportDate:null,support:!1},fn:{init:function(e){g("#ipanorama-app-settings").removeAttr("style"),e.plan=ipanorama_globals.plan,e.wp_ajax_url=ipanorama_globals.ajax_url,e.wp_ajax_nonce=ipanorama_globals.ajax_nonce,e.wp_ajax_action_update=ipanorama_globals.ajax_action_update,e.wp_ajax_action_get=ipanorama_globals.ajax_action_get,e.wp_ajax_action_delete_data=ipanorama_globals.ajax_action_delete_data,e.wp_ajax_action_modal=ipanorama_globals.ajax_action_modal,e.wp_ajax_msg_error=ipanorama_globals.ajax_msg_error,e.fn.initConfig(e)},enableLoading:function(e){g("#ipanorama-app-settings").removeClass("ipanorama-active")},disableLoading:function(e){setTimeout(function(){g("#ipanorama-app-settings").addClass("ipanorama-active")},1e3)},loadData:function(a,e){var i=g.Deferred();return g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_get,type:e},success:function(e){e&&e.success?i.resolve(e.data):this.error()},error:function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error"),i.reject()}}),i.promise()},saveEditorsData:function(e){var t=g("#ipanorama-notepad-css"),t=(t.length&&(t=ace.edit(t.get(0)),e.config.customCSS.data=t.getSession().getValue()),g("#ipanorama-notepad-js"));t.length&&(t=ace.edit(t.get(0)),e.config.customJS.data=t.getSession().getValue())},initConfig:function(i){i.fn.enableLoading(i);var e=g.extend(!0,{},i.defaultConfig,ipanorama_globals.config?JSON.parse(ipanorama_globals.config):null),e=(i.config=e,g.extend(!0,{},i.defaultLicense,ipanorama_globals.license?JSON.parse(ipanorama_globals.license):null));if(i.license=e,i.config)for(var t in i.config)i.defaultConfig.hasOwnProperty(t)||delete i.config[t];if(i.config.roles)for(var n=0;n<i.config.roles.length;n++){var a=i.config.roles[n];a.hasOwnProperty("id")||(i.config.roles[n]=a={id:a,active:!0,state:"private"}),a.hasOwnProperty("state")||(a={id:a.id,active:a.active,state:"private"},i.config.roles[n]=a)}i.fn.loadData(i,"editor-themes").done(function(e){i.themes=e.list}).always(function(){i.rootScope.scan(),i.fn.disableLoading(i)}),i.fn.loadData(i,"roles").done(function(e){i.roles=e.list,i.config.roles||(i.config.roles=[]);for(var t=0;t<i.roles.length;t++){for(var n=!1,a=0;a<i.config.roles.length;a++)if(i.config.roles[a].id==i.roles[t].id){n=!0;break}n||"administrator"==i.roles[t].id||i.config.roles.push({id:i.roles[t].id,active:!1,state:"private"})}}).always(function(){i.rootScope.scan(),i.fn.disableLoading(i)})},saveConfig:function(a){a.fn.enableLoading(a),a.fn.saveEditorsData(a);var e=g.extend(!0,{},a.config),e=JSON.stringify(e);g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",cache:!1,data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_update,type:"config",data:e}}).done(function(e){e?a.fn.showNotice(a,e.data.msg,e.success?"notice-success":"notice-error"):a.fn.showNotice(a,a.wp_ajax_msg_error,"notice-error")}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){a.fn.disableLoading(a)})},activateLicense:function(a){a.fn.enableLoading(a);var e=g.extend(!0,{},a.license),e=JSON.stringify(e);g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",cache:!1,data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_update,type:"license",data:e}}).done(function(e){console.log(e),e?a.fn.showNotice(a,e.data.msg,e.success?"notice-success":"notice-error"):a.fn.showNotice(a,a.wp_ajax_msg_error,"notice-error")}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){a.fn.disableLoading(a)})},deleteAllData:function(a,e){var t={text:e};a.modal.fn.show(a,"confirm",t).then(function(e){a.modal.fn.close(a,t.id),"close"!=e&&e&&(a.fn.enableLoading(a),g.ajax({url:a.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_delete_data}}).done(function(e){e?a.fn.showNotice(a,e.data.msg,e.success?"notice-success":"notice-error"):a.fn.showNotice(a,a.wp_ajax_msg_error,"notice-error")}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){a.fn.disableLoading(a),a.rootScope.scan()}),a.rootScope.scan())})},showNotice:function(e,t,n){var a=g("#ipanorama-messages"),i=g("<div>").addClass("notice is-dismissible").addClass(n),n=g("<p>").html(t),t=g("<button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function o(){clearTimeout(i.data("timer")),i.fadeTo(100,0,function(){i.slideUp(100,function(){i.remove()})})}i.data("timer",setTimeout(o,5e3)),t.click(function(e){e.preventDefault(),o()}),i.append(n,t),a.append(i)},onTab:function(e,t){if(!e.ui.tabs[t]){var n,a=e.ui.tabs;for(n in a)a.hasOwnProperty(n)&&(a[n]=!1);switch(e.ui.tabs[t]=!0,e.fn.saveEditorsData(e),e.rootScope.scan(),t){case"general":break;case"customCSS":var i=g("#ipanorama-notepad-css"),i=ace.edit(i.get(0));i.$blockScrolling=1/0,i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/css"),e.config.themeCSS&&i.setTheme("ace/theme/"+e.config.themeCSS),e.config.customCSS.data&&i.getSession().setValue(e.config.customCSS.data);break;case"customJS":i=g("#ipanorama-notepad-js"),i=ace.edit(i.get(0));i.$blockScrolling=1/0,i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/javascript"),e.config.themeJavaScript&&i.setTheme("ace/theme/"+e.config.themeJavaScript),e.config.customJS.data&&i.getSession().setValue(e.config.customJS.data)}}}},modal:{count:0,items:[],fn:{resize:function(e){var e=g("#ipanorama-modal-"+e.id),t=(e.find(".ipanorama-modal-dialog"),e.find(".ipanorama-modal-header")),n=e.find(".ipanorama-modal-data"),e=e.find(".ipanorama-modal-footer"),t=t.outerHeight()+e.outerHeight()+50,e=g(window).height();e-t<n.height()&&n.outerHeight(e-t)},show:function(a,e,n,t){var i=++a.modal.count,o=g.Deferred();return a.modal.items.push(i),a.inprocess++,g.ajax({url:a.wp_ajax_url,type:"GET",dataType:"html",data:{nonce:a.wp_ajax_nonce,action:a.wp_ajax_action_modal,name:e}}).done(function(e){g("body").addClass("ipanorama-modal-open");var e=g(e),t={};t.modalData=n,t.modalData.id=i,t.modalData.deferred=o,t.modalData.appData=a,null!=n.easyClose&&!n.easyClose||e.on("click",function(e){t.modalData.deferred.resolve("close")}),g("#ipanorama-modals").append(e),e.find(".ipanorama-modal-dialog").on("click",function(e){return!1}),n.rootScope=a.alight(e.get(0),t),a.modal.fn.resize(n)}).fail(function(e,t,n){e=a.wp_ajax_msg_error+(e.status?" "+e.status+" ":"")+(e.statusText?" ("+e.statusText+") ":"");a.fn.showNotice(a,e,"notice-error")}).always(function(){t&&"function"==typeof t&&t.call(this,n),a.inprocess--}),o.promise()},close:function(e,t){g("#ipanorama-modal-"+t).remove();t=e.modal.items.indexOf(t);e.modal.items.splice(t,1),0==e.modal.items.length&&jQuery("body").removeClass("ipanorama-modal-open")}}}};window.alightInitCallback=function(e){delete window.alightInitCallback,e.directives.al.text={restrict:"EA",link:function(a,e,i,o){var r=g(e),s=r.attr("data-regex"),l=g(e);l.on("input change",function(e){var t=l.val(),n=!0;!function(e){return!e||/^\s*$/.test(e)}(t)?s&&!t.match(s)&&(n=!1):t=null;n?(o.setValue(i,t),o.scan(),function(){var e=r.data("callback");e&&o.changeDetector.compile(e)(a)}(),r.removeClass("ipanorama-invalid")):r.addClass("ipanorama-invalid")}),void 0===o.getValue(i)&&void 0!==r.attr("data-default")&&(e=r.data("default"),o.setValue(i,e)),o.watch(i,function(e){null==e?l.val(null):l.val(e)},{readOnly:!0})}},e.directives.al.toggle={restrict:"EA",link:function(t,e,n,a){var i=g(e);i.addClass("ipanorama-toggle").html("&nbsp;"),i.on("mousedown touchstart",function(e){a.setValue(n,!a.getValue(n)),a.scan(),function(){var e=i.data("callback");e&&a.changeDetector.compile(e)(t)}()}),a.watch(n,function(e){e?i.addClass("ipanorama-checked").removeClass("ipanorama-unchecked"):i.removeClass("ipanorama-checked").addClass("ipanorama-unchecked")},{readOnly:!0})}},e.directives.al.permissionslist={restrict:"EA",link:function(t,e,c,u){var n=g(e),p=g("<ul>"),d=n.data("roles-src"),f=n.data("role-admin"),h=[];function m(){var e=n.data("callback");e&&u.changeDetector.compile(e)(t)}function v(e){for(var t=0;t<h.length;t++)if(h[t].id==e)return h[t].name;return""}n.children("div").each(function(){var e=g(this),t=e.data("role-state-id"),e=e.data("role-state-name");t&&h.push({id:t,name:e})}),n.empty().addClass("ipanorama-permissionslist").append(p),n.on("click",".ipanorama-checkbox",function(e){for(var t=g(this),n=t.parent(),a=n.data("role-id"),i=u.getValue(d),o=0;o<i.length;o++)if(i[o].id==a){var r=u.getValue(c),s=null;if(r)for(var l=0;l<r.length;l++)if(r[l].id==a){s=r[l];break}s&&(s.active=!s.active,t.toggleClass("ipanorama-checked",s.active),n.attr({"data-role-active":s.active}),u.setValue(c,r),u.scan(),m());break}}),n.on("click",".ipanorama-role-state",function(e){for(var t=g(this),n=t.parent(),a=n.data("role-id"),i=u.getValue(d),o=0;o<i.length;o++)if(i[o].id==a){var r=u.getValue(c),s=null;if(r)for(var l=0;l<r.length;l++)if(r[l].id==a){s=r[l];break}s&&(s.state=function(e){for(var t=0;t<h.length;t++)if(h[t].id==e)return(t+1==h.length?h[0]:h[t+1]).id;return""}(s.state),t.text(v(s.state)),n.attr({"data-role-state":s.state}),u.setValue(c,r),u.scan(),m());break}}),d&&u.watch(d,function(e){var t=u.getValue(d),n=u.getValue(c);if(p.empty(),t instanceof Array)for(var a=0;a<t.length;a++){var i=g("<li>").attr({"data-role-id":t[a].id}),o=g("<div>").addClass("ipanorama-checkbox"),r=g("<div>").addClass("ipanorama-role-name").text(t[a].name),s=g("<div>").addClass("ipanorama-role-state");if(f==t[a].id&&(o.addClass("ipanorama-checked ipanorama-readonly"),s.addClass("ipanorama-hidden"),i.attr({"data-role-active":!0,"data-role-state":"all"})),n instanceof Array)for(var l=0;l<n.length;l++)if(n[l].id==t[a].id){o.toggleClass("ipanorama-checked",n[l].active),s.text(v(n[l].state)),i.attr({"data-role-active":n[l].active,"data-role-state":n[l].state});break}i.append(o,r,s),p.append(i)}},{readOnly:!0})}},t.config=g.extend(!0,{},t.defaultConfig),t.license=g.extend(!0,{},t.defaultLicense),t.alight=e,t.rootScope=t.alight(document.querySelectorAll("#ipanorama-app-settings")[0],{appData:t}),t.fn.init(t)}}e=function(){function s(){for(var e=0,t={};e<arguments.length;e++){var n,a=arguments[e];for(n in a)t[n]=a[n]}return t}function c(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(l){function r(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s({path:"/"},r.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var a=JSON.stringify(t);/^[\{\[]/.test(a)&&(t=a)}catch(e){}t=l.write?l.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i,o="";for(i in n)n[i]&&(o+="; "+i,!0!==n[i]&&(o+="="+n[i].split(";")[0]));return document.cookie=e+"="+t+o}}function t(e,t){if("undefined"!=typeof document){for(var n={},a=document.cookie?document.cookie.split("; "):[],i=0;i<a.length;i++){var o=a[i].split("="),r=o.slice(1).join("=");t||'"'!==r.charAt(0)||(r=r.slice(1,-1));try{var s=c(o[0]),r=(l.read||l)(r,s)||c(r);if(t)try{r=JSON.parse(r)}catch(e){}if(n[s]=r,e===s)break}catch(e){}}return e?n[e]:n}}return r.set=n,r.get=function(e){return t(e,!1)},r.getJSON=function(e){return t(e,!0)},r.remove=function(e,t){n(e,"",s(t,{expires:-1}))},r.defaults={},r.withConverter=e,r}(function(){})},"function"==typeof define&&define.amd&&(define(e),r=!0),"object"==typeof exports&&(module.exports=e(),r=!0),r||(t=window.Cookies,(n=window.Cookies=e()).noConflict=function(){return window.Cookies=t,n}),g("#ipanorama-app-items").length?g(".ipanorama-root .ipanorama-toggle").on("click touchend",function(e){e.stopPropagation(),e.preventDefault();var t,n,a,i,o=g(this),e=o.data("id"),r=null;o.hasClass("ipanorama-locked")||(o.addClass("ipanorama-readonly"),r=o.hasClass("ipanorama-checked")?(o.removeClass("ipanorama-checked").addClass("ipanorama-unchecked"),!1):(o.removeClass("ipanorama-unchecked").addClass("ipanorama-checked"),!0),t=ipanorama_globals.ajax_url,n=ipanorama_globals.ajax_nonce,a=ipanorama_globals.ajax_action_update,i=ipanorama_globals.ajax_msg_error,e={id:e,active:r},e=g.extend(!0,{},e),e=JSON.stringify(e),g.ajax({url:t,type:"POST",dataType:"json",data:{nonce:n,action:a,config:e}}).done(function(e){e&&!e.success&&(r?o.removeClass("ipanorama-checked").addClass("ipanorama-unchecked"):o.removeClass("ipanorama-unchecked").addClass("ipanorama-checked"))}).fail(function(e,t,n){console.log(i)}).always(function(){o.removeClass("ipanorama-readonly")}))}):g("#ipanorama-app-item").length?i():g("#ipanorama-app-settings").length&&o();var r,s=g(".ipanorama-page-info"),l=(s.length&&!Cookies.get("ipanorama-page-info-hidden")&&s.addClass("ipanorama-active").find(".ipanorama-page-info-close").on("click",function(e){s.removeClass("ipanorama-active"),Cookies.set("ipanorama-page-info-hidden",!0,{expires:360})}),g(".ipanorama-page-feedback"));function c(){function x(e,t){0<=(t=e.indexOf(t))?e.splice(t,1):console.warn("trying to remove not exist item")}var n,a,u,w,I,B,y,T,l,N,P,V,i,k,R,$,U,z,F,M,H,W,j,e,t,r,o,s,J,c,p,d,K,Z,q,S,C,A,Y,X,b,E,f,Q,ee,h,m,te,_,ne,v,ae,ie,oe,re,se,g,D,le,O,ce,G=function(e,t){return G.bootstrap(e,t)},L=(G.version="0.14.0",G.filters={},G.text={},G.core={},G.utils={},G.option={globalController:!1,removeAttribute:!0,domOptimization:!0,domOptimizationRemoveEmpty:!0,fastBinding:!0},G.debug={scan:0,directive:!1,watch:!1,watchText:!1,parser:!1},G.ctrl=G.controllers={},G.d=G.directives={al:{},bo:{},$global:{}},G.hooks={directive:[],binding:[]},G.priority={al:{app:2e3,checked:20,class:30,css:30,focused:20,if:700,ifnot:700,model:25,radio:25,repeat:1e3,select:20,stop:-10,value:20,on:10},$component:5,$attribute:-5},G.f$={});function ue(t,e){var n,a,i,o,r=[],s=!1,l=e.cd,c=e.callback;return e.filterConf.args.length?(a=[],e.filterConf.args.forEach(function(e,t){e=l.watch(e,function(e){r[t+1]=e,o()});e.$.isStatic||a.push(e)}),i=!1,o=function(){i||(i=!0,l.watch("$onScanOnce",function(){var e;i=!1,s&&(e=t.apply(null,r),L.isPromise(e)?e.then(function(e){c(e),l.scan()}):c(e))}))},a.length&&(n=function(){a.forEach(function(e){return e.stop()})})):o=function(){var e=t(r[0]);L.isPromise(e)?e.then(function(e){c(e),l.scan()}):c(e)},{onChange:function(e){s=!0,r[0]=e,o()},onStop:n,watchMode:e.watchMode}}function pe(e,t,n,a,i,o){a.callback.apply(null,o);a=t._properties.root;a&&a.topCD&&a.topCD.scan({zone:!0})}function de(e,t,n,a){a.setValue(a.attrArgument,t)}function fe(e){return e.replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()})}function he(e){var t,n=e.listener,a=e.childCD,i=e.name,o=e.parentName,e=e.parentCD,r={},i=fe(i);if(n&&!0!==n)if(ce.isFunction(n))t=n;else{if(t=n.onChange,"copy"===n||"copy"===n.watchMode)return void(t?t(o):a.scope[i]=o);"array"!==n&&"array"!==n.watchMode||(r.isArray=!0),"deep"!==n&&"deep"!==n.watchMode||(r.deep=!0)}e.watch(o,t=t||function(e){a.scope[i]=e,a.scan()},r)}return L.before=function(e,t){e.parentNode.insertBefore(t,e)},L.after=function(e,t){var n=e.parentNode,e=e.nextSibling;e?n.insertBefore(t,e):n.appendChild(t)},L.remove=function(e){var t=e.parentNode;t&&t.removeChild(e)},L.on=function(e,t,n){e.addEventListener(t,n,!1)},L.off=function(e,t,n){e.removeEventListener(t,n,!1)},L.isFunction=function(e){return e&&"[object Function]"===Object.prototype.toString.call(e)},L.isObject=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},L.isPromise=function(e){return e&&window.Promise&&e instanceof window.Promise},L.isElement=function(e){return e instanceof HTMLElement},L.addClass=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},L.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^| )"+t.split(" ").join("|")+"( |$)","gi")," ")},L.rawAjax=function(e){var t,n=new XMLHttpRequest;for(t in n.open(e.type||"GET",e.url,!0,e.username,e.password),e.headers)n.setRequestHeader(t,e.headers[t]);e.success&&(n.onload=function(){200<=n.status&&n.status<400?e.success(n.responseText):e.error&&e.error()}),e.error&&(n.onerror=e.error),n.send(e.data||null)},L.ajaxCache={},L.ajax=function(e){if(e.username||e.password||e.headers||e.data||!e.cache)return L.rawAjax(e);var t=e.type||"GET",n=t+":"+e.url,a=L.ajaxCache[n];a||(L.ajaxCache[n]=a={callback:[]}),a.result?e.success&&e.success(a.result):(a.callback.push(e),a.loading||(a.loading=!0,L.rawAjax({type:t,url:e.url,success:function(e){a.loading=!1,a.result=e;for(var t=0;t<a.callback.length;t++)a.callback[t].success&&a.callback[t].success(e);a.callback.length=0},error:function(){a.loading=!1;for(var e=0;e<a.callback.length;e++)a.callback[e].error&&a.callback[e].error();a.callback.length=0}})))},e='@charset "UTF-8";[al-cloak],[hidden],.al-hide{display:none !important;}',t=document.querySelectorAll("head")[0],(g=document.createElement("style")).setAttribute("type","text/css"),g.styleSheet?g.styleSheet.cssText=e:g.appendChild(document.createTextNode(e)),t.appendChild(g),L.ready=(a=!(n=[]),L.on(document,"DOMContentLoaded",function e(){a=!0,L.off(document,"DOMContentLoaded",e);for(var t=0;t<n.length;t++)n[t]();n.length=0}),function(e){a?e():n.push(e)}),window.jQuery&&(window.jQuery.fn.alight=function(e){var n=[];if(this.each(function(e,t){return n.push(t)}),n.length)return G(n,e)}),G.core.getFilter=function(e,t){t=t.locals[e];if(t&&(L.isFunction(t)||t.init||t.fn))return t;if(t=G.filters[e])return t;throw"Filter not found: "+e},G.core.buildFilterNode=function(e,t,n,a){if(L.isFunction(n))return ue(n,{cd:e,filterConf:t,callback:a});if(n.init)return n.init.call(e,e.scope,t.raw,{setValue:a,conf:t,changeDetector:e});if(L.isFunction(n.fn))return ue(n.fn,{cd:e,filterConf:t,callback:a,watchMode:n.watchMode});throw"Wrong filter: "+t.name},G.ChangeDetector=function(e){var t=new I,e=new u(t,e||{});return t.topCD=e},(I=function(){return this.watchers={any:[],finishBinding:[],finishScan:[],finishScanOnce:[],onScanOnce:[]},this.status=null,this.extraLoop=!1,this.finishBinding_lock=!1,this.lateScan=!1,this.topCD=null,this}).prototype.destroy=function(){if(this.watchers.any.length=0,this.watchers.finishBinding.length=0,this.watchers.finishScan.length=0,this.watchers.finishScanOnce.length=0,this.watchers.onScanOnce.length=0,this.topCD)return this.topCD.destroy()},(u=function(e,t){this.scope=t,this.locals=t,this.root=e,this.watchList=[],this.destroy_callbacks=[],this.parent=null,this.children=[],this.rwatchers={any:[],finishScan:[],elEvents:[]}}).prototype.new=function(e,t){var n,a;return t=t||{},a=this,null==e&&(e=a.scope),(n=new u(a.root,e)).parent=a,e===a.scope&&(t.locals?((t=a._ChildLocals)||(a._ChildLocals=t=function(){return this.$$root=e,this},t.prototype=a.locals),n.locals=new t):n.locals=a.locals),a.children.push(n),n},u.prototype.destroy=function(){var e,t,n,a,i,o,r,s,l,c,u,p,d,f,h,m,v,g,b,w,y,k=this,_=k.root;for(k.scope=null,k.parent&&x(k.parent.children,k),n=0,o=(h=k.destroy_callbacks).length;n<o;n++)(0,h[n])();for(a=0,r=(m=k.children.slice()).length;a<r;a++)m[a].destroy();for(i=k.destroy_callbacks.length=0,s=(v=k.watchList).length;i<s;i++)(e=v[i]).onStop&&e.onStop();for(p=k.watchList.length=0,l=(g=k.rwatchers.any).length;p<l;p++)y=g[p],x(_.watchers.any,y);for(d=k.rwatchers.any.length=0,c=(b=k.rwatchers.finishScan).length;d<c;d++)y=b[d],x(_.watchers.finishScan,y);for(f=k.rwatchers.finishScan.length=0,u=(w=this.rwatchers.elEvents).length;f<u;f++)t=w[f],L.off(t[0],t[1],t[2]);this.rwatchers.elEvents.length=0,_.topCD===k&&(_.topCD=null,_.destroy())},B=function(e){return this.cb=e},i=function(e,t,n){var a=e.root,i=new B(n);return e.rwatchers[t].push(i),a.watchers[t].push(i),{stop:function(){return x(e.rwatchers[t],i),x(a.watchers[t],i)}}},u.prototype.on=function(e,t,n){return L.on(e,t,n),this.rwatchers.elEvents.push([e,t,n])},N={$any:function(e,t){return i(e,"any",t)},$finishScan:function(e,t){return i(e,"finishScan",t)},$finishScanOnce:function(e,t){e.root.watchers.finishScanOnce.push(t)},$onScanOnce:function(e,t){e.root.watchers.onScanOnce.push(t)},$destroy:function(e,t){e.destroy_callbacks.push(t)},$finishBinding:function(e,t){e.root.watchers.finishBinding.push(t)}},k=function(){},u.prototype.watch=function(t,n,e){var a,i,o,r,s,l,c=N[t];if(c)return c(this,n);if((e=!0===(e=e||{})?{isArray:!0}:e).init&&console.warn("watch.init is depricated"),(a=this).root,l=a.scope,L.isFunction(t)?(o=t,r=G.utils.getId(),d=!0):(d=!1,o=null,"::"===(t=t.trim()).slice(0,2)&&(t=t.slice(2),e.oneTime=!0),r=t,r=e.deep?"d#"+r:e.isArray?"a#"+r:"v#"+r),G.debug.watch&&console.log("$watch",t),c=!1,!d)if(e.watchText)o=e.watchText.fn;else{if((r=G.utils.compile.expression(t)).filter){for(var u,p=a,d=r,f=n,h=e,m=null,v=h.oneTime,g=(h.isArray?m="array":h.deep&&(m="deep"),f||(u={el:h.element,ea:h.elementAttr},f=function(e){T(p.scope,u,e)}),G.utils.parsFilter(d.filter)),b=[],w=g.result.length-1;0<=w;w--){var y=G.core.getFilter(g.result[w].name,p),y=G.core.buildFilterNode(p,g.result[w],y,f);y.watchMode&&(m=y.watchMode),y.onStop&&b.push(y.onStop),f=y.onChange}return h={oneTime:v},"array"===m?h.isArray=!0:"deep"===m&&(h.deep=!0),b.length&&(h.onStop=function(){b.forEach(function(e){return e()}),b.length=0}),p.watch(d.expression,f,h)}c=r.isSimple&&0===r.simpleVariables.length,o=r.fn}return e.deep&&(e.isArray=!1),i={isStatic:c,isArray:Boolean(e.isArray),extraLoop:!e.readOnly,deep:!0===e.deep?10:e.deep,value:k,callback:n,exp:o,src:""+t,onStop:e.onStop||null,el:e.element||null,ea:e.elementAttr||null},c?a.watch("$onScanOnce",function(){return T(l,i,i.exp(l))}):a.watchList.push(i),s={$:i,stop:function(){if(e.onStop)try{e.onStop()}catch(e){G.exceptionHandler(e,"Error in onStop of watcher: "+t,t)}if(!i.isStatic)return x(a.watchList,i)},refresh:function(){var e=i.exp(a.locals);return e&&i.deep?i.value=G.utils.clone(e,i.deep):e&&i.isArray?i.value=e.slice():i.value=e}},e.oneTime&&(i.callback=function(e){if(void 0!==e)return s.stop(),n(e)}),s},u.prototype.watchGroup=function(e,t){var n,a,i,o,r,s=this;if(!t&&L.isFunction(e)&&(t=e,e=null),r=!1,n=function(){if(!r)return r=!0,s.watch("$onScanOnce",function(){return r=!1,t()})},e)for(a=0,o=e.length;a<o;a++)i=e[a],s.watch(i,n);return n},l=window.performance?function(){return Math.floor(performance.now())}:function(){return(new Date).getTime()},P=function(e,t){var n,a,i,o;if(null===e||null===t)return!0;if((o=typeof e)!=typeof t)return!0;if("object"==o){if(e.length!==t.length)return!0;for(n=a=0,i=e.length;a<i;n=++a)if(e[n]!==t[n])return!0}return!1},T=function(e,t,n){t.el?t.ea?t.el.setAttribute(t.ea,n):t.el.nodeValue=n:t.callback.call(e,n)},y=function(e,t,n,a){t={src:n.src,scope:t.scope,locals:t.locals};return n.el&&(t.element=n.el),G.exceptionHandler(e,(1===a?"$scan, error in callback: ":"$scan, error in expression: ")+n.src,t)},w=function(){},V=function(e,t){e.root;var n,a,i,o,r,s,l,c,u,p,d,f,h,m,v=!1,g=0,b=0;if(e){for(d=[],r=0,i=e;i;){for(u=i.locals,b+=i.watchList.length,s=0,c=(f=i.watchList.slice()).length;s<c;s++){l=(m=f[s]).value;try{h=m.exp(u)}catch(e){o=e,h=w}if(l!==h){if(p=!1,m.isArray?(n=Array.isArray(l))===(a=Array.isArray(h))?n?P(l,h)&&(p=!0,m.value=h.slice()):(p=!0,m.value=h):(p=!0,m.value=a?h.slice():h):m.deep?G.utils.equal(l,h,m.deep)||(p=!0,m.value=G.utils.clone(h,m.deep)):(p=!0,m.value=h),p)if(p=!1,h===w)y(o,i,m);else{g++;try{m.el?m.ea?null!=h?m.el.setAttribute(m.ea,h):m.el.removeAttribute(m.ea):m.el.nodeValue=h:(l===k&&(l=void 0),"$scanNoChanges"!==m.callback.call(i.scope,h,l)&&m.extraLoop&&(v=!0))}catch(e){y(o=e,i,m,1)}}1<G.debug.scan&&console.log("changed:",m.src)}}d.push.apply(d,i.children),i=d[r++]}t.total=b,t.changes=g,t.extraLoop=v}},u.prototype.digest=function(){var e,t,n,a,i,o=this.root,r=10,s=0;for(G.debug.scan&&(i=l()),a={total:0,changes:0,extraLoop:!1,src:"",scope:null,element:null};r;){if(r--,o.extraLoop=!1,o.watchers.onScanOnce.length)for(n=o.watchers.onScanOnce.slice(),e=o.watchers.onScanOnce.length=0,t=n.length;e<t;e++)n[e].call(o);if(V(this,a),s+=a.changes,!a.extraLoop&&!o.extraLoop&&!o.watchers.onScanOnce.length)break}return G.debug.scan&&(i=l()-i,console.log("$scan: loops: ("+(10-r)+"), last-loop changes: "+a.changes+", watches: "+a.total+" / "+i+"ms")),a.mainLoop=r,a.totalChanges=s,a},u.prototype.scan=function(e){var t,n,a,i,o,r,s,l,c,u=this.root;if(e=e||{},!G.option.zone||e.zone){if((e=L.isFunction(e)?{callback:e}:e).callback&&u.watchers.finishScanOnce.push(e.callback),e.late)return u.lateScan?void 0:(u.lateScan=!0,void G.nextTick(function(){if(u.lateScan)return u.topCD.scan()}));if("scaning"!==u.status){if(u.lateScan=!1,u.status="scaning",(e=u.topCD?u.topCD.digest():{}).totalChanges)for(n=0,o=(l=u.watchers.any).length;n<o;n++)(0,l[n])();for(u.status=null,a=0,r=(c=u.watchers.finishScan).length;a<r;a++)(0,c[a])();for(t=u.watchers.finishScanOnce.slice(),i=u.watchers.finishScanOnce.length=0,s=t.length;i<s;i++)t[i].call(u);if(0===e.mainLoop)throw"Infinity loop detected";return e}u.extraLoop=!0}},(G.core.ChangeDetector=u).prototype.compile=function(e,t){return G.utils.compile.expression(e,t).fn},u.prototype.setValue=function(t,n){var a,i,o,r,s,l,c,u,p=this.compile(t+" = $value",{input:["$value"],no_return:!0});try{return p(this.locals,n)}catch(e){if(a=e,l="can't set variable: "+t,G.debug.parser&&console.warn(l),0<=(""+a).indexOf("TypeError")&&(u=t.match(/^([\w\d\.]+)\.[\w\d]+$/))&&u[1]){for(s=this.locals,i=0,r=(c=u[1].split(".")).length;i<r;i++)void 0===s[o=c[i]]&&(s[o]={}),s=s[o];try{return void p(this.locals,n)}catch(e){}}return G.exceptionHandler(a,l,{name:t,value:n})}},u.prototype.eval=function(e){return this.compile(e)(this.locals)},u.prototype.getValue=function(e){return this.eval(e)},G.text.$base=function(t){var n=t.point,e=t.cd,a=e.scope,i=(a.$ns&&a.$ns.text?a.$ns:G).text[t.name];if(i)return i.call(e,(i={changeDetector:e,setter:function(e){if(t.update)return n.value=null===e?"":""+e,t.update()},setterRaw:function(e){if(t.updateRaw)return n.value=null===e?"":""+e,t.updateRaw()},finally:function(e){if(t.finally)return n.value=null===e?"":""+e,n.type="text",t.finally(),t.update=null,t.finally=null}}).setter,t.exp,a,i);throw"No directive alight.text."+t.name},u.prototype.watchText=function(e,t,n){var a,i,o,r,s,l,c,u,p,d,f,h,m,v,g,b,w,y,k,_,x,S,C,A,E,D;if(n=n||{},i=this,G.debug.watchText&&console.log("$watchText",e),x=G.utils.compile.buildSimpleText(e,null))i.watch(e,t,{watchText:x,element:n.element,elementAttr:n.elementAttr});else{for(r=G.utils.parsText(e),k=!(a=!(E=0)),l=c=s=function(){},h=0,g=r.length;h<g;h++)if("expression"===(o=r[h]).type)if(y=(u=o.list.join("|")).match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/))o.isDir=!0,y=y[1],u="#"===y?(f=u.indexOf(" "))<0?(y=u.substring(1),""):(y=u.slice(1,f),u.slice(f)):u.substring(y.length),G.text.$base({name:y,exp:u,cd:i,point:o,update:function(){return l()},updateRaw:function(){return c()},finally:function(){return l(),s()}}),k=!0,"text"!==o.type&&(a=!1);else if((y=G.utils.compile.expression(u,{string:!0})).filter)E++,o.watched=!(a=!1),!function(t){i.watch(u,function(e){return t.value=e=null==e?"":e,l()})}(o);else{if(o.fn=y.fn,!y.rawExpression)throw"Error";y.isSimple&&0===y.simpleVariables.length?(o.type="text",o.value=o.fn()):(o.re=y.rawExpression,E++)}if(a)if(E)x=k?G.utils.compile.buildSimpleText(null,r):G.utils.compile.buildSimpleText(e,r),i.watch(e,t,{watchText:{fn:x.fn},element:n.element,elementAttr:n.elementAttr});else{for(C="",m=0,b=r.length;m<b;m++)o=r[m],C+=o.value;i.watch("$onScanOnce",function(){return T(i.scope,{callback:t,el:n.element,ea:n.elementAttr},C)})}else if(D={callback:t,el:n.element,ea:n.elementAttr},r.scope=i.scope,d=G.utils.compile.buildText(e,r),c=function(){return T(i.scope,D,d())},E){for(A=null,_="",l=function(){_=d()},s=function(){var e,t;for(f=!0,e=0,t=r.length;e<t;e++)if("expression"===(o=r[e]).type){f=!1;break}f&&(i.watch("$finishScanOnce",function(){return A.stop()}),n.onStatic&&n.onStatic())},x=function(){return _},v=0,w=r.length;v<w;v++)"expression"!==(o=r[v]).type||o.isDir||o.watched||(o.watched=!0,function(t,e){i.watch(e,function(e){return t.value=e=null==e?"":e,l()})}(o,o.list.join(" | ")));l(),A=i.watch(x,t,{element:n.element,elementAttr:n.elementAttr})}else S=!1,p=function(){return S=!1,c()},(l=function(){if(!S)return S=!0,i.watch("$onScanOnce",p)})()}},R={TR:1,TD:1,LI:1},G.utils.optmizeElement=function(e,t){var n,a,i,o,r,s,l,c,u,p,d,f,h,m,v,g,b,w,y;if(1===e.nodeType){for(t=t||!G.option.domOptimizationRemoveEmpty,"PRE"===e.nodeName&&(t=!0),!(o=e.firstChild)||3!==o.nodeType||o.nodeValue.trim()||t||(L.remove(o),o=e.firstChild),v=!1;o;)h=o.nextSibling,!v||3!==o.nodeType||o.nodeValue.trim()||t?(v=1===o.nodeType&&R[o.nodeName],G.utils.optmizeElement(o,t)):L.remove(o),o=h;!(o=e.lastChild)||3!==o.nodeType||o.nodeValue.trim()||t||L.remove(o)}else if(3===e.nodeType&&(w=e.data,d=G.utils.pars_start_tag,!((s=w.indexOf(d))<0||w.slice(s+d.length).indexOf(d)<0))){for(m="t",b=[n={value:""}],l=0,u=(i=G.utils.parsText(w)).length;l<u;l++)"text"===(a=i[l]).type?n.value+=a.value:(r=a.list.join("|"),y=G.utils.pars_start_tag+r+G.utils.pars_finish_tag,r.match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/)?("t"===m||"d"===m?n.value+=y:b.push(n={value:y}),m="d"):1===a.list.length?("t"===m||"v"===m?n.value+=y:b.push(n={value:y}),m="v"):"t"===m?n.value+=y:b.push(n={value:y}));if(!(b.length<2))for((o=e).data=b[0].value,c=0,p=(g=b.slice(1)).length;c<p;c++)a=g[c],f=document.createTextNode(a.value),L.after(o,f),o=f}},G.hooks.attribute=e=[],e.push({code:"dataPrefix",fn:function(){"data-"===this.attrName.slice(0,5)&&(this.attrName=this.attrName.slice(5))}}),e.push({code:"colonNameSpace",fn:function(){var e,t;this.directive||this.name||((t=(e=(t=this.attrName.match(/^(\w+)[\-\:](.+)$/))?(this.ns=t[1],t[2]):(this.ns="$global",this.attrName)).match(/^([^\.]+)\.(.*)$/))&&(e=t[1],this.attrArgument=t[2]),this.name=e.replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}))}}),e.push({code:"getGlobalDirective",fn:function(){var e;this.directive||((e=G.d[this.ns])?(this.directive=e[this.name],this.directive||("$global"===this.ns?this.result="noNS":this.result="noDirective",this.stop=!0)):(this.result="noNS",this.stop=!0))}}),e.push({code:"cloneDirective",fn:function(){var e,t,n=this.directive,a=this.ns,i=this.name,o={};if(L.isFunction(n))o.init=n;else{if(!L.isObject(n))throw"Wrong directive: "+a+"."+i;for(e in n)t=n[e],o[e]=t}if(o.priority=n.priority||G.priority[a]&&G.priority[a][i]||0,o.restrict=n.restrict||"A",o.restrict.indexOf(this.attrType)<0)throw"Directive has wrong binding (attribute/element): "+i;this.directive=o}}),e.push({code:"preprocessor",fn:function(){var r=this.ns,s=this.name,l=this.directive;l.$init=function(e,t,n,a){var i=function(){for(var e,t=o.procLine,n=e=0,a=t.length;e<a;n=++e)if(t[n].fn.call(o),o.isDeferred){o.procLine=t.slice(n+1);break}return o.async=!0,null},o={element:t,value:n,cd:e,env:a,ns:r,name:s,doBinding:!1,directive:l,isDeferred:!1,procLine:G.hooks.directive,makeDeferred:function(){return o.isDeferred=!0,o.doBinding=!0,o.retStopBinding=!0,o.async=!1,function(){if(o.isDeferred=!1,o.async)return i()}}};if(l.stopBinding&&(a.stopBinding=!0),i(),o.retStopBinding)return"stopBinding"}}}),(t=G.hooks.directive).push({code:"init",fn:function(){var e;this.directive.init&&(G.debug.directive&&this.directive.scope&&console.warn(this.ns+"-"+this.name+" uses scope and init together, probably you need use link instead of init"),this.env.changeDetector=this.cd,(e=this.directive.init.call(this.env,this.cd.scope,this.element,this.value,this.env))&&e.start&&e.start())}}),t.push({code:"templateUrl",fn:function(){var t,n=this;this.directive.templateUrl&&(t=this.makeDeferred(),L.ajax({cache:!0,url:this.directive.templateUrl,success:function(e){return n.directive.template=e,t()},error:t}))}}),t.push({code:"template",fn:function(){var e;this.directive.template&&(1===this.element.nodeType?this.element.innerHTML=this.directive.template:8===this.element.nodeType&&((e=document.createElement("p")).innerHTML=this.directive.template.trim(),e=e.firstChild,L.after(this.element,e),this.element=e,this.doBinding=!0))}}),t.push({code:"scope",fn:function(){var e,t;if(this.directive.scope){switch(t=this.cd,this.directive.scope){case!0:e=t.new({$parent:t.scope});break;case"root":e=G.ChangeDetector({$parent:t.scope}),t.watch("$destroy",function(){return e.destroy()});break;default:throw"Wrong scope value: "+this.directive.scope}this.env.parentChangeDetector=t,this.cd=e,this.doBinding=!0,this.retStopBinding=!0}}}),t.push({code:"link",fn:function(){var e;this.directive.link&&(this.env.changeDetector=this.cd,(e=this.directive.link.call(this.env,this.cd.scope,this.element,this.value,this.env))&&e.start&&e.start())}}),t.push({code:"scopeBinding",fn:function(){this.doBinding&&!this.env.stopBinding&&G.bind(this.cd,this.element,{skip_attr:this.env.skippedAttr()})}}),r=function(e,t,n){var a;"A"===t.attr_type?((a=n||{}).priority=G.priority.$attribute,a.is_attr=!0,a.name=e,a.attrName=e,a.element=t.element,t.list.push(a)):"M"===t.attr_type&&t.list.push(n)},j=function(e,t){var n,a,i,o;if(0<=t.skip_attr.indexOf(e))return r(e,t,{skip:!0});for(n={attrName:e,attrType:t.attr_type,element:t.element,cd:t.cd,result:null},a=0,i=(o=G.hooks.attribute).length;a<i&&(o[a].fn.call(n),!n.stop);a++);if("noNS"!==n.result)return"noDirective"===n.result?"E"===t.attr_type?void t.list.push({name:e,priority:-10,attrName:e,noDirective:!0}):void r(e,t,{noDirective:!0}):void t.list.push({name:e,directive:n.directive,priority:n.directive.priority,attrName:e,attrArgument:n.attrArgument});r(e,t)},W=function(e,t){return e.priority===t.priority?0:e.priority>t.priority?-1:1},U=function(e,t,n,a){if(!(n.indexOf(G.utils.pars_start_tag)<0))return e.watchText(n,null,{element:t,elementAttr:a}),!0},H=function(e,t,n){var a=t.data;if(!(a.indexOf(G.utils.pars_start_tag)<0))return e.watchText(a,null,{element:t}),a},z=function(t,n,e){var a,i,o,r=n.nodeValue.trim();if("directive:"===r.slice(0,10)){if(o=0<=(o=(r=r.slice(10).trim()).indexOf(" "))?(i=r.slice(0,o-1+1||9e9),r.slice(o+1)):(i=r,""),a={list:r=[],element:n,attr_type:"M",cd:t,skip_attr:[]},j(i,a),(a=r[0]).noDirective)throw"Comment directive not found: "+i;i=a.directive,r=new $({element:n,attrName:a.attrName,attributes:r}),G.debug.directive&&console.log("bind",a.attrName,o,a);try{i.$init(t,n,o,r)}catch(e){G.exceptionHandler(e,"Error in directive: "+a.name,{value:o,env:r,cd:t,scope:t.scope,element:n})}return r.skipToElement?{directive:1,skipToElement:r.skipToElement}:{directive:1,skipToElement:null}}},($=function(e){var t,n;for(t in e)n=e[t],this[t]=n;return this}).prototype.takeAttr=function(e,t){var n,a,i,o;for(1===arguments.length&&(t=!0),a=0,i=(o=this.attributes).length;a<i;a++)if((n=o[a]).attrName===e)return t&&(n.skip=!0),this.element.getAttribute(e)||!0},$.prototype.skippedAttr=function(){for(var e,t=this.attributes,n=[],a=0,i=t.length;a<i;a++)(e=t[a]).skip&&n.push(e.attrName);return n},$.prototype.scan=function(e){return this.changeDetector.scan(e)},$.prototype.on=function(e,t,n){return this.changeDetector.on(e,t,n)},$.prototype.watch=function(e,t,n){return this.changeDetector.watch(e,t,n)},$.prototype.watchGroup=function(e,t){return this.changeDetector.watchGroup(e,t)},$.prototype.watchText=function(e,t,n){return this.changeDetector.watchText(e,t,n)},$.prototype.getValue=function(e){return this.changeDetector.getValue(e)},$.prototype.setValue=function(e,t){return this.changeDetector.setValue(e,t)},$.prototype.eval=function(e){return this.changeDetector.eval(e)},$.prototype.new=function(e,t){return!0===t?t={locals:!0}:!0===e&&null==t&&(t={locals:!(e=null)}),this.changeDetector.new(e,t)},$.prototype.bind=function(e,t,n){var a,i,o,r,s,l,c;for(this.stopBinding=!0,s=o=0,l=arguments.length;s<l;s++)(a=arguments[s])instanceof u&&(i=a,o+=1),L.isElement(a)&&(r=a,o+=1);return c=(c=arguments[o])||{skip:this.skippedAttr()},r=r||this.element,i=i||this.changeDetector,G.bind(i,r,c)},F=function(t,i,e){var n,a,o,r,s,l,c,u,p,d,f,h,m,v,g,b,w,y,k,_,x,S,C,A={attr:[],dir:[],children:[]},E={directive:0,hook:0,skipToElement:null,fb:A},D=(e=e||{}).skip_attr;if(!(x=!1)===e.skip?e.skip_top=!0:D=D||e.skip||[],D instanceof Array||(D=[D]),!e.skip_top){for(n={list:g=[],element:i,skip_attr:D,attr_type:"E",cd:t},o=i.nodeName.toLowerCase(),j(o,n),"script"!==o&&"style"!==o||(x=!0),n.attr_type="A",f=0,h=(k=i.attributes).length;f<h;f++)a=k[f],j(a.name,n);if(e.attachDirective)for(o in _=e.attachDirective)_[o],j(o,n);for(b=0,m=(g=g.sort(W)).length;b<m;b++)if(!(c=g[b]).skip){if(c.noDirective)throw"Directive not found: "+c.name;if(c.skip=!0,C=e.attachDirective&&e.attachDirective[c.attrName]?e.attachDirective[c.attrName]:i.getAttribute(c.attrName),c.is_attr)U(t,i,C,c.attrName)&&A.attr.push({attrName:c.attrName,value:C});else{p=c.directive,u=new $({element:i,attrName:c.attrName,attrArgument:c.attrArgument||null,attributes:g,stopBinding:!1,elementCanBeRemoved:e.elementCanBeRemoved,fbElement:e.fbElement}),G.debug.directive&&console.log("bind",c.attrName,C,c);try{"stopBinding"===p.$init(t,i,C,u)&&(x=!0)}catch(e){G.exceptionHandler(e,"Error in directive: "+c.attrName,{value:C,env:u,cd:t,scope:t.scope,element:i})}if(u.fastBinding?(p=L.isFunction(u.fastBinding)?u.fastBinding:p.init,A.dir.push({fb:p,attrName:c.attrName,value:C,attrArgument:u.attrArgument,fbData:u.fbData})):E.directive++,u.stopBinding){x=!0;break}u.skipToElement&&(E.skipToElement=u.skipToElement)}}}if(!x)for(S=null,d=w=0,v=(s=function(){for(var e=i.childNodes,t=[],n=0,a=e.length;n<a;n++)r=e[n],t.push(r);return t}()).length;w<v;d=++w)(r=s[d])&&(S?S===r&&(S=null):(e.fbElement&&(l={fbElement:e.fbElement.childNodes[d]}),y=M(t,r,l),E.directive+=y.directive,E.hook+=y.hook,S=y.skipToElement,y.fb&&(y.fb.text||y.fb.attr&&y.fb.attr.length||y.fb.dir&&y.fb.dir.length||y.fb.children&&y.fb.children.length)&&A.children.push({index:d,fb:y.fb})));return E},M=function(e,t,n){var a,i,o,r,s,l,c={directive:0,hook:0,skipToElement:null,fb:null};if(G.hooks.binding.length)for(i=0,o=(s=G.hooks.binding).length;i<o;i++)if(a=s[i],c.hook+=1,(r=a.fn(e,t,n))&&r.owner)return c;return 1===t.nodeType?(r=F(e,t,n),c.directive+=r.directive,c.hook+=r.hook,c.skipToElement=r.skipToElement,c.fb=r.fb):3===t.nodeType?(l=H(e,t))&&(c.fb={text:l}):8===t.nodeType&&(r=z(e,t))&&(c.directive+=r.directive,c.skipToElement=r.skipToElement),c},G.nextTick=(o=null,s=[],J=function(){var t,e,n,a,i;for(o=null,e=s.slice(),n=s.length=0,a=e.length;n<a;n++){t=(i=e[n])[0],i=i[1];try{t.call(i)}catch(e){G.exceptionHandler(e,"$nextTick, error in function",{fn:t,self:i})}}return null},function(e){if(s.push([e,this]),!o)return o=setTimeout(J,0)}),G.bind=function(e,t,n){var a,i,o,r,s;if(!e)throw"No changeDetector";if(!t)throw"No element";if(n=n||{},G.option.domOptimization&&!n.noDomOptimization&&G.utils.optmizeElement(t),(a=!(s=e.root).finishBinding_lock)&&(s.finishBinding_lock=!0,s.bindingResult={directive:0,hook:0}),t=M(e,t,n),s.bindingResult.directive+=t.directive,s.bindingResult.hook+=t.hook,e.digest(),a){for(s.finishBinding_lock=!1,r=s.watchers.finishBinding.slice(),i=s.watchers.finishBinding.length=0,o=r.length;i<o;i++)(0,r[i])();t.total=s.bindingResult}return t},c=G.bind,G.bind=function(e,t,n){var a=e.root,i=G.option.zone;if(i){var i=!0===i?Zone:i,o=a.zone;if(o||(a.zone=o=i.current.fork({name:i.current.name+".x",properties:{root:a},onInvokeTask:pe})),i.current!==o)return a.zone.run(c,null,[e,t,n])}return c(e,t,n)},G.bootstrap=function(e,t){if(e){var n,a;if(e instanceof G.core.ChangeDetector?(a=e,e=t):t instanceof G.core.ChangeDetector?a=t:L.isFunction(t)?(a=G.ChangeDetector(n={}),t.call(a,n)):t&&(a=G.ChangeDetector(t)),Array.isArray(e)){for(var i=void 0,o=0,r=e;o<r.length;o++){var s=r[o];i=G.bootstrap(s,a)}return i}if("string"==typeof e){for(var i=void 0,l=0,c=document.querySelectorAll(e);l<c.length;l++){var u=c[l];i=G.bootstrap(u,a)}return i}if(a=a||G.ChangeDetector(),L.isElement(e)){for(var p,d,f,h=0,m=["al-app","al:app","data-al-app"];h<m.length&&(d=e.getAttribute(p=m[h]),e.removeAttribute(p),!d);h++);return d&&(f={skip_attr:[p],attachDirective:{}},G.d.al.ctrl?f.attachDirective["al-ctrl"]=d:f.attachDirective[d+"!"]=""),G.bind(a,e,f),a}G.exceptionHandler("Error in bootstrap","Error input arguments",{input:e})}else G.bootstrap("[al-app]"),G.bootstrap("[al\\:app]"),G.bootstrap("[data-al-app]")},G.utils.getId=(K=function(){for(var e,t,n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),a=Math.floor((new Date).valueOf()/1e3)-1388512800,i="";0<a;)t=a-62*(e=Math.floor(a/62)),a=e,i=n[t]+i;return i}(),Z=1,function(){return K+"#"+Z++}),G.utils.clone=p=function(a,i){var o,e,t,n;if((i=null==i?128:i)<1)return null;if(!a)return a;if("object"!=typeof a)return a;if(a instanceof Array)return t=function(){for(var e=[],t=0,n=a.length;t<n;t++)o=a[t],e.push(p(o,i-1));return e}();if(a instanceof Date)return new Date(a.valueOf());if(a.nodeType&&"function"==typeof a.cloneNode)return a;for(e in t={},a)n=a[e],"$"!==e[0]&&(t[e]=p(n,i-1));return t},G.utils.equal=d=function(e,t,n){var a,i,o,r,s,l,c;if(!((n=null==n?128:n)<1)){if(!e||!t)return e===t;if((l=typeof e)!=typeof t)return!1;if("object"!=l)return e===t;if(e instanceof Array){if(e.length!==t.length)return!1;for(a=i=0,r=e.length;i<r;a=++i)if(c=e[a],!d(c,t[a],n-1))return!1}else{if(e instanceof Date)return e.valueOf()===t.valueOf();if(e.nodeType&&"function"==typeof e.cloneNode)return e===t;for(o in s={},e)if(c=e[o],"$"!==o[0]&&(s[o]=!0,!d(c,t[o],n-1)))return!1;for(o in t)if(c=t[o],"$"!==o[0]&&!s[o]&&!d(c,e[o],n-1))return!1}}return!0},G.exceptionHandler=function(e,t,n){var a=[];return t&&a.push(t),e&&e.message&&a.push(e.message),n&&a.push(n),e&&a.push(e.stack||e),console.error.apply(console,a)},E=(b=function(){for(var e={},t=0,n=arguments.length;t<n;t++)e[arguments[t]]=!0;return e})("instanceof","typeof","in","null","true","false","undefined","return"),Y=/[a-zA-Z\u0410-\u044F\u0401\u0451_\.\$]/,S=function(e){return e.match(Y)},C=function(e){return 48<=e.charCodeAt()&&e.charCodeAt()<=57},X=b("+","-",">","<","=","&","|","^","!","~"),A=function(e){return X[e]||!1},q=b("=","+=","-=","++","--","|=","^=","&=","!=","<<=",">>="),G.utils.parsExpression=function(e,t){var f,h,c,_,m,u,v=b.apply(null,(t=t||{}).input||[]),x=1,t=(_=function(e){for(var t,n,a,i,o=e.line,r=e.result||[],s=e.index||0,l=e.level||0,c=e.stopKey||null,u="",p=null,d=[],f="",h="",m=!1,v="",g="",b="",w=0,y=null,k=function(){return b&&r.push({type:"free",value:b}),b=""};s<=o.length;)if(a=o[s-1],t=o[s++]||"",n=o[s],(m&&b||!t)&&k(),"string"===m)t===v&&"\\"!==a?(r.push({type:"string",value:g+=t}),m=v=g=""):g+=t;else{if("key"===m){if(S(t)||C(t)){u+=t;continue}if("["===t){if(u+=t,!(i=_({line:o,index:s,level:l+1,stopKey:"]"})).stopKeyOk)throw"Error expression";s=i.index,u+="###"+i.uniq+"###]",d.push(i);continue}if("?"===t&&("."===n||"("===n||"["===n)){u+=t;continue}if("("===t){if(u+=t,!(i=_({line:o,index:s,level:l+1,stopKey:")"})).stopKeyOk)throw"Error expression";s=i.index,u+="###"+i.uniq+"###)",d.push(i);continue}p={type:"key",value:u,start:s-u.length-1,finish:s-1,children:d},r.push(p),u=m="",d=[]}else if("sign"===m){if(A(t)){f+=t;continue}if("|"===f&&0===l&&0===w){y=o.substring(s-1),s=o.length+1;continue}(q[f]||"="===f[0]&&"="!==f[1])&&(p.assignment=!0),r.push({type:"sign",value:f}),f=m=""}else if("digit"===m){if(C(t)||"."===t){h+=t;continue}r.push({type:"digit",value:h}),h=""}if(S(t))m="key",u+=t;else if(A(t))m="sign",f+=t;else if(C(t))m="digit",h+=t;else if('"'===t||"'"===t)m="string",g+=v=t;else{if(t===c)return k(),{result:r,index:s,stopKeyOk:!0,uniq:x++};"("===t&&w++,")"===t&&w--,"{"===t?(k(),i=_({line:o,index:s,level:l+1,stopKey:"}"}),r.push({type:"{}",child:i}),s=i.index):(":"===t&&"}"===c&&(p.type="free"),b+=t)}}return k(),{result:r,index:s,filter:y}})({line:e}),g={isSimple:!t.filter,simpleVariables:[]};return t.filter?(g.expression=e.substring(0,e.length-t.filter.length-1),g.filter=t.filter):g.expression=e,m=function(e){e=e.split(/[\.\[\(\?]/);return{count:e.length,firstPart:e[0]}},u=function(e,t){return t?"($$="+e+",$$==null)?undefined:":"($$=$$"+e+",$$==null)?undefined:"},c=function(e){return e.split(/[\.\[\(\?]/)[0]},h=function(e){var t,n,a,i,o,r,s,l;if("this"===e)return"$$scope";if(r=c(e),a=E[r]||v[r],"this"===r&&(e="$$scope"+e.slice(4),a=!0),1===(r=e.split("?")).length)return a?e:"$$scope."+e;for(t=a?(l=u(r[0],!0),r[0]):(l=u("scope."+r[0]),"scope."+r[0]),n=0,i=(s=r.slice(1,r.length-1)).length;n<i;n++)"("===(o=s[n])[0]?l+=u(t+o,a):(l+=u(o),t+=o);return"("===(e=r[r.length-1])[0]?(a||(l+="$$"),l+=t+e):l+="$$"+e,"("+l+")"},f=function(e){for(var t,n,a,i,o,r,s,l,c="",u=e.result,p=0,d=u.length;p<d;p++)if("key"===(n=u[p]).type){if(n.assignment?(r="this"===(l=m(n.value)).firstPart?"$$scope"+n.value.substring(4):v[l.firstPart]?n.value:l.count<2?"($$scope.$$root || $$scope)."+n.value:"$$scope."+n.value,g.isSimple=!1):E[n.value]?r=n.value:(r=h(n.value),g.simpleVariables.push(r)),n.children.length)for(a=0,o=(s=n.children).length;a<o;a++)i="###"+(t=s[a]).uniq+"###",t=f(t),r=r.split(i).join(t);c+=r}else"{}"===n.type?c+="{"+f(n.child)+"}":c+=n.value;return c},g.result=f(t),G.debug.parser&&console.log(e,g),g},G.utils.parsFilter=function(e){var t,n,a=[];for(e=e.trim();e;){if(!(t=e.match(/^(\w+)([^\w])(.*)$/))){if(!(t=e.match(/^(\w+)$/)))return null;a.push({name:t[1],args:[],raw:""});break}e="|"===t[2]?(a.push({name:t[1],args:[],raw:""}),t[3]):(n=G.utils.parsArguments(t[3],{stop:"|"}),a.push({name:t[1],args:n.result,raw:t[3].slice(0,n.length)}),t[3].slice(n.length+1).trim())}return{result:a}},G.utils.parsArguments=function(e,t){var n,a,i,o,r,s,l,c;for(t=t||{},a="",o=r=0,c=l=!(i=[]),s=function(){a&&(i.push(a),a="")};r<=e.length;)if(n=e[r]||"",r++,l)a+=n,'"'===n&&(l=!1);else if(c)a+=n,"'"===n&&(c=!1);else if('"'===n)a+=n,l=!0;else if("'"===n)a+=n,c=!0;else if(o)a+=n,"("===n&&o++,")"===n&&o--;else if(" "===n||","===n)s();else{if(t.stop&&t.stop===n){s();break}"("===n&&(o=1),a+=n}return s(),{result:i,length:r-1}},G.utils.pars_start_tag="{{",G.utils.pars_finish_tag="}}",ee=function(r){var a=G.utils.pars_start_tag,s=G.utils.pars_finish_tag,l=[],c=0,t=0,u=function(e){e=r.substring(t,c-(e=e||1));return t=c,e},p=null,d=function(e,t,n){var a,i,o;for(e||(p={type:"expression",list:[]},l.push(p)),a=null;c<r.length;){if(i=a+(a=r[c]),o=r[c+=1],a===t)return;if(!n){if(i===s&&0===e)return p.list.push(u(2)),!0;"("===a?d(e+1,")"):"{"===a?d(e+1,"}"):'"'===a?d(e+1,'"',!0):"'"===a?d(e+1,"'",!0):"|"===a&&0===e&&("|"===o?c+=1:p.list.push(u()))}}};return function(){for(var e,t,n=null;c<r.length;)if(t=n,n=r[c],c+=1,t+n===a){if((t=u(2))&&l.push({type:"text",value:t}),!d(0))throw"Wrong expression"+r;n=null}if(e=u(-1))return l.push({type:"text",value:e})}(),G.debug.parser&&console.log("parsText",l),l},f={},Q=function(e){for(var t,n,a=[],i=0,o=e.length;i<o;i++)t=e[i],n={type:t.type,value:t.value},t.list&&(n.list=t.list.slice()),a.push(n);return a},G.utils.parsText=function(e){var t=f[e];return t||(f[e]=t=ee(e)),Q(t)},G.utils.compile=h={},h.cache={},h.Function=Function,h.expression=function(t,n){var e,a,i,o,r,s;if(n=n||{},r=(t=t.trim())+"#",r=(r+=n.no_return?"+":"-")+(n.string?"s":"v"),n.input&&(r+=n.input.join(",")),o=h.cache[r])return o;a=(o=G.utils.parsExpression(t,{input:n.input})).result,n.no_return||!1?s="var $$;"+a:n.string&&!o.filter?(s="var $$, __ = ("+a+"); return '' + (__ || (__ == null?'':__))",o.rawExpression="(__="+a+") || (__ == null?'':__)"):s="var $$;return ("+a+")";try{i=n.input?((e=n.input.slice()).unshift("$$scope"),e.push(s),h.Function.apply(null,e)):h.Function("$$scope",s)}catch(e){throw G.exceptionHandler(e,"Wrong expression: "+t,{src:t,cfg:n}),"Wrong expression: "+a}return o.fn=i,h.cache[r]=o},h.cacheText={},h.buildText=function(e,t){var n,a,i,o,r,s=h.cacheText[e];if(!s){for(r=[],i=a=0,o=t.length;a<o;i=++a)"expression"===(n=t[i]).type?n.fn?r.push("this["+i+"].fn(this.scope)"):r.push("((x=this["+i+"].value) || (x == null?'':x))"):n.value&&(n=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),r.push('"'+n+'"'));r=r.join(" + "),s=h.Function("var x; return ("+r+")"),h.cacheText[e]=s}return function(){return s.call(t)}},h.cacheSimpleText={},h.buildSimpleText=function(e,t){var n,a,i,o,r,s,l=e?h.cacheSimpleText[e]:null;if(l||!t)return l||null;for(r=[],s=[],i=a=0,o=t.length;a<o;i=++a)"expression"===(n=t[i]).type?(r.push("("+n.re+")"),n.simpleVariables&&s.push.apply(s,n.simpleVariables)):n.value&&(n=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),r.push('"'+n+'"'));return r=r.join(" + "),l={fn:h.Function("$$scope","var $$, __; return ("+r+")"),simpleVariables:s},e&&(h.cacheSimpleText[e]=l),l},_=function(e){var t,n,a;if(!e.length)return"el";for(a="el",t=0,n=e.length;t<n;t++)a+=".childNodes["+e[t]+"]";return a},te=function(e){for(var t,n,a=G.utils.parsText(e),i=0,o=a.length;i<o;i++)if("expression"===(t=a[i]).type){if(1<t.list.length)return null;if("#"===(n=t.list[0])[0])return null;if("="===n[0])return null;if("::"===n.slice(0,2))return null;if(!(n=G.utils.compile.expression(n,{string:!0})).rawExpression)throw"Error";t.re=n.rawExpression}return G.utils.compile.buildSimpleText(e,a).fn},G.core.fastBinding=function(e){if(G.option.fastBinding&&!e.directive&&!e.hook&&e.fb)return new m(e)},(m=function(e){var b,w,y=this,k=[];return y.fastWatchFn=[],b=[],(w=function(e,t){var n,a,i,o,r,s,l,c,u,p,d,f,h,m,v,g;if(e.dir)for(m=_(b),o=0,c=(d=e.dir).length;o<c;o++)n=d[o],k.push("s.dir("+y.fastWatchFn.length+", "+m+");"),y.fastWatchFn.push(n);if(e.attr)for(r=0,u=(f=e.attr).length;r<u;r++)g=(i=f[r]).value,s=i.attrName,m=_(b),a=te(g),v=g.replace(/"/g,'\\"').replace(/\n/g,"\\n"),a?(k.push('s.fw("'+v+'", '+y.fastWatchFn.length+", "+m+', "'+s+'");'),y.fastWatchFn.push(a)):k.push("s.wt('"+v+"', "+m+", '"+s+"');");if(e.text&&(m=_(b),a=te(e.text),v=e.text.replace(/"/g,'\\"').replace(/\n/g,"\\n"),a?(k.push('s.fw("'+v+'", '+y.fastWatchFn.length+", "+m+");"),y.fastWatchFn.push(a)):k.push('s.wt("'+v+'", '+m+");")),e.children)for(l=0,p=(h=e.children).length;l<p;l++)i=h[l],b.length=t+1,b[t]=i.index,w(i.fb,t+1)})(e.fb,0),k=k.join("\n"),y.resultFn=G.utils.compile.Function("s","el","f$",k),this}).prototype.bind=function(e,t){this.currentCD=e,this.resultFn(this,t,L)},m.prototype.dir=function(e,t){var e=this.fastWatchFn[e],n=this.currentCD,a=new $({attrName:e.attrName,attrArgument:e.attrArgument,changeDetector:n,fbData:e.fbData}),n=e.fb.call(a,n.scope,t,e.value,a);n&&n.start&&n.start()},m.prototype.fw=function(e,t,n,a){var i=this.currentCD,t=this.fastWatchFn[t],o=t(i.locals),t={isStatic:!1,isArray:!1,extraLoop:!1,deep:!1,value:o,callback:null,exp:t,src:e,onStop:null,el:n,ea:a||null};i.watchList.push(t),T(i.scope,t,o)},m.prototype.wt=function(e,t,n){this.currentCD.watchText(e,null,{element:t,elementAttr:n})},G.hooks.attribute.unshift({code:"events",fn:function(){var e=this.attrName.match(/^\@([\w\.\-]+)$/);e&&(this.ns="al",this.name="on",this.attrArgument=e[1])}}),G.hooks.eventModifier={},(g=function(e,n){return G.hooks.eventModifier[e]={event:["keydown","keypress","keyup"],fn:function(e,t){e[n]||(t.stop=!0)}}})("alt","altKey"),g("control","ctrlKey"),g("ctrl","ctrlKey"),g("meta","metaKey"),g("shift","shiftKey"),G.hooks.eventModifier.self=function(e,t){if(e.target!==t.element)return t.stop=!0},G.hooks.eventModifier.once={beforeExec:function(e,t){return t.unbind()}},ae=function(e,t){var n,a,i,o,r,s={};if("string"==typeof e?s.event=e:"object"==typeof e&&e.event&&(s.event=e.event),"string"==typeof s.event&&(s.event=s.event.split(/\s+/)),t&&s.event){for(i=!1,a=0,o=(r=s.event).length;a<o;a++)if(n=r[a],0<=t.indexOf(n)){i=!0;break}if(!i)return null}return L.isFunction(e)?s.fn=e:e.fn&&(s.fn=e.fn),e.beforeExec&&(s.beforeExec=e.beforeExec),e.init&&(s.init=e.init),s},G.d.al.on=function(e,t,n,a){var u,i;a.attrArgument&&(G.option.removeAttribute&&(t.removeAttribute(a.attrName),a.fbElement&&a.fbElement.removeAttribute(a.attrName)),i=a.attrArgument.split(".")[0],(u=function(){}).prototype=se(a.attrArgument,ne[i]),n&&(u.prototype.fn=a.changeDetector.compile(n,{no_return:!0,input:["$event","$element","$value"]})),u.prototype.expression=n,a.fastBinding=function(e,a,t,n){var i,o,r,s,l,c=new u;for(c.scope=e,c.element=a,c.cd=n.changeDetector,i=function(e){return oe(c,e)},r=0,s=(l=c.eventList).length;r<s;r++)o=l[r],L.on(a,o,i);c.initFn&&c.initFn(e,a,t,n),c.unbind=function(){for(var e=c.eventList,t=0,n=e.length;t<n;t++)o=e[t],L.off(a,o,i)},n.changeDetector.watch("$destroy",c.unbind)},a.fastBinding(e,t,n,a))},re={enter:13,tab:9,delete:46,backspace:8,esc:27,space:32,up:38,down:40,left:37,right:39},ne={click:{stop:!0,prevent:!0},dblclick:{stop:!0,prevent:!0},submit:{stop:!0,prevent:!0},keyup:{filterByKey:!0},keypress:{filterByKey:!0},keydown:{filterByKey:!0}},se=function(e,t){var n,a,i,o,r,s={attrArgument:e,throttle:null,throttleTime:0,debounce:null,debounceId:null,initFn:null,eventList:null,stop:(t=t||{}).stop||!1,prevent:t.prevent||!1,scan:!0,modifiers:[]},l=(e=e.split("."))[0],c=null;for((o=G.hooks.eventModifier[l])&&(o=ae(o)).event&&(s.eventList=o.event,o.fn&&s.modifiers.push(o),o.init&&(s.initFn=o.init)),s.eventList||(s.eventList=[l]),n=0,i=(r=e.slice(1)).length;n<i;n++)"stop"===(a=r[n])?s.stop=!0:"prevent"===a?s.prevent=!0:"nostop"===a?s.stop=!1:"noprevent"===a?s.prevent=!1:"noscan"===a?s.scan=!1:"throttle-"===a.substring(0,9)?s.throttle=Number(a.substring(9)):"debounce-"===a.substring(0,9)?s.debounce=Number(a.substring(9)):(o=G.hooks.eventModifier[a])?(o=ae(o,s.eventList))&&s.modifiers.push(o):t.filterByKey&&((c=null===c?{}:c)[a=re[a]?re[a]:a]=!0);return s.filterByKey=c,s},ie=function(e,t){e=e.element;return"checkbox"===e.type?e.checked:"radio"===e.type?e.value||e.checked:(t.component?t:e).value},v=function(t,n){for(var e,a=t.modifiers,i=0,o=a.length;i<o;i++)(e=a[i]).beforeExec&&e.beforeExec(n,t);if(t.fn)try{t.fn(t.cd.locals,n,t.element,ie(t,n))}catch(e){G.exceptionHandler(e,"Error in event: "+t.attrArgument+" = "+t.expression,{attr:t.attrArgument,exp:t.expression,scope:t.scope,cd:t.cd,element:t.element,event:n})}t.scan&&t.cd.scan()},oe=function(e,t){var n,a,i,o,r,s;if(!e.filterByKey||e.filterByKey[t.keyCode]){if(e.modifiers.length)for((n=function(){}).prototype=e,(a=new n).stop=!1,i=0,o=(s=e.modifiers).length;i<o;i++)if((r=s[i]).fn&&(r.fn(t,a),a.stop))return;e.prevent&&t.preventDefault(),e.stop&&t.stopPropagation(),e.debounce?(e.debounceId&&clearTimeout(e.debounceId),e.debounceId=setTimeout(function(){return e.debounceId=null,v(e,t)},e.debounce)):e.throttle?e.throttleTime<Date.now()&&(e.throttleTime=Date.now()+e.throttle,v(e,t)):v(e,t)}},G.hooks.attribute.unshift({code:"directDirective",fn:function(){var l,e=this.attrName.match(/^(.*)\!$/);e&&(e=e[1].replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}),l=this.cd.locals[e]||G.ctrl[e]||G.option.globalController&&window[e],L.isFunction(l)?this.directive=function(e,t,n,a){var i=a.changeDetector;if(n){for(var o=G.utils.parsArguments(n),r=Array(o.result.length),s=0;s<o.result.length;s++)r[s]=G.utils.compile.expression(o.result[s],{input:["$element","$env"]}).fn(i.locals,t,a);l.apply(i,r)}else l.call(i,e,t,n,a)}:(this.result="noDirective",this.stop=!0))}}),G.hooks.attribute.unshift({code:"elementVariable",fn:function(){var e=this.attrName.match(/^#([\w\.]*)$/);e&&(this.directive=de,this.attrArgument=e[1])}}),G.d.al.value=function(e,t,n,a){var i,o;return a.fastBinding=!0,a.on(t,"input",i=function(){a.setValue(n,t.value),o.refresh(),a.scan()}),a.on(t,"change",i),o=a.watch(n,function(e){return t.value=e=null==e?"":e,"$scanNoChanges"})},G.d.al.checked=function(e,n,t,a){var i=a.fbData={opt:{},watch:[]};function o(e){var t=a.takeAttr(e);return G.option.removeAttribute&&(n.removeAttribute(e),a.fbElement&&a.fbElement.removeAttribute(e)),t}function r(e,t){var n=o(t);return n?(i.opt[e]=n,1):(n=o(":"+t)||o("al-attr."+t))?(i.watch.push([n,e]),1):void 0}function l(n,a,i){for(var e in a.fbData.opt)n[e]=a.fbData.opt[e];for(var t=0,o=a.fbData.watch;t<o.length;t++)!function(e){var t=e[1];a.watch(e[0],function(e){n[t]=e,i()})}(o[t])}r("value","value")?a.fastBinding=function(e,t,n,a){var i,o=null;function r(){return t.checked=o&&0<=o.indexOf(s.value),"$scanNoChanges"}var s={};l(s,a,r),i=a.watch(n,function(e){o=e,Array.isArray(o)||(o=null),r()},{isArray:!0}),a.on(t,"change",function(){var e;o||(o=[],a.setValue(n,o)),t.checked?o.indexOf(s.value)<0&&o.push(s.value):0<=(e=o.indexOf(s.value))&&o.splice(e,1),i.refresh(),a.scan()})}:(r("true","true-value"),r("false","false-value"),a.fastBinding=function(e,t,n,a){var i,o,r={true:!0,false:!1};function s(){return t.checked=i===r.true,"$scanNoChanges"}l(r,a,s),o=a.watch(n,function(e){i=e,s()}),a.on(t,"change",function(){i=t.checked?r.true:r.false,a.setValue(n,i),o.refresh(),a.scan()})}),a.fastBinding(e,n,t,a)},G.d.al.if=function(e,t,n,a){var i;return a.elementCanBeRemoved?(G.exceptionHandler(null,a.attrName+" can't control element because of "+a.elementCanBeRemoved,{scope:e,element:t,value:n,env:a}),{}):(a.stopBinding=!0,i={item:null,childCD:null,base_element:null,top_element:null,start:function(){i.prepare(),i.watchModel()},prepare:function(){i.base_element=t,i.top_element=document.createComment(" "+a.attrName+": "+n+" "),L.before(t,i.top_element),L.remove(t)},updateDom:function(e){e?i.insertBlock(e):i.removeBlock()},removeBlock:function(){i.childCD&&(i.childCD.destroy(),i.childCD=null,i.removeDom(i.item),i.item=null)},insertBlock:function(){i.childCD||(i.item=i.base_element.cloneNode(!0),i.insertDom(i.top_element,i.item),i.childCD=a.changeDetector.new(),G.bind(i.childCD,i.item,{skip_attr:a.skippedAttr(),elementCanBeRemoved:a.attrName}))},watchModel:function(){a.watch(n,i.updateDom)},removeDom:function(e){L.remove(e)},insertDom:function(e,t){L.after(e,t)}})},G.d.al.ifnot=function(e,t,n,a){var i=G.d.al.if(e,t,n,a);return i.updateDom=function(e){e?i.removeBlock():i.insertBlock()},i},G.directives.al.repeat={restrict:"AM",init:function(e,S,o,H){var s,W;return H.elementCanBeRemoved?(G.exceptionHandler(null,H.attrName+" can't control element because of "+H.elementCanBeRemoved,{scope:e,element:S,value:o,env:H}),{}):(H.stopBinding=!0,s=H.changeDetector,W={start:function(){W.parsExpression(),W.prepareDom(),W.buildUpdateDom(),W.watchModel()},parsExpression:function(){var e,t=o.trim();if("("===t[0]){if(W.objectMode=!0,e=t.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s+orderBy:(.+)\s*$/))W.objectKey=e[1],W.objectValue=e[2],W.expression=e[3]+(" | toArray:"+W.objectKey+","+W.objectValue+" | orderBy:"+e[4]);else{if(!(e=t.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s*$/)))throw"Wrong repeat: "+o;W.objectKey=e[1],W.objectValue=e[2],W.expression=e[3]+(" | toArray:"+W.objectKey+","+W.objectValue)}W.nameOfKey="$item",W.trackExpression="$item."+W.objectKey}else{if((e=t.match(/(.*) track by ([\w\.\$\(\)]+)/))&&(W.trackExpression=e[2],t=e[1]),!(e=t.match(/\s*(\w+)\s+in\s+(.+)/)))throw"Wrong repeat: "+o;W.nameOfKey=e[1],W.expression=e[2]}},watchModel:function(){var e=W.objectMode?{deep:!0}:{isArray:!0};W.watch=s.watch(W.expression,W.updateDom,e)},prepareDom:function(){var e,t,n,a,i;if(8===S.nodeType){for(W.top_element=S,W.element_list=t=[],e=S.nextSibling;e;){if(8===e.nodeType&&"/directive:"===(i=e.nodeValue.trim().split(/\s+/))[0]&&"al-repeat"===i[1]){H.skipToElement=e;break}t.push(e),e=e.nextSibling}for(n=0,a=t.length;n<a;n++)e=t[n],L.remove(e)}else W.base_element=S,W.top_element=document.createComment(" "+o+" "),L.before(S,W.top_element),L.remove(S),G.option.removeAttribute&&S.removeAttribute(H.attrName)},makeChild:function(e,t,n){var a=s.new(null,{locals:!0});return W.updateLocals(a,e,t,n),a},updateLocals:function(e,t,n,a){e=e.locals;W.objectMode?(e[W.objectKey]=t[W.objectKey],e[W.objectValue]=t[W.objectValue]):e[W.nameOfKey]=t,e.$index=n,e.$first=0===n,e.$last=n===a.length-1},rawUpdateDom:function(e,t){for(var n,a,i,o,r=0,s=e.length;r<s;r++)n=e[r],L.remove(n);for(i=0,o=t.length;i<o;i++)a=t[i],L.after(a.after,a.element)},buildUpdateDom:function(){return W.updateDom=(V=[],_=null,x=R=0,U=H.skippedAttr(),z="$index"===W.trackExpression?(i={},P=function(e){return i[R]||null},N=function(e){null!=e.$id&&delete i[e.$id]},function(e,t){t.$id=R,i[R]=t}):W.trackExpression?(i={},o=s.compile(W.trackExpression,{input:["$id",W.nameOfKey]}),n=function(e,t){return o(s.scope,e,t)},a=function(e){var t=e.$alite_id;return t=t||(e.$alite_id=G.utils.getId()),t},P=function(e){e=n(a,e);return null!=e?i[e]:null},N=function(e){e=e.$id;null!=e&&delete i[e]},function(e,t){e=n(a,e);t.$id=e,i[e]=t}):window.Map?(i=new Map,P=function(e){return i.get(e)},N=function(e){i.delete(e.item)},function(e,t){i.set(e,t)}):(i={},P=function(e){return"object"!=typeof e?i[e]||null:(e=e.$alite_id)?i[e]:null},N=function(e){var t=e.$id;i[t]&&(e.$id=null,delete i[t])},function(e,t){var n;"object"==typeof e?(n=G.utils.getId(),e.$alite_id=n,t.$id=n,i[n]=t):(t.$id=e,i[e]=t)}),r=[],F=function(e){var t,n=typeof e;if("object"==n)return e&&e.length?e:[];if("number"==n)t=Math.floor(e);else if("string"==n&&(t=Math.floor(e),isNaN(t)))return[];if(t<r.length)r.length=t;else for(;r.length<t;)r.push(r.length);return r},W.element_list?function(e){for(var i,o,r,t,s,n,a,l,c,u,p,d,f,h,m,v,g,b,w,y,k,_,x,S,C,A,E,D,T,$,M=F(e),j=W.top_element,O=[],L=[],I=0,B=V.length;I<B;I++)(x=V[I]).active=!1;for(R=u=0,f=M.length;u<f;R=++u)l=M[R],(x=P(l))&&(x.active=!0);for(t=[],p=0,h=V.length;p<h;p++)if(!(x=V[p]).active){for(x.prev&&(x.prev.next=x.next),x.next&&(x.next.prev=x.prev),N(x),x.CD.destroy(),d=0,m=(D=x.element_list).length;d<m;d++)s=D[d],t.push(s);x.next=null,x.prev=null,x.element_list=null}for(E=null,A=!(i=[]),n=W.element_list.length-1,R=y=0,v=M.length;y<v;R=++y){if(l=M[R],x=P(c=l))if(W.updateLocals(x.CD,l,R,M),x.prev===E){if(A)for(k=0,g=(T=x.element_list).length;k<g;k++)s=T[k],O.push({element:s,after:j}),j=s;j=(E=x).element_list[n],x.active=!0}else{for((x.prev=E)&&(E.next=x),S=0,b=($=x.element_list).length;S<b;S++)s=$[S],O.push({element:s,after:j}),j=s;(E=x).active=A=!0}else r=W.makeChild(c,R,M),c=function(){for(var e=W.element_list,t=[],n=0,a=e.length;n<a;n++)o=e[n],s=o.cloneNode(!0),i.push({cd:r,el:s}),O.push({element:s,after:j}),t.push(j=s);return t}(),z(l,x={CD:r,element_list:c,prev:E,next:null,active:!0,item:l}),E?(_=E.next,((E.next=x).next=_)&&(_.prev=x)):0===R&&V[0]&&(_=V[0],(x.next=_).prev=x),E=x;L.push(x)}for(V=L,W.rawUpdateDom(t,O),C=O.length=t.length=0,w=i.length;C<w;C++)a=i[C],G.bind(a.cd,a.el,{skip_attr:U,elementCanBeRemoved:H.attrName,noDomOptimization:!0})}:function(e){var t,n,a,i,o,r,s,l,c,u,p,d,f,h,m,v,g,b,w,y=F(e),k=W.top_element;for(x++,n=[],v=[],b=null,g=!(t=[]),R=o=0,p=y.length;o<p;R=++o)s=y[R],(m=P(l=s))?(W.updateLocals(m.CD,s,R,y),m.prev===b?(g&&n.push({element:m.element,after:b.element}),k=(b=m).element,m.version=x):((m.prev=b)&&(b.next=m),n.push({element:m.element,after:k}),g=!0,k=m.element,(b=m).version=x),v.push(m)):(l=W.makeChild(l,R,y),S=W.base_element.cloneNode(!0),null===_?(i=W.base_element.cloneNode(!0),w=G.bind(l,S,{skip_attr:U,elementCanBeRemoved:H.attrName,noDomOptimization:!0,fbElement:i}),(_=G.core.fastBinding(w)||!1)&&(W.base_element=i)):t.push({cd:l,el:S}),n.push({element:S,after:k}),z(s,m={CD:l,element:k=S,prev:b,next:null,version:x,item:s}),b?(h=b.next,((b.next=m).next=h)&&(h.prev=m)):0===R&&V[0]&&(h=V[0],(m.next=h).prev=m),b=m,v.push(m));for(a=[],c=0,d=V.length;c<d;c++)(m=V[c]).version!==x&&(m.prev&&(m.prev.next=m.next),m.next&&(m.next.prev=m.prev),N(m),m.CD.destroy(),a.push(m.element),m.next=null,m.prev=null,m.element=null);for(V=v,W.rawUpdateDom(a,n),u=n.length=a.length=0,f=t.length;u<f;u++)r=t[u],_?_.bind(r.cd,r.el):G.bind(r.cd,r.el,{skip_attr:U,elementCanBeRemoved:H.attrName,noDomOptimization:!0})});var n,a,i,N,P,o,V,R,_,x,U,z,r,F}})}},G.d.al.init=function(t,n,a,i){var o,e,r,s;G.option.removeAttribute&&(n.removeAttribute(i.attrName),i.fbElement&&i.fbElement.removeAttribute(i.attrName)),o=i.changeDetector,s=["$element"],"window"===i.attrArgument&&s.push("window");try{r=o.compile(a,{no_return:!0,input:s}),i.fastBinding=e=function(e,t,n,a){return r(a.changeDetector.locals,t,window)},e(0,n,0,i)}catch(e){G.exceptionHandler(e,"al-init, error in expression: "+a,{exp:a,scope:t,cd:o,element:n}),i.fastBinding=function(){}}},G.d.al.app={stopBinding:!0},G.d.al.stop={restrict:"AE",stopBinding:!0},G.d.al.cloak=function(e,t,n,a){t.removeAttribute(a.attrName),n&&L.removeClass(t,n)},G.d.al.html={restrict:"AM",priority:100,modifier:{},link:function(i,o,r,s){var l;return s.elementCanBeRemoved&&8!==o.nodeType?(G.exceptionHandler(null,s.attrName+" can't control element because of "+s.elementCanBeRemoved,{scope:i,element:o,value:r,env:s}),{}):(s.stopBinding=!0,l={baseElement:null,topElement:null,activeElement:null,childCD:null,name:r,watchMode:null,start:function(){l.parsing(),l.prepare(),l.watchModel()},parsing:function(){var e,t,n,a;if(s.attrArgument)for(e=0,t=(a=s.attrArgument.split(".")).length;e<t;e++)"literal"===(n=a[e])?l.watchMode="literal":"tpl"===n?l.watchMode="tpl":G.d.al.html.modifier[n]&&G.d.al.html.modifier[n](l,{scope:i,element:o,inputName:r,env:s})},prepare:function(){8===o.nodeType?(l.baseElement=null,l.topElement=o):(l.baseElement=o,l.topElement=document.createComment(" "+s.attrName+": "+r+" "),L.before(o,l.topElement),L.remove(o))},removeBlock:function(){var e,t,n,a;if(l.childCD&&(l.childCD.destroy(),l.childCD=null),l.activeElement){if(Array.isArray(l.activeElement))for(t=0,n=(a=l.activeElement).length;t<n;t++)e=a[t],l.removeDom(e);else l.removeDom(l.activeElement);l.activeElement=null}},insertBlock:function(e){var t,n,a;if(l.baseElement)l.activeElement=l.baseElement.cloneNode(!1),l.activeElement.innerHTML=e,l.insertDom(l.topElement,l.activeElement),l.childCD=s.changeDetector.new(),G.bind(l.childCD,l.activeElement,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName});else for((a=document.createElement("body")).innerHTML=e,t=l.topElement,l.activeElement=[],l.childCD=s.changeDetector.new();n=a.firstChild;)l.insertDom(t,n),l.activeElement.push(t=n),G.bind(l.childCD,t,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName})},updateDom:function(e){l.removeBlock(),e&&l.insertBlock(e)},removeDom:function(e){L.remove(e)},insertDom:function(e,t){L.after(e,t)},watchModel:function(){"literal"===l.watchMode?l.updateDom(l.name):"tpl"===l.watchMode?s.watchText(l.name,l.updateDom):s.watch(l.name,l.updateDom)}})}},G.d.al.html.modifier.id=function(t){return t.updateDom=function(e){t.removeBlock(),(e=document.getElementById(e))&&(e=e.innerHTML)&&t.insertBlock(e)}},G.d.al.html.modifier.url=function(t){return t.loadHtml=function(e){L.ajax(e)},t.updateDom=function(e){e?t.loadHtml({cache:!0,url:e,success:function(e){t.removeBlock(),t.insertBlock(e)},error:t.removeBlock}):t.removeBlock()}},G.d.al.html.modifier.scope=function(a,i){var o,r,e=a.name.split(":");if(2===e.length)a.name=e[0],r=e[1];else{if(e=a.name.match(/(.+)\:\s*\:\:([\d\w]+)$/))o=!0;else if(o=!1,!(e=a.name.match(/(.+)\:\s*([\.\w]+)$/)))throw"Wrong expression "+a.name;a.name=e[1],r=e[2]}return a.insertBlock=function(e){var t,n;a.activeElement=a.baseElement.cloneNode(!1),a.activeElement.innerHTML=e,a.insertDom(a.topElement,a.activeElement),e=i.env.changeDetector,(t=a.childCD=e.new(null,{locals:!0})).locals.outer=null,n=e.watch(r,function(e){return t.locals.outer=e},{oneTime:o}),a.childCD.watch("$destroy",function(){return n.stop()}),G.bind(a.childCD,a.activeElement,{skip_attr:i.env.skippedAttr()})}},G.d.al.html.modifier.inline=function(e,t){var n=e.prepare;return e.prepare=function(){return n(),t.env.setValue(e.name,e.baseElement.innerHTML)}},G.d.al.radio=function(e,t,n,a){var i,o=a.takeAttr("al-value"),r=o?a.eval(o):a.takeAttr("value");return a.on(t,"change",function(){a.setValue(n,r),i.refresh(),a.scan()}),i=a.watch(n,function(e){return t.checked=r===e,"$scanNoChanges"})},window.Map?((D=function(){return this.idByItem=new Map,this.itemById={},this.index=1,this}).prototype.acquire=function(e){var t="i"+this.index++;return this.idByItem.set(e,t),this.itemById[t]=e,t},D.prototype.release=function(e){var t=this.itemById[e];delete this.itemById[e],this.idByItem.delete(t)},D.prototype.replace=function(e,t){var n=this.itemById[e];this.idByItem.delete(n),this.idByItem.set(t,e),this.itemById[e]=t},D.prototype.getId=function(e){return this.idByItem.get(e)},D.prototype.getItem=function(e){return this.itemById[e]||null}):((D=function(){return this.itemById={"i#null":null},this}).prototype.acquire=function(e){var t;return null===e?"i#null":("object"==typeof e?(t=e.$alite_id)||(e.$alite_id=t=G.utils.getId()):t=""+e,this.itemById[t]=e,t)},D.prototype.release=function(e){delete this.itemById[e]},D.prototype.replace=function(e,t){this.itemById[e]=t},D.prototype.getId=function(e){return null===e?"i#null":"object"==typeof e?e.$alite_id:""+e},D.prototype.getItem=function(e){return this.itemById[e]||null}),G.d.al.select=function(e,t,n,a){var i,o,r,s,l,c=a.changeDetector.new();return a.stopBinding=!0,c.$select={mapper:o=new D},i=null,c.$select.change=function(){return G.nextTick(function(){return s(i)})},s=function(e){e=o.getId(e);return e?t.value=e:t.selectedIndex=-1},l=c.watch(n,function(e){return s(i=e)}),a.on(t,"input",r=function(e){return i=o.getItem(e.target.value),c.setValue(n,i),l.refresh(),c.scan()}),a.on(t,"change",r),G.bind(c,t,{skip_attr:a.skippedAttr()})},G.d.al.option=function(e,t,n,a){var i,o,r,s,l,a=l=a.changeDetector;for(o=0;o<=4&&!(s=l.$select);++o)l=l.parent||{};s?(r=s.mapper,i=null,a.watch(n,function(e){i?r.getId(e)!==i?(r.release(i),i=r.acquire(e),t.value=i,s.change()):r.replace(i,e):(i=r.acquire(e),t.value=i,s.change())}),a.watch("$destroy",function(){return r.release(i),s.change()})):G.exceptionHandler("","Error in al-option - al-select is not found",{cd:a,scope:a.scope,element:t,value:n})},G.hooks.attribute.unshift({code:"attribute",fn:function(){var e=this.attrName.match(/^\:([\w\.\-]+)$/);e&&("html"===(e=e[1]).split(".")[0]?(this.name="html",e=e.substring(5)):this.name="attr",this.ns="al",this.attrArgument=e)}}),le={checked:"checked",readonly:"readOnly",value:"value",selected:"selected",muted:"muted",disabled:"disabled",hidden:"hidden"},G.d.al.attr=function(e,t,i,n){var o,r,a,s,l,c,u,p,d;if(n.attrArgument){if(a=n.attrArgument.split("."),r=a[0],c=le[r],s=0<a.indexOf("tpl"),G.option.removeAttribute&&(t.removeAttribute(n.attrName),n.fbElement&&n.fbElement.removeAttribute(n.attrName)),o={readOnly:!0},u=null,"style"===r){if(!a[1])throw"Style is not declared";p=a[1].replace(/(-\w)/g,function(e){return e.substring(1).toUpperCase()}),u=function(e,t){return e.style[p]=t=null==t?"":t}}else"class"===r&&1<a.length?(s=!1,l=a.slice(1),u=function(e,t){var n,a,i,o,r;if(t)for(a=0,o=l.length;a<o;a++)n=l[a],L.addClass(e,n);else for(i=0,r=l.length;i<r;i++)n=l[i],L.removeClass(e,n)}):"focus"===r?u=function(e,t){return t?e.focus():e.blur()}:c?u=function(e,t){if(e[c]!==(t=void 0===t?null:t))return e[c]=t}:(o.element=t,o.elementAttr=r);d=s?"watchText":"watch",(a=u?function(e,t,n,a){return a.changeDetector[d](i,function(e){return u(t,e)},o)}:function(e,t,n,a){return a.changeDetector[d](i,null,{readOnly:!0,element:t,elementAttr:r})})(e,t,i,n),n.fastBinding=a}},G.d.al.model=function(e,t,n,a){var i=t.nodeName.toLowerCase();if("select"===i)return G.d.al.select.call(this,e,t,n,a);if("input"===i){if("checkbox"===t.type)return G.d.al.checked.call(this,e,t,n,a);if("radio"===t.type)return G.d.al.radio.call(this,e,t,n,a)}return G.d.al.value.call(this,e,t,n,a)},G.filters.slice=function(e,t,n){return e?n?e.slice(t,n):e.slice(t):null},O=function(e){return e<10?"0"+e:""+e},G.filters.date=function(e,t){var n,a,i,o,r;if(!e)return"";for(o=t,a=0,i=(r=[[/yyyy/g,(e=new Date(e)).getFullYear()],[/mm/g,O(e.getMonth()+1)],[/dd/g,O(e.getDate())],[/HH/g,O(e.getHours())],[/MM/g,O(e.getMinutes())],[/SS/g,O(e.getSeconds())]]).length;a<i;a++)o=o.replace((n=r[a])[0],n[1]);return o},G.filters.json={watchMode:"deep",fn:function(e){return JSON.stringify(G.utils.clone(e),null,4)}},G.filters.filter=function(e,t,n){var a,i,o,r,s,l,c,u,p,d,f;if(2===arguments.length)s=null,f=t;else{if(3!==arguments.length)return e;s=t,f=n}if(!e||null==f||""===f)return e;if(u=[],p=(""+f).toLowerCase(),s)for(i=0,l=e.length;i<l;i++)((a=e[i])[s]===f||0<=(""+a[s]).toLowerCase().indexOf(p))&&u.push(a);else for(o=0,c=e.length;o<c;o++)for(r in a=e[o])((d=a[r])===f||0<=(""+d).toLowerCase().indexOf(p))&&u.push(a);return u},G.filters.orderBy=function(e,n,a){return!e instanceof Array?null:(a=a?1:-1,e.sort(function(e,t){return e[n]<t[n]?-a:e[n]>t[n]?a:0}))},G.filters.throttle={init:function(e,t,n){var a;return t=Number(t),a=null,{onChange:function(e){return a&&clearTimeout(a),a=setTimeout(function(){return a=null,n.setValue(e),n.changeDetector.scan()},t)}}}},G.filters.toArray={init:function(e,t,i){var o,r=2===i.conf.args.length?(o=i.conf.args[0],i.conf.args[1]):(o="key","value"),s=[];return{watchMode:"deep",onChange:function(e){var t,n,a;for(n in s.length=0,e)a=e[n],(t={})[o]=n,t[r]=a,s.push(t);return i.setValue(s)}}}},G.filters.storeTo={init:function(e,t,n){return{onChange:function(e){return n.changeDetector.setValue(t,e),n.setValue(e)}}}},G.text["="]=function(e,t,n,a){t=G.utils.compile.expression(t);if(t.filters)throw"Conflict: bindonce and filters, use one-time binding";a.finally(t.fn(a.changeDetector.locals))},G.text["::"]=function(e,t,n,a){a.changeDetector.watch(t,function(e){return a.finally(e)},{oneTime:!0})},ce=G.f$,G.component=function(S,C){var e,t=S.match(/^(\w+)[\-](.+)$/),t=t?(e=t[1],t[2]):(e="$global",S);t=fe(t),G.d[e]||(G.d[e]={}),G.d[e][t]={restrict:"E",stopBinding:!0,priority:G.priority.$component,init:function(e,n,t,a){var i={$sendEvent:function(e,t){e=new CustomEvent(e);e.value=t,e.component=!0,n.dispatchEvent(e)}},o=a.changeDetector.new(),r=G.ChangeDetector(i),s=new $({element:n,attributes:a.attributes,changeDetector:r,parentChangeDetector:o});try{var l=C.call(r,i,n,s)||{}}catch(e){return void G.exceptionHandler(e,"Error in component <"+S+">: ",{element:n,scope:i,cd:r})}l.onStart&&r.watch("$finishBinding",function(){l.onStart(),r.scan()});var c=!1;o.watch("$destroy",function(){c=!0,r.destroy()}),r.watch("$destroy",function(){l.onDestroy&&l.onDestroy(),c||o.destroy()});for(var u=0,p=n.attributes;u<p.length;u++){var d=p[u];if("#"===d.name[0]){var f=d.name.slice(1);if(f){l.api?o.setValue(f,l.api):o.setValue(f,i);break}}}function h(e,t){var n=s.takeAttr(":"+e);if(!n){if(!(n=s.takeAttr(e)))return;t="copy"}he({childCD:r,listener:t,name:e,parentName:n,parentCD:o})}if(l.props)if(Array.isArray(l.props))for(var m=0,v=l.props;m<v.length;m++)h(g=v[m],!0);else for(var g in l.props)h(g,l.props[g]);else for(var b=0,w=n.attributes;b<w.length;b++){var y=(d=w[b]).name,k=d.value;k&&((y=y.match(/^\:(.*)$/))&&he({childCD:r,name:y[1],parentName:k,parentCD:o}))}var _=!1;if(o.watch("$onScanOnce",function(){return _=!0}),l.template&&(n.innerHTML=l.template),l.templateId){a=document.getElementById(l.templateId);if(!a)throw"No template "+l.templateId;n.innerHTML=a.innerHTML}function x(){_||o.digest(),G.bind(r,n,{skip:!0})}l.templateUrl?ce.ajax({url:l.templateUrl,cache:!0,success:function(e){n.innerHTML=e,x()},error:function(){console.error("Template is not loaded",l.templateUrl)}}):x()}}},G}l.length&&5<g("#the-list tr").length&&!Cookies.get("ipanorama-page-feedback-hidden")&&l.addClass("ipanorama-active").find(".ipanorama-page-feedback-close").on("click",function(e){l.removeClass("ipanorama-active"),Cookies.set("ipanorama-page-feedback-hidden",!0,{expires:360})}),(r=c()).makeInstance=c,"function"==typeof alightInitCallback?alightInitCallback(r):"object"==typeof module&&"object"==typeof module.exports?module.exports=r:(r.option.globalController=!0,(window.alight=r).f$.ready(r.bootstrap))}(jQuery);