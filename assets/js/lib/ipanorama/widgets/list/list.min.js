!function(e){(function(N){"use strict";var O=jQuery,_={name:"list",defaultConfig:{titleControl:true,prevSceneControl:true,nextSceneControl:true,audioControl:true,compassControl:true,fullscreenControl:true,sceneListControl:true,moveToNextScene:true},widget:function(i,a){a=N.Utils.extend(_.defaultConfig,a);this.audioPlayer=new N.AudioPlayer(i.config.audio);var r=this;var t=i.$container;var s=O("<div>").addClass("ipnrm-placeholder").css({display:"none"});var c={};var o=null;var l=null;var d=null;var f=[];var m=null;var p=false;var u=null;this.init=function(){e();n()};this.setAudio=function(e){c.$audioPlayer.toggleClass("ipnrm-active",i.config.audio.tracks.length>0&&i.config.audio.enabled);if(!i.config.audio.enabled)return;for(var n=0;n<i.config.audio.tracks.length;n++){var s=i.config.audio.tracks[n];if(s.sceneId==e.cfg.id){r.audioPlayer.setTrack(s.id);s.autoplay&&r.audioPlayer.play();r.audioPlayer.loop(s.loop);break}}};this.setCompass=function(e){t.off("ipanorama:scene-camera-change",E);if(e.cfg.compass&&e.cfg.compass.enabled&&e.cfg.type!="flat"&&e.cfg.type!="littleplanet"){t.on("ipanorama:scene-camera-change",E);c.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled);v(e)}else c.$compass.toggleClass("ipnrm-active",false)};this.destroy=function(){$();c.$widget.remove();c={};t.removeClass("ipnrm-widget-list");r.audioPlayer.destroy()};var v=function(e){if(!e.control)return;var n=e.control.getLookAt().yaw,s=e.cfg.compass.northOffset-n;s=s%360;s=s<0?s+360:s;c.$compass.css({transform:"rotate("+s+"deg)"})};var e=function(){t.addClass("ipnrm-widget-list");c.$widget=O("<div>").addClass("ipnrm-widget");c.$firstLoad=O("<div>").addClass("ipnrm-first-load");c.$progress=O("<div>").addClass("ipnrm-progress");c.$navigation=O("<div>").addClass("ipnrm-navigation");c.$prevScene=O("<div>").addClass("ipnrm-btn ipnrm-prev-scene");c.$nextScene=O("<div>").addClass("ipnrm-btn ipnrm-next-scene");c.$sceneListHead=O("<div>").addClass("ipnrm-scene-list-head");c.$sceneListData=O("<div>").addClass("ipnrm-scene-list-data");c.$sceneList=O("<div>").addClass("ipnrm-btn ipnrm-scene-list").append("<div><div></div><div></div><div></div></div>");c.$audioPlayer=r.audioPlayer.getWidget();c.$title=O("<div>").addClass("ipnrm-title");c.$tools=O("<div>").addClass("ipnrm-tools");c.$compass=O("<div>").addClass("ipnrm-btn ipnrm-compass");c.$fullscreen=O("<div>").addClass("ipnrm-btn ipnrm-fullscreen");c.$navigation.append(c.$prevScene,c.$nextScene);c.$tools.append(c.$compass,c.$fullscreen);c.$widget.append(c.$progress,c.$firstLoad,c.$navigation,c.$sceneListHead,c.$sceneListData,c.$sceneList,c.$audioPlayer,c.$title,c.$tools);t.append(c.$widget);h();t.on("ipanorama:config",F).trigger("ipanorama:config")};var g=function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.title){var i=O("<div>").addClass("ipnrm-scene-list-item").attr({"data-scene-id":s.id}).html(s.title);c.$sceneListData.append(i)}}};var n=function(){t.on("ipanorama:ready",I);t.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",M);t.on("ipanorama:scene-before-load",A);t.on("ipanorama:scene-after-load",D);t.on("ipanorama:scene-progress",P);t.on("ipanorama:scene-error",R);t.on("ipanorama:scene-hide-start",z);t.on("ipanorama:scene-hide-complete",H);t.on("ipanorama:scene-show-start",q);t.on("ipanorama:scene-show-complete",T);t.on("ipanorama:scene-index",W);c.$firstLoad.on("click",x);c.$prevScene.on("click",L);c.$nextScene.on("click",k);c.$sceneList.on("click",S);c.$sceneListData.on("click",".ipnrm-scene-list-item",y);c.$compass.on("click",b);c.$fullscreen.on("click",w)};var $=function(){t.off("ipanorama:ready",I);t.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",M);t.off("ipanorama:scene-before-load",A);t.off("ipanorama:scene-after-load",D);t.off("ipanorama:scene-progress",P);t.off("ipanorama:scene-error",R);t.off("ipanorama:scene-hide-start",z);t.off("ipanorama:scene-hide-complete",H);t.off("ipanorama:scene-show-start",q);t.off("ipanorama:scene-show-complete",T);t.off("ipanorama:scene-camera-change",E);t.off("ipanorama:scene-index",W);c.$firstLoad.off("click",x);c.$prevScene.off("click",L);c.$nextScene.off("click",k);c.$sceneList.off("click",S);c.$sceneListData.off("click",y);c.$compass.off("click",b);c.$fullscreen.off("click",w)};var C=function(){c.$firstLoad.addClass("ipnrm-hide");a.prevSceneControl&&c.$prevScene.removeClass("ipnrm-hide");a.nextSceneControl&&c.$nextScene.removeClass("ipnrm-hide");a.compassControl&&c.$compass.removeClass("ipnrm-hide");a.sceneListControl&&c.$sceneList.removeClass("ipnrm-hide");a.sceneListControl&&c.$sceneListHead.removeClass("ipnrm-hide");a.sceneListControl&&c.$sceneListData.removeClass("ipnrm-hide");a.audioControl&&c.$audioPlayer.removeClass("ipnrm-hide");a.titleControl&&c.$title.removeClass("ipnrm-hide");a.fullscreenControl&&c.$fullscreen.removeClass("ipnrm-hide")};var h=function(){c.$firstLoad.addClass("ipnrm-hide");c.$prevScene.addClass("ipnrm-hide");c.$nextScene.addClass("ipnrm-hide");c.$compass.addClass("ipnrm-hide");c.$sceneList.addClass("ipnrm-hide");c.$sceneListHead.addClass("ipnrm-hide");c.$sceneListData.addClass("ipnrm-hide");c.$audioPlayer.addClass("ipnrm-hide");c.$title.addClass("ipnrm-hide");c.$fullscreen.addClass("ipnrm-hide")};var L=function(e){m=m-1;if(m<0)m=null;else t.trigger("ipanorama:set-scene",{id:f[m]})};var k=function(e){m=m+1;if(m>=f.length){m=f.length-1;t.trigger("ipanorama:next-scene")}else t.trigger("ipanorama:set-scene",{id:f[m]})};var S=function(e){if(c.$sceneList.hasClass("ipnrm-active")){c.$sceneListHead.css({transition:"all .2s linear .2s"});c.$sceneListData.css({transition:"all .2s linear"})}else{c.$sceneListHead.css({transition:"all .2s linear"});c.$sceneListData.css({transition:"all .2s linear .2s"})}c.$sceneList.toggleClass("ipnrm-active");c.$sceneListHead.toggleClass("ipnrm-active");c.$sceneListData.toggleClass("ipnrm-active")};var y=function(e){var n=O(this);o=n.data("scene-id");t.trigger("ipanorama:set-scene",{id:o})};var b=function(e){if(l){var n=l.control.getLookAt();l.control.lookAt({yaw:l.cfg.compass.northOffset,pitch:n.pitch},600)}};var w=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(c.$fullscreen.hasClass("ipnrm-active"))try{if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen()}catch(e){}else try{var n=t.get(0);if(n.requestFullscreen)n.requestFullscreen();else if(n.mozRequestFullScreen)n.mozRequestFullScreen();else if(n.webkitRequestFullscreen)n.webkitRequestFullscreen();else if(n.msRequestFullscreen)n.msRequestFullscreen()}catch(e){}else{t.toggleClass("ipnrm-fullscreen-mode");if(t.hasClass("ipnrm-fullscreen-mode")){c.$fullscreen.addClass("ipnrm-active");s.insertBefore(t);t.detach();O("body").append(t)}else{c.$fullscreen.removeClass("ipnrm-active");t.detach();t.insertAfter(s);s.remove()}u._onWindowResize()}};var x=function(e){if(d){c.$firstLoad.addClass("ipnrm-hide");t.trigger("ipanorama:set-scene",{id:d})}};var F=function(e,n){if(!n||!n.config)return;t.off("ipanorama:config",F);if(!n.config.autoLoad&&n.config.scenes.length>0){c.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],i=t.data("scene-id");if(i)for(var a=0;a<n.config.scenes.length;a++)if(n.config.scenes[a].id===i){s=n.config.scenes[a];break}d=s.id}g(n.config)};var P=function(e,n){if(n.progress.loaded<n.progress.total){if(!p){c.$progress.addClass("ipnrm-active");p=true}}else if(p){c.$progress.removeClass("ipnrm-active");p=false}};var A=function(e,n){l=n.scene};var D=function(e,n){c.$progress.removeClass("ipnrm-active");p=false;var s=n.scene.cfg.id;c.$sceneListData.find(".ipnrm-scene-list-item").removeClass("ipnrm-active");c.$sceneListData.find('.ipnrm-scene-list-item[data-scene-id="'+s+'"]').addClass("ipnrm-active");C()};var R=function(e,n){c.$progress.removeClass("ipnrm-active");p=false;h()};var z=function(e,n){};var H=function(e,n){};var q=function(e,n){r.setAudio(n.scene);r.setCompass(n.scene);if(n.scene.cfg.title){c.$title.get(0).innerHTML=n.scene.cfg.title;c.$title.addClass("ipnrm-active")}else{c.$title.get(0).innerHTML=null;c.$title.removeClass("ipnrm-active")}};var E=function(e,n){if(!n.scene)return;v(n.scene)};var T=function(e,n){};var W=function(e,n){if(!n)return;o=n.scene.cfg.id;if(m==null){f.push(o);m=0}else if(f[m]!=o){m=m+1;f=f.slice(0,m);f.push(o)}if(m>0)c.$prevScene.addClass("ipnrm-active");else c.$prevScene.removeClass("ipnrm-active");if(m<f.length-1)c.$nextScene.addClass("ipnrm-active");else{c.$nextScene.removeClass("ipnrm-active");if(a.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var i=n.config.scenes[s];if(i.id==o)break}if(s<n.config.scenes.length-1)c.$nextScene.addClass("ipnrm-active")}}};var I=function(e,n){u=n.instance};var M=function(e){if(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)c.$fullscreen.addClass("ipnrm-active");else c.$fullscreen.removeClass("ipnrm-active");setTimeout(function(){u._onWindowResize()},100)}}};N.Widget=N.Widget||{},N.Widget.List=_})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);