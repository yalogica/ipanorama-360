!function(e){(function(V){"use strict";var X=jQuery,Y={name:"civic",defaultConfig:{audioControl:true,compassControl:true,titleThumbnails:true,thumbnailsControl:true,prevSceneControl:true,nextSceneControl:true,zoomInControl:true,zoomOutControl:true,lookUpControl:true,lookDownControl:true,lookLeftControl:true,lookRightControl:true,homeControl:false,fullscreenControl:true,viewerModeControl:false,toogleInterfaceControl:true,startFullscreen:false,hideInterface:false},widget:function(r,a){a=V.Utils.extend(Y.defaultConfig,a);this.audioPlayer=new V.AudioPlayer(r.config.audio);var i=this;var t=r.$container;var n=X("<div>").addClass("ipnrm-placeholder").css({display:"none"});var s={};var l=null;var c=null;var d=null;var m=false;var o=null;var f=null;this.init=function(){e();v()};this.setAudio=function(e){s.$audioPlayer.toggleClass("ipnrm-active",r.config.audio.tracks.length>0&&r.config.audio.enabled);if(!r.config.audio.enabled)return;for(var o=0;o<r.config.audio.tracks.length;o++){var n=r.config.audio.tracks[o];if(n.sceneId==e.cfg.id){i.audioPlayer.setTrack(n.id);n.autoplay&&i.audioPlayer.play();i.audioPlayer.loop(n.loop);break}}};this.setCompass=function(e){t.off("ipanorama:scene-camera-change",T);if(e.cfg.compass&&e.cfg.compass.enabled&&e.cfg.type!="flat"&&e.cfg.type!="littleplanet"){t.on("ipanorama:scene-camera-change",T);s.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled);u(e)}else s.$compass.toggleClass("ipnrm-active",false)};this.destroy=function(){g();s.$widget.remove();s={};t.removeClass("ipnrm-widget-civic");i.audioPlayer.destroy()};var u=function(e){if(!e.control)return;var o=e.control.getLookAt().yaw,n=e.cfg.compass.northOffset-o;n=n%360;n=n<0?n+360:n;s.$compass.css({transform:"rotate("+n+"deg)"})};var e=function(){t.addClass("ipnrm-widget-civic");s.$widget=X("<div>").addClass("ipnrm-widget");s.$firstLoad=X("<div>").addClass("ipnrm-first-load");s.$progress=X("<div>").addClass("ipnrm-progress");s.$progressBar=X("<div>").addClass("ipnrm-progress-bar").appendTo(s.$progress);s.$interface=X("<div>").addClass("ipnrm-interface");s.$audioPlayer=i.audioPlayer.getWidget();s.$compass=X("<div>").addClass("ipnrm-compass");s.$thumbsBar=X("<div>").addClass("ipnrm-thumbs-bar");s.$menuBar=X("<div>").addClass("ipnrm-menu-bar");s.$interface.append(s.$thumbsBar,s.$menuBar);s.$prevScene=X("<div>").addClass("ipnrm-btn ipnrm-prev-scene");s.$nextScene=X("<div>").addClass("ipnrm-btn ipnrm-next-scene");s.$zoomIn=X("<div>").addClass("ipnrm-btn ipnrm-zoom-in");s.$zoomOut=X("<div>").addClass("ipnrm-btn ipnrm-zoom-out");s.$lookUp=X("<div>").addClass("ipnrm-btn ipnrm-look-up");s.$lookDown=X("<div>").addClass("ipnrm-btn ipnrm-look-down");s.$lookLeft=X("<div>").addClass("ipnrm-btn ipnrm-look-left");s.$lookRight=X("<div>").addClass("ipnrm-btn ipnrm-look-right");s.$home=X("<div>").addClass("ipnrm-btn ipnrm-home");s.$fullscreen=X("<div>").addClass("ipnrm-btn ipnrm-fullscreen");s.$stereoMode=X("<div>").addClass("ipnrm-btn ipnrm-stereo-mode");s.$toggleInterface=X("<div>").addClass("ipnrm-btn ipnrm-toggle-interface");s.$menuBar.append(s.$prevScene,s.$nextScene,s.$zoomIn,s.$zoomOut,s.$lookUp,s.$lookDown,s.$lookLeft,s.$lookRight,s.$home,s.$fullscreen,s.$stereoMode,s.$toggleInterface);s.$widget.append(s.$progress,s.$firstLoad,s.$audioPlayer,s.$compass,s.$interface);t.append(s.$widget);a.startFullscreen&&t.addClass("ipnrm-fullscreen");a.hideInterface&&s.$widget.addClass("ipnrm-hide-controls");$();t.on("ipanorama:config",R).trigger("ipanorama:config")};var p=function(e){if(!e.scenes.length)return;s.$thumbs=X("<div>").addClass("ipnrm-thumbs");s.$thumbsBar.append(s.$thumbs);for(var o=0;o<e.scenes.length;o++){var n=e.scenes[o];var r=X("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":n.id});if(a.titleThumbnails){if(n.title){var i=X("<div>").addClass("ipnrm-thumb-title").html(n.title);s.$thumbs.append(r.append(i))}}else if(n.image||n.imageThumb){var t=X("<img>").attr({loading:"lazy",src:n.imageThumb?n.imageThumb:n.image});s.$thumbs.append(r.append(t));var i=X("<div>").addClass("ipnrm-thumb-title-img").html(n.title);s.$thumbs.append(r.append(i))}}};var v=function(){t.on("ipanorama:ready",B);t.on("mouseup touchend",q);t.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",K);t.on("ipanorama:scene-before-load",I);t.on("ipanorama:scene-after-load",L);t.on("ipanorama:scene-progress",z);t.on("ipanorama:scene-error",F);t.on("ipanorama:scene-show-start",S);t.on("ipanorama:mode",x);s.$thumbsBar.on("click",".ipnrm-thumb",P);s.$firstLoad.on("click",U);s.$prevScene.on("click",M);s.$nextScene.on("click",O);s.$zoomIn.on("mousedown touchstart",D);s.$zoomOut.on("mousedown touchstart",E);s.$lookUp.on("mousedown touchstart",W);s.$lookDown.on("mousedown touchstart",Z);s.$lookLeft.on("mousedown touchstart",N);s.$lookRight.on("mousedown touchstart",_);s.$home.on("click",j);s.$fullscreen.on("click",Q);s.$stereoMode.on("click",G);s.$compass.on("click",J);s.$toggleInterface.on("click",H)};var g=function(){t.off("ipanorama:ready",B);t.off("mouseup  touchend",q);t.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",K);t.off("ipanorama:scene-before-load",I);t.off("ipanorama:scene-after-load",L);t.off("ipanorama:scene-progress",z);t.off("ipanorama:scene-error",F);t.off("ipanorama:scene-show-start",S);t.off("ipanorama:scene-camera-change",T);t.off("ipanorama:mode",x);s.$thumbsBar.off("click",".ipnrm-thumb",P);s.$firstLoad.off("click",U);s.$prevScene.off("click",M);s.$nextScene.off("click",O);s.$zoomIn.off("mousedown touchstart",D);s.$zoomOut.off("mousedown touchstart",E);s.$lookUp.off("mousedown touchstart",W);s.$lookDown.off("mousedown touchstart",Z);s.$lookLeft.off("mousedown touchstart",N);s.$lookRight.off("mousedown touchstart",_);s.$home.off("click",j);s.$fullscreen.off("click",Q);s.$stereoMode.off("click",G);s.$compass.off("click",J);s.$toggleInterface.off("click",H)};var h=function(){s.$firstLoad.addClass("ipnrm-hide");a.audioControl&&s.$audioPlayer.removeClass("ipnrm-hide");a.compassControl&&s.$compass.removeClass("ipnrm-hide");a.thumbnailsControl&&s.$thumbsBar.removeClass("ipnrm-hide");a.prevSceneControl&&s.$prevScene.removeClass("ipnrm-hide");a.nextSceneControl&&s.$nextScene.removeClass("ipnrm-hide");a.zoomInControl&&s.$zoomIn.removeClass("ipnrm-hide");a.zoomOutControl&&s.$zoomOut.removeClass("ipnrm-hide");a.lookUpControl&&s.$lookUp.removeClass("ipnrm-hide");a.lookDownControl&&s.$lookDown.removeClass("ipnrm-hide");a.lookLeftControl&&s.$lookLeft.removeClass("ipnrm-hide");a.lookRightControl&&s.$lookRight.removeClass("ipnrm-hide");a.homeControl&&s.$home.removeClass("ipnrm-hide");a.fullscreenControl&&s.$fullscreen.removeClass("ipnrm-hide");a.viewerModeControl&&s.$stereoMode.removeClass("ipnrm-hide");a.toogleInterfaceControl&&s.$toggleInterface.removeClass("ipnrm-hide");if(t.hasClass("ipnrm-fullscreen"))s.$fullscreen.addClass("ipnrm-active");else s.$fullscreen.removeClass("ipnrm-active");if(s.$widget.hasClass("ipnrm-hide-controls"))s.$toggleInterface.removeClass("ipnrm-active");else s.$toggleInterface.addClass("ipnrm-active")};var $=function(){s.$firstLoad.addClass("ipnrm-hide");s.$audioPlayer.addClass("ipnrm-hide");s.$compass.addClass("ipnrm-hide");s.$thumbsBar.addClass("ipnrm-hide");s.$prevScene.addClass("ipnrm-hide");s.$nextScene.addClass("ipnrm-hide");s.$zoomIn.addClass("ipnrm-hide");s.$zoomOut.addClass("ipnrm-hide");s.$lookUp.addClass("ipnrm-hide");s.$lookDown.addClass("ipnrm-hide");s.$lookLeft.addClass("ipnrm-hide");s.$lookRight.addClass("ipnrm-hide");s.$home.addClass("ipnrm-hide");s.$fullscreen.addClass("ipnrm-hide");s.$stereoMode.addClass("ipnrm-hide");s.$toggleInterface.addClass("ipnrm-hide")};var C=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control,o=e.getZoom();if(f.viewer.sceneActive.cfg.type=="flat")o=o+.01;else if(f.viewer.sceneActive.cfg.type=="littleplanet")o=o-50;else o=o-.2;e.setZoom(o);C()},10)};var k=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control,o=e.getZoom();if(f.viewer.sceneActive.cfg.type=="flat")o=o-.01;else if(f.viewer.sceneActive.cfg.type=="littleplanet")o=o+50;else o=o+.2;e.setZoom(o);k()},10)};var b=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;if(f.viewer.sceneActive.cfg.type=="flat")e.rotateUp(5);else e.rotateUp(.01);b()},10)};var w=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;if(f.viewer.sceneActive.cfg.type=="flat")e.rotateUp(-5);else e.rotateUp(-.01);w()},10)};var y=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;if(f.viewer.sceneActive.cfg.type=="flat")e.rotateLeft(5);else e.rotateLeft(.01);y()},10)};var A=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;if(f.viewer.sceneActive.cfg.type=="flat")e.rotateLeft(-5);else e.rotateLeft(-.01);A()},10)};var z=function(e,o){if(o.progress.loaded<o.progress.total){if(!m){s.$progress.addClass("ipnrm-active");m=true}s.$progressBar.css({width:o.progress.loaded/o.progress.total*100+"%"})}else{if(m){s.$progress.removeClass("ipnrm-active");m=false}s.$progressBar.css({width:0})}};var I=function(e,o){d=o.scene};var L=function(e,o){s.$progress.removeClass("ipnrm-active");m=false;var n=s.$thumbsBar.find('.ipnrm-thumb[data-scene-id="'+o.scene.cfg.id+'"]');s.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active");n.addClass("ipnrm-active");h();setTimeout(function(){if(s.$thumbs.find(".ipnrm-thumb").length){var e=s.$thumbs.find(".ipnrm-thumb:first-child").get(0).offsetLeft;if(n.get(0))s.$thumbsBar.get(0).scrollLeft=n.get(0).offsetLeft-e}},100)};var F=function(e,o){s.$progress.removeClass("ipnrm-active");m=false;$()};var S=function(e,o){i.setAudio(o.scene);i.setCompass(o.scene)};var T=function(e,o){if(!o.scene)return;u(o.scene)};var B=function(e,o){f=o.instance};var R=function(e,o){if(!o||!o.config)return;t.off("ipanorama:config",R);if(!o.config.autoLoad&&o.config.scenes.length>0){s.$firstLoad.removeClass("ipnrm-hide");var n=o.config.scenes[0],r=t.data("scene-id");if(r)for(var i=0;i<o.config.scenes.length;i++)if(o.config.scenes[i].id===r){n=o.config.scenes[i];break}c=n.id}p(o.config)};var x=function(e,o){if(!o||!o.master)return;l=o.mode;switch(l){case"normal":s.$stereoMode.removeClass("ipnrm-active");break;case"stereo":s.$stereoMode.addClass("ipnrm-active");break}};var P=function(e){t.trigger("ipanorama:set-scene",{id:X(this).data("scene-id")});s.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active");X(this).addClass("ipnrm-active")};var U=function(e){if(c){s.$firstLoad.addClass("ipnrm-hide");t.trigger("ipanorama:set-scene",{id:c})}};var M=function(e){if(!(f.viewer&&f.viewer.sceneActive))return;var o=f.viewer.sceneActive.cfg.id;for(var n=0;n<f.config.scenes.length;n++){var r=f.config.scenes[n];if(r.id==o)break}if(n-1<0)n=f.config.scenes.length-1;else n=n-1;t.trigger("ipanorama:set-scene",{id:f.config.scenes[n].id})};var O=function(e){if(!(f.viewer&&f.viewer.sceneActive))return;var o=f.viewer.sceneActive.cfg.id;for(var n=0;n<f.config.scenes.length;n++){var r=f.config.scenes[n];if(r.id==o)break}if(n+1>=f.config.scenes.length)n=0;else n=n+1;t.trigger("ipanorama:set-scene",{id:f.config.scenes[n].id})};var q=function(e){clearTimeout(o)};var D=function(e){clearTimeout(o);C()};var E=function(e){clearTimeout(o);k()};var W=function(e){clearTimeout(o);b()};var Z=function(e){clearTimeout(o);w()};var N=function(e){clearTimeout(o);y()};var _=function(e){clearTimeout(o);A()};var j=function(e){var o=f.viewer.sceneActive.control;o.lookAt(f.viewer.sceneActive.cfg.camera.lookAt,500)};var Q=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(s.$fullscreen.hasClass("ipnrm-active"))try{if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen()}catch(e){}else try{var o=t.get(0);if(o.requestFullscreen)o.requestFullscreen();else if(o.mozRequestFullScreen)o.mozRequestFullScreen();else if(o.webkitRequestFullscreen)o.webkitRequestFullscreen();else if(o.msRequestFullscreen)o.msRequestFullscreen()}catch(e){}else{t.toggleClass("ipnrm-fullscreen-mode");if(t.hasClass("ipnrm-fullscreen-mode")){s.$fullscreen.addClass("ipnrm-active");n.insertBefore(t);t.detach();X("body").append(t)}else{s.$fullscreen.removeClass("ipnrm-active");t.detach();t.insertAfter(n);n.remove()}f._onWindowResize()}};var G=function(e){var o=l;switch(o){case"normal":o="stereo";break;case"stereo":o="normal";break}t.trigger("ipanorama:mode",{mode:o})};var H=function(e){s.$widget.toggleClass("ipnrm-hide-controls");if(s.$widget.hasClass("ipnrm-hide-controls"))s.$toggleInterface.removeClass("ipnrm-active");else s.$toggleInterface.addClass("ipnrm-active")};var J=function(e){if(d){var o=d.control.getLookAt();d.control.lookAt({yaw:d.cfg.compass.northOffset,pitch:o.pitch},600)}};var K=function(e){if(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)s.$fullscreen.addClass("ipnrm-active");else s.$fullscreen.removeClass("ipnrm-active");setTimeout(function(){f._onWindowResize()},100)}}};V.Widget=V.Widget||{},V.Widget.Civic=Y})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);